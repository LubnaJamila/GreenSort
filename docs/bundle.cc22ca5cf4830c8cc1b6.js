(()=>{var e,t={551:()=>{},1234:()=>{},2262:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},2302:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},2351:(e,t,a)=>{"use strict";var n=a(5072),i=a.n(n),s=a(7825),r=a.n(s),l=a(7659),o=a.n(l),d=a(5056),c=a.n(d),h=a(540),m=a.n(h),u=a(1113),p=a.n(u),g=a(2262),b={};b.styleTagTransform=p(),b.setAttributes=c(),b.insert=o().bind(null,"head"),b.domAPI=r(),b.insertStyleElement=m();i()(g.A,b),g.A&&g.A.locals&&g.A.locals},2660:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},2812:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},3863:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},3927:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},4530:()=>{},4762:(e,t,a)=>{"use strict";e.exports=a.p+"assets/images/97e34163ec13b90eebb2.png"},5817:()=>{},6375:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},7096:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},8108:()=>{},8590:()=>{},8752:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r},9264:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});class n{constructor(){this.app=document.getElementById("sidebar"),this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.currentRoute="dashboard"}render(e="pengguna"){this.app&&(this.app.innerHTML=`\n      <div class="sidebar ${this.isMobile?"mobile-hidden":""}">\n        <div class="logo">\n          <span class="logo-text">GREENSORT</span>\n          <button class="sidebar-toggle d-none d-lg-block">\n            <i class="bi bi-chevron-left"></i>\n          </button>\n        </div>\n        \n        <nav class="nav-container">\n          ${this.renderMainMenu()}\n          ${this.renderRoleSpecificMenu(e)}\n        </nav>\n        \n        <div class="sidebar-footer">\n          <button id="logout-btn" class="btn btn-outline-danger logout-btn">\n            <i class="bi bi-box-arrow-left"></i>\n            <span class="logout-text">Logout</span>\n          </button>\n        </div>\n      </div>\n    `,this.setupEventListeners(),this.updateActiveState())}renderMainMenu(){return'\n      <div class="nav-section">\n        <a href="#" class="nav-link" data-route="dashboard">\n          <i class="bi bi-grid"></i>\n          <span class="nav-text">Dashboard</span>\n        </a>\n      </div>\n    '}renderRoleSpecificMenu(e){return"admin"===e?'\n        <div class="nav-section">\n          <div class="nav-section-title">Master</div>\n          <a href="#/master-alamat" class="nav-link" data-route="masterAlamat">\n            <i class="bi bi-database"></i>\n            <span class="nav-text">Master Alamat</span>\n          </a>\n        </div>\n      ':"pengguna"===e?'\n        <div class="nav-section">\n          <div class="nav-section-title">Menu Pengguna</div>\n          <a href="#/klasifikasi-sampah" class="nav-link" data-route="klasifikasiSampah">\n            <i class="bi bi-recycle"></i>\n            <span class="nav-text">Klasifikasi Sampah</span>\n          </a>\n          <a href="#/master-alamat" class="nav-link" data-route="masterAlamat">\n            <i class="bi bi-database"></i>\n            <span class="nav-text">Alamat</span>\n          </a>\n          <a href="#/rekening" class="nav-link" data-route="dataRekening">\n            <i class="bi bi-wallet2"></i>\n            <span class="nav-text">Rekening</span>\n          </a>\n          <a href="#/detail-profile" class="nav-link" data-route="detailProfile">\n            <i class="bi bi-person-gear"></i>\n            <span class="nav-text">Pengaturan</span>\n          </a>\n        </div>\n      ':""}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("logout-btn");if(e){const t=e=>{e.preventDefault(),document.dispatchEvent(new CustomEvent("user-logout"))};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-toggle");if(t){const e=()=>this.toggleSidebar();t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}document.querySelectorAll(".nav-link").forEach((e=>{const t=t=>this.handleNavLinkClick(t,e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}));const a=e=>this.handleRouteChange(e);document.addEventListener("route-changed",a),this.eventListeners.push({element:document,type:"route-changed",handler:a})}toggleSidebar(){const e=document.querySelector(".sidebar"),t=document.querySelector(".main-content"),a=document.querySelector(".sidebar-toggle i");e&&t&&a&&(e.classList.toggle("collapsed"),t.classList.toggle("collapsed"),e.classList.contains("collapsed")?(a.classList.remove("bi-chevron-left"),a.classList.add("bi-chevron-right")):(a.classList.remove("bi-chevron-right"),a.classList.add("bi-chevron-left")))}handleNavLinkClick(e,t){e.preventDefault();const a=t.dataset.route;if(a&&(console.log("Nav link clicked:",a),this.currentRoute=a,this.updateActiveState(),document.dispatchEvent(new CustomEvent("navigate",{detail:{page:a}}))),this.isMobile){const e=document.querySelector(".sidebar"),t=document.querySelector(".sidebar-overlay");e&&e.classList.remove("mobile-open"),t&&t.classList.remove("active"),document.body.style.overflow=""}}handleRouteChange(e){e.detail&&e.detail.route&&(console.log("Route change received in sidebar view:",e.detail.route),this.currentRoute=e.detail.route,this.updateActiveState())}updateActiveState(){console.log("Updating active state for route:",this.currentRoute);document.querySelectorAll(".nav-link").forEach((e=>{e.classList.remove("active")}));const e=document.querySelector(`[data-route="${this.currentRoute}"]`);if(e?(e.classList.add("active"),console.log("Active state set for:",this.currentRoute)):console.log("No nav link found for route:",this.currentRoute),"dashboardUser"===this.currentRoute||"dashboard"===this.currentRoute){const e=document.querySelector('[data-route="dashboard"]');e&&(e.classList.add("active"),console.log("Dashboard active state set"))}if("tambahRekening"===this.currentRoute){const e=document.querySelector('[data-route="dataRekening"]');e&&(e.classList.add("active"),console.log("Rekening active state set for tambahRekening"))}if("editProfile"===this.currentRoute||"ubahPassword"===this.currentRoute){const e=document.querySelector('[data-route="detailProfile"]');e&&(e.classList.add("active"),console.log("Profile active state set for sub-route"))}if("tambahAlamat"===this.currentRoute){const e=document.querySelector('[data-route="masterAlamat"]');e&&(e.classList.add("active"),console.log("Master Alamat active state set for tambahAlamat"))}}setActiveRoute(e){console.log("Setting active route to:",e),this.currentRoute=e,this.updateActiveState()}initWithRoute(e){console.log("Initializing with route:",e),this.currentRoute=e}getActiveRoute(){return this.currentRoute}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),this.app&&(this.app.innerHTML="")}}},9466:(e,t,a)=>{"use strict";a(4692),a(5668),a(5194),a(417),a(7008),a(277),a(3765),a(6091);var n=a(9336),i=(a(4148),a(3481)),s=a.n(i),r=(a(8303),a(2685),a(9264));class l{constructor(e,t="dashboard"){this.view=new r.A,this.role=e,this.initialRoute=t,this.setupNavigationListener()}init(){if(console.log("Initializing SidebarPresenter with role:",this.role,"and initial route:",this.initialRoute),this.role)this.view.initWithRoute(this.initialRoute),this.view.render(this.role),document.addEventListener("user-logout",this.handleLogout.bind(this));else{console.log("Role tidak ditemukan, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}setupNavigationListener(){document.addEventListener("navigate",(e=>{e.detail&&e.detail.page&&(console.log("Navigation detected in sidebar:",e.detail.page),this.view&&this.view.setActiveRoute(e.detail.page))})),document.addEventListener("route-changed",(e=>{e.detail&&e.detail.route&&(console.log("Route change detected in sidebar:",e.detail.route),this.view&&this.view.setActiveRoute(e.detail.route))}))}handleLogout(){localStorage.removeItem("currentUser");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}setActiveRoute(e){console.log("Setting active route to:",e),this.view&&this.view.setActiveRoute(e)}getActiveRoute(){return this.view?this.view.getActiveRoute():null}updateActiveState(e){console.log("Updating active state to:",e),this.view&&e&&this.view.setActiveRoute(e)}destroy(){console.log("Destroying SidebarPresenter"),document.removeEventListener("user-logout",this.handleLogout.bind(this)),this.view&&this.view.destroy()}}class o{constructor(){this.routes={index:"#/",register:"#/register",login:"#/login",dashboard:"#/dashboard",dashboardUser:"#/dashboardUser",detailProfile:"#/detail-profile",editProfile:"#/edit-profile",ubahPassword:"#/ubah-password",masterAlamat:"#/master-alamat",tambahAlamat:"#/master-alamat/tambah",pengajuan:"#/pengajuan",penawaran:"#/penawaran",pengiriman:"#/pengiriman",selesai:"#/selesai",diterima:"#/diterima",ditolak:"#/ditolak",penjemputan:"#/penjemputan",selesaiUser:"#/selesaiUser",klasifikasiSampah:"#/klasifikasi-sampah",penjualanSampah:"#/penjualan-sampah",dataRekening:"#/rekening",tambahRekening:"#/rekening/tambah",ubahRekening:"#/rekening/edit",formPenolakan:"#/form-penolakan",formPenawaran:"#/form-penawaran",formOngkir:"#/form-ongkir",formSelesai:"#/form-selesai"},this.initialRoute=this.getCurrentRoute(),this.setupHashChangeListener(),this.checkAuthAndRedirect()}setupHashChangeListener(){window.addEventListener("hashchange",(()=>{this.checkAuthAndRedirect(),this.dispatchRouteChange()}))}getCurrentRoute(){const e=window.location.hash.split("?")[0]||"#/",t=Object.entries(this.routes).find((([t,a])=>a===e));return t?t[0]:"index"}getCurrentPath(){return window.location.hash.split("?")[0]||"#/"}navigateTo(e,t={}){let a=e.startsWith("#")?e:this.routes[e]||"#/";(a!==this.getCurrentPath()||t.force)&&(t.replace?window.location.replace(a):window.location.hash=a,this.dispatchRouteChange())}dispatchRouteChange(){const e=new CustomEvent("routeChanged",{detail:{page:this.getCurrentRoute(),path:this.getCurrentPath()}});document.dispatchEvent(e)}onRouteChange(e){const t=t=>e(t.detail);return document.addEventListener("routeChanged",t),()=>document.removeEventListener("routeChanged",t)}checkAuthAndRedirect(){const e=this.getCurrentRoute(),t=!!localStorage.getItem("currentUser");return!t||"login"!==e&&"register"!==e?!(!t&&"dashboard"===e)||(this.navigateTo("login",{replace:!0}),!1):(this.navigateTo("dashboard",{replace:!0}),!1)}}var d=a(5072),c=a.n(d),h=a(7825),m=a.n(h),u=a(7659),p=a.n(u),g=a(5056),b=a.n(g),v=a(540),y=a.n(v),w=a(1113),f=a.n(w),k=a(9940),E={};E.styleTagTransform=f(),E.setAttributes=b(),E.insert=p().bind(null,"head"),E.domAPI=m(),E.insertStyleElement=y();c()(k.A,E);k.A&&k.A.locals&&k.A.locals;const L=a.p+"assets/images/5cb930681f9a040f275c.png",x=a.p+"assets/images/f5094c0c58d8c9e40299.png",S=a.p+"assets/images/691c367fa39c006ae8c1.png",D=a.p+"assets/images/328887cb7b68f38d7a3c.png";class A{constructor(){this.app=document.getElementById("app"),this.eventListeners=[]}render(){console.log("Rendering IndexView"),this.app.innerHTML=`\n            <header class="position-relative overflow-hidden" style="min-height: 100vh;">\n                \x3c!-- Background Image --\x3e\n                <div id="bg-image" class="position-absolute top-0 start-0 w-100 h-100" \n                style="z-index: -1; background: no-repeat right center; background-size: cover; background-position: right;"></div>\n\n                \x3c!-- Navigation --\x3e\n                <nav class="container d-flex justify-content-between align-items-center py-4 position-relative">\n                    <div class="fw-bold text-black fs-5">GREENSORT</div>\n                    <ul class="nav d-none d-md-flex gap-4">\n                        <li><a href="#" class="text-black text-decoration-none">Home</a></li>\n                        <li><a href="#about-us" class="text-black text-decoration-none">About Us</a></li>\n                        <li><a href="#services" class="text-black text-decoration-none">Services</a></li>\n                        <li><a href="#contact-us" class="text-black text-decoration-none">Contact Us</a></li>\n                    </ul>\n                    <div class="d-none d-md-flex gap-2">\n                        <button class="btn btn-outline-success btn-sm fw-semibold px-4 rounded-pill" id="login-btn">Login</button>\n                        <button class="btn btn-success btn-sm text-white fw-semibold px-4 rounded-pill" id="register-btn">Register</button>\n                    </div>\n                </nav>\n\n                \x3c!-- Hero Content --\x3e\n                <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between py-5 gap-3 position-relative">\n                    <div class="text-section" style="max-width: 450px;">\n                        <h1 class="fw-bold mb-4" style="font-size: 2rem;">\n                            Transformasi Pengelolaan Limbah B2B Menuju Masa Depan yang Berkelanjutan\n                        </h1>\n                        <p class="mb-4 text-secondary" style="font-size: 1rem;">\n                            GreenSort membantu bisnis Anda mengambil keputusan berbasis data untuk pengelolaan limbah yang lebih efisien, hemat biaya, dan ramah lingkungan.\n                        </p>\n                        <button class="btn btn-green px-4 py-2 rounded-pill fw-semibold" type="button">Ini Button</button>\n                    </div>\n\n                    <div class="image-section d-flex justify-content-center">\n                        <img src="${L}" alt="Hero Image" class="img-fluid" style="max-width: 500px;" loading="lazy" />\n                    </div>\n                </div>\n            </header>\n\n            \x3c!-- About Us Section --\x3e\n            <section class="container my-5 py-4" id="about-us">\n                <div class="row g-4">\n                    <div class="col-12">\n                        <h2 class="fw-bold fs-4 mb-1">About Us</h2>\n                        <p class="text-secondary fst-italic mb-1">"Menilai Limbah Mengelola Masa Depan"</p>\n                        <p class="text-secondary fst-italic mb-4">"Klasifikasikan dengan Cerdas, Jual dengan Mudah"</p>\n                    </div>\n                    \n                    <div class="col-md-5">\n                        <div class="position-relative">\n                            <div class="green-bg p-4 rounded-4 position-relative">\n                                <img src="${x}" alt="Illustration" class="img-fluid" />\n                                \x3c!-- Tanda tanya di sekitar gambar --\x3e\n                                <div class="question-mark bg-white rounded-circle position-absolute">?</div>\n                                <div class="question-mark bg-white rounded-circle position-absolute" style="top: 15%; right: 15%;">?</div>\n                                <div class="question-mark bg-white rounded-circle position-absolute" style="bottom: 25%; left: 10%;">?</div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class="col-md-7">\n                        <div class="border-start border-dark ps-4">\n                            <p class="text-justify">\n                                GreenSort adalah platform penilaian limbah B2B berbasis teknologi \n                                cerdas yang dirancang untuk membantu industri dalam mengelola \n                                limbah secara efisien, bertanggung jawab, dan berkelanjutan. Kami \n                                percaya bahwa masa depan industri yang lebih hijau dimulai dari \n                                transparansi dan efisiensi dalam proses pengelolaan limbah. \n                                Dengan menggabungkan kecerdasan buatan, analitik data, dan \n                                standar keberlanjutan.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            \x3c!-- Services Section --\x3e\n            <section class="services-wrapper my-5 py-5" id="services">\n                <div class="container">\n                    <h2 class="text-end fw-bold mb-5">Services</h2>\n                    \n                    <div class="row g-4">\n                        \x3c!-- Kolom Kiri (Service Boxes) --\x3e\n                        <div class="col-lg-5 d-flex flex-column gap-4">\n                            \x3c!-- Service Box 1 --\x3e\n                            <div class="service-card lime-card">\n                                <h3 class="service-title d-flex justify-content-between align-items-center">\n                                    Klasifikasi Image Limbah Otomatis\n                                    <i class="fas fa-camera-retro"></i>\n                                </h3>\n                                <p class="service-description">\n                                    Deteksi dan klasifikasikan limbah secara instan melalui analisis gambar berbasis AI—praktis, cepat, dan akurat.\n                                </p>\n                                <hr class="my-3">\n                                <a href="#" class="d-flex justify-content-between align-items-center text-decoration-none text-dark">\n                                    <span class="fw-semibold">Coba Sekarang</span>\n                                    <i class="fas fa-circle-arrow-right"></i>\n                                </a>\n                            </div>\n                            \n                            \x3c!-- Service Box 2 --\x3e\n                            <div class="service-card white-card">\n                                <h3 class="service-title d-flex justify-content-between align-items-center">\n                                    Penjualan Limbah\n                                    <i class="fas fa-store"></i>\n                                </h3>\n                                <p class="service-description">\n                                    Pasarkan limbah yang telah diklasifikasikan langsung ke mitra B2B melalui marketplace yang aman dan efisien.\n                                </p>\n                                <hr class="my-3">\n                                <a href="#" class="d-flex justify-content-between align-items-center text-decoration-none text-dark">\n                                    <span class="fw-semibold">Coba Sekarang</span>\n                                    <i class="fas fa-circle-arrow-right"></i>\n                                </a>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Kolom Kanan (Ilustrasi) --\x3e\n                        <div class="col-lg-7">\n                            <div class="h-100">\n                                <img src="${D}" alt="Ilustrasi pemandangan hijau dengan bunga putih" class="img-fluid rounded-4 w-100 h-100" style="object-fit: cover;">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            \x3c!-- Education Section --\x3e\n            <section class="container my-5 py-4">\n                <h2 class="text-center fw-semibold mb-5">Edukasi Lingkungan & Kesadaran Limbah</h2>\n                \n                <div class="row g-4">\n                    <div class="col-md-5">\n                        <h3 class="fw-bold fs-3 mb-4">\n                            Edukasi adalah langkah awal menuju industri yang lebih bertanggung jawab terhadap lingkungan\n                        </h3>\n                        <div class="education-image-container">\n                            <img src="${L}" alt="Edukasi Lingkungan" class="img-fluid rounded-4">\n                        </div>\n                    </div>\n                    \n                    <div class="col-md-7">\n                        <div class="border-start border-dark ps-4">\n                            <div class="mb-4">\n                                <h4 class="fw-semibold mb-2">Jenis-Jenis Limbah & Cara Penanganannya</h4>\n                                <p class="text-secondary">\n                                    Pelajari perbedaan limbah organik, anorganik, B3, dan cara penanganan yang tepat untuk masing-masing.\n                                </p>\n                            </div>\n                            \n                            <div class="mb-4">\n                                <h4 class="fw-semibold mb-2">Manfaat Daur Ulang & Ekonomi Sirkular</h4>\n                                <p class="text-secondary">\n                                    Temukan bagaimana limbah bisa bernilai kembali dan mendukung keberlanjutan industri.\n                                </p>\n                            </div>\n                            \n                            <div class="mb-4">\n                                <h4 class="fw-semibold mb-2">Tips & Praktik Ramah Lingkungan</h4>\n                                <p class="text-secondary">\n                                    Dari kebiasaan kecil hingga langkah besar—kami bagikan cara-cara sederhana untuk ikut menjaga lingkungan.\n                                </p>\n                            </div>\n                            \n                            <div class="mb-4">\n                                <h4 class="fw-semibold mb-2">Dampak Lingkungan dari Limbah Tak Terkelola</h4>\n                                <p class="text-secondary">\n                                    Pahami risiko sebenarnya terhadap kesehatan dan ekosistem, serta pentingnya pengelolaan yang bertanggung jawab.\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            \x3c!-- Contact Section --\x3e\n            <section class="contact-section py-5" id="contact-us">\n                <div class="container">\n                    <h2 class="text-center fw-bold mb-5">Contact Us</h2>\n                    \n                    <div class="row justify-content-center mb-5">\n                        \x3c!-- Email Card --\x3e\n                        <div class="col-md-4 mb-4 mb-md-0">\n                            <div class="contact-card text-center">\n                                <i class="fas fa-envelope mb-3"></i>\n                                <h4>Email</h4>\n                                <p>Politeknik@polije.ac.id</p>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- WhatsApp Card --\x3e\n                        <div class="col-md-4 mb-4 mb-md-0">\n                            <div class="contact-card text-center">\n                                <i class="fab fa-whatsapp mb-3"></i>\n                                <h4>Whatsapp</h4>\n                                <p>+62 8913 9238 32</p>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Email Card (duplicated as in the design) --\x3e\n                        <div class="col-md-4">\n                            <div class="contact-card text-center">\n                                <i class="fas fa-envelope mb-3"></i>\n                                <h4>Email</h4>\n                                <p>Marketing@polije.ac.id</p>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Contact Form --\x3e\n                    <div class="row justify-content-center">\n                        <div class="col-md-8">\n                            <div class="contact-form">\n                                <h3 class="text-center mb-4">Formulir Kontak</h3>\n                                <form>\n                                    <div class="row g-3 mb-3">\n                                        <div class="col-md-6">\n                                            <input type="text" class="form-control" placeholder="Nama Lengkap" required>\n                                        </div>\n                                        <div class="col-md-6">\n                                            <input type="email" class="form-control" placeholder="Email" required>\n                                        </div>\n                                    </div>\n                                    <div class="mb-3">\n                                        <input type="text" class="form-control" placeholder="Subjek" required>\n                                    </div>\n                                    <div class="mb-4">\n                                        <textarea class="form-control" rows="5" placeholder="Pesan"></textarea>\n                                    </div>\n                                    <button type="submit" class="btn btn-green w-100 py-2 fw-semibold">Kirim</button>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n\n            \x3c!-- Footer --\x3e\n            <footer class="footer py-3">\n                <div class="container text-center">\n                    <p class="mb-0">© Copyright <strong>2025</strong></p>\n                </div>\n            </footer>\n        `;const e=document.getElementById("bg-image");e&&(e.style.backgroundImage=`url(${S})`),this.setupEventListeners()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("register-btn");if(e){const t=e=>{e.preventDefault();if(localStorage.getItem("currentUser"))return void alert("Anda sudah login. Silahkan logout terlebih dahulu untuk membuat akun baru.");console.log("Navigating to register page");const t=new CustomEvent("navigate",{detail:{page:"register"}});document.dispatchEvent(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.getElementById("login-btn");if(t){const e=e=>{e.preventDefault();if(localStorage.getItem("currentUser"))return void alert("Anda sudah login.");console.log("Navigating to login page");const t=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(t)};t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying IndexView"),this.removeEventListeners()}}class I{constructor(){this.view=new A,this.router=new o,this.setupNavigationListener()}init(){console.log("Initializing IndexPresenter"),this.view.render()}setupNavigationListener(){document.addEventListener("navigate",(e=>{console.log("Navigation event received:",e.detail),e.detail&&e.detail.page&&this.router.navigateTo(e.detail.page)}))}destroy(){console.log("Destroying IndexPresenter"),document.removeEventListener("navigate",this.handleNavigation),this.view.destroy()}}const C="https://greenshort-production.up.railway.app";async function T(e){try{const t=await fetch(`${C}/api/user/${e}`);return await t.json()}catch(e){return console.error("Gagal mengambil detail user:",e),{success:!1,message:"Terjadi kesalahan saat mengambil data"}}}async function M(e){try{const t=await fetch(`${C}/api/rekening/${e}`);return await t.json()}catch(e){return console.error("Gagal mengambil data rekening:",e),{success:!1,message:"Terjadi kesalahan saat mengambil data rekening"}}}async function j(){try{const e=await fetch(`${C}/api/banks`);return await e.json()}catch(e){return console.error("Gagal mengambil daftar bank:",e),[]}}function P(){localStorage.removeItem("currentUser")}function B(){return JSON.parse(localStorage.getItem("currentUser"))}var $=a(8752),R={};R.styleTagTransform=f(),R.setAttributes=b(),R.insert=p().bind(null,"head"),R.domAPI=m(),R.insertStyleElement=y();c()($.A,R);$.A&&$.A.locals&&$.A.locals;const U=a.p+"assets/images/6ac5f65a0a3abb390e56.png";class _{constructor(){this.app=document.getElementById("app"),this.eventListeners=[]}render(){this.app.innerHTML=`\n            <main class="container">\n                <div class="row justify-content-center align-items-center">\n                    <div class="col-md-6 d-flex justify-content-center mb-4 mb-md-0">\n                        <img \n                        src="${U}" \n                        alt="Illustration of a woman interacting with a large mobile phone screen showing a registration form, surrounded by green leaves and white gears" \n                        class="img-fluid" \n                        style="max-height: 500px;"\n                        />\n                    </div>\n                    <div class="col-md-6" style="max-width: 400px;">\n                        <h1 class="fw-bold fs-2 tracking-widest mb-1" style="letter-spacing: 0.15em;">Welcome!</h1>\n                        <p class="mb-4 text-secondary" style="font-size: 0.875rem;">Silahkan isi field untuk Daftar Akun</p>\n                        <div class="divider">\n                            <div class="dot"></div>\n                            <div class="line"></div>\n                            <div class="dot"></div>\n                        </div>\n                        <form id="registerForm">\n                            <div class="mb-3">\n                                <input type="text" id="name" class="form-control rounded-3" placeholder="Nama Lengkap" />\n                            </div>\n                            <div class="mb-3">\n                                <input type="email" id="email" class="form-control rounded-3" placeholder="Email" />\n                            </div>\n                            <div class="mb-3">\n                                <input type="tel" id="phone" class="form-control rounded-3" placeholder="No Hp" />\n                            </div>\n                            <div class="mb-3">\n                                <input type="text" id="username" class="form-control rounded-3" placeholder="Username" />\n                            </div>\n                            <div class="mb-3">\n                                <input type="password" id="password" class="form-control rounded-3" placeholder="Password" />\n                            </div>\n                            <div class="mb-3">\n                                <input type="password" id="rePassword" class="form-control rounded-3" placeholder="Re-Password" />\n                            </div>\n                            <button type="submit" class="btn btn-lime w-100 py-3 fw-bold">Daftar</button>\n                            <div id="registerMessages"></div>\n                        </form>\n                        <p class="text-center mt-4 text-secondary" style="font-size: 0.875rem;">\n                        Sudah punya akun? <a href="#" id="login-link" class="lime-link">Login</a>\n                        </p>\n                    </div>\n                </div>\n            </main>\n        `,this.setupEventListeners()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("login-link");if(e){const t=e=>{e.preventDefault(),console.log("Navigating to login page");const t=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}}getRegisterFormData(){return{name:document.getElementById("name")?.value||"",email:document.getElementById("email")?.value||"",phone:document.getElementById("phone")?.value||"",username:document.getElementById("username")?.value||"",password:document.getElementById("password")?.value||"",rePassword:document.getElementById("rePassword")?.value||""}}showAlert(e){alert(e)}showRegisterSuccess(){this.removeMessages();const e=document.getElementById("registerMessages");if(e){const t=document.createElement("div");t.className="alert alert-success mt-3",t.textContent="Pendaftaran berhasil! Mengalihkan ke halaman login...",e.appendChild(t)}}showRegisterError(e){this.removeMessages();const t=document.getElementById("registerMessages");if(t){const a=document.createElement("div");a.className="alert alert-danger mt-3",a.textContent=e||"Pendaftaran gagal. Silakan coba lagi.",t.appendChild(a)}}removeMessages(){const e=document.getElementById("registerMessages");e&&(e.innerHTML="")}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying RegisterView"),this.removeEventListeners()}}class F{constructor(){this.view=new _,this.handleRegisterSubmit=this.handleRegisterSubmit.bind(this),this.handleNavigate=this.handleNavigate.bind(this)}init(){console.log("Initializing RegisterPresenter"),this.view.render(),this.setupFormListener(),this.setupNavigationListener()}setupFormListener(){const e=document.getElementById("registerForm");e?(e.removeEventListener("submit",this.handleRegisterSubmit),e.addEventListener("submit",this.handleRegisterSubmit),console.log("Register form event listener added")):console.error("Register form not found in the DOM")}setupNavigationListener(){document.removeEventListener("navigate",this.handleNavigate),document.addEventListener("navigate",this.handleNavigate)}handleNavigate(e){console.log("Navigation event received:",e.detail)}async handleRegisterSubmit(e){e.preventDefault(),console.log("Register form submitted");try{const e=this.view.getRegisterFormData();if(console.log("Form data:",e),!this.validateUserData(e))return;const t=await async function(e){const t=await fetch(`${C}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}(e);t.success?(this.view.showRegisterSuccess(),setTimeout((()=>{const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}),1500)):this.view.showRegisterError(t.message)}catch(e){console.error("Error during registration:",e),this.view.showRegisterError("Terjadi kesalahan saat mendaftar. Silakan coba lagi.")}}validateUserData(e){if(!(e.name&&e.email&&e.phone&&e.username&&e.password&&e.rePassword))return this.view.showRegisterError("Semua field harus diisi!"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))return this.view.showRegisterError("Email tidak valid!"),!1;return/^\d+$/.test(e.phone)?e.password.length<6?(this.view.showRegisterError("Password minimal 6 karakter!"),!1):e.password===e.rePassword||(this.view.showRegisterError("Konfirmasi password tidak cocok!"),!1):(this.view.showRegisterError("Nomor telepon hanya boleh berisi angka!"),!1)}destroy(){console.log("Destroying RegisterPresenter"),document.removeEventListener("navigate",this.handleNavigate);const e=document.getElementById("registerForm");e&&e.removeEventListener("submit",this.handleRegisterSubmit),this.view.destroy()}}var q=a(2660),N={};N.styleTagTransform=f(),N.setAttributes=b(),N.insert=p().bind(null,"head"),N.domAPI=m(),N.insertStyleElement=y();c()(q.A,N);q.A&&q.A.locals&&q.A.locals;const H=a.p+"assets/images/f8b8bb6d2a4d48c9b3e0.png";class V{constructor(){this.app=document.getElementById("app"),this.eventListeners=[]}render(){this.app.innerHTML=`\n            <div class="login-container">\n                <div class="illustration">\n                <img\n                    src="${H}"\n                    alt="Illustration of a man holding a large green key standing in front of a computer screen showing a user login form with green accents"\n                    width="600"\n                    height="400"\n                />\n                </div>\n                <div class="login-form">\n                <h1>Welcome!</h1>\n                <p class="subtitle">Silahkan isi field untuk Login</p>\n                <hr />\n                <form id="loginForm">\n                    <input\n                    id="emailOrUsername"\n                    type="text"\n                    class="form-control"\n                    placeholder="Email atau Username"\n                    required\n                    />\n                    <input\n                    id="password"\n                    type="password"\n                    class="form-control"\n                    placeholder="Password"\n                    required\n                    />\n                    <p class="text-center-sm mb-3">\n                    Lupa Password?\n                    <a href="#" class="link-lime">Klik Disini</a>\n                    </p>\n                    <button type="submit" class="btn btn-lime mb-3">Login</button>\n                    <div id="loginMessages"></div>\n                    <p class="text-center-sm">\n                    Tidak punya akun?\n                    <a href="#" id="register-link" class="link-lime">Daftar</a>\n                    </p>\n                </form>\n                </div>\n            </div>\n        `,this.setupEventListeners()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("register-link");if(e){const t=e=>{e.preventDefault(),console.log("Navigating to register page");const t=new CustomEvent("navigate",{detail:{page:"register"}});document.dispatchEvent(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}}getLoginFormData(){return{emailOrUsername:document.getElementById("emailOrUsername")?.value||"",password:document.getElementById("password")?.value||""}}showAlert(e){alert(e)}showLoginSuccess(){this.removeMessages();const e=document.getElementById("loginMessages");if(e){const t=document.createElement("div");t.className="alert alert-success mt-3",t.textContent="Login berhasil! Mengalihkan ke dashboard...",e.appendChild(t)}}showLoginError(e){this.removeMessages();const t=document.getElementById("loginMessages");if(t){const a=document.createElement("div");a.className="alert alert-danger mt-3",a.textContent=e||"Login gagal. Silakan coba lagi.",t.appendChild(a)}}removeMessages(){const e=document.getElementById("loginMessages");e&&(e.innerHTML="")}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying LoginView"),this.removeEventListeners()}}class z{constructor(){this.view=new V,this.handleLoginSubmit=this.handleLoginSubmit.bind(this),this.handleNavigate=this.handleNavigate.bind(this)}init(){console.log("Initializing LoginPresenter"),this.view.render(),this.setupFormListener(),this.setupNavigationListener()}setupFormListener(){const e=document.getElementById("loginForm");e?(e.removeEventListener("submit",this.handleLoginSubmit),e.addEventListener("submit",this.handleLoginSubmit),console.log("Login form event listener added")):console.error("Login form not found in the DOM")}setupNavigationListener(){document.removeEventListener("navigate",this.handleNavigate),document.addEventListener("navigate",this.handleNavigate)}handleNavigate(e){console.log("Navigation event received:",e.detail)}async handleLoginSubmit(e){e.preventDefault(),console.log("Login form submitted");try{const e=this.view.getLoginFormData();if(console.log("Form data:",e),!this.validateCredentials(e))return;const t=await async function(e){const t=await fetch(`${C}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();return a.success&&localStorage.setItem("currentUser",JSON.stringify(a.user)),a}(e);if(t.success){const e=t.user;localStorage.setItem("user",JSON.stringify(e));const a="admin"===e.role?"dashboard":"dashboardUser",n=new CustomEvent("navigate",{detail:{page:a}});document.dispatchEvent(n)}else this.view.showLoginError(t.message)}catch(e){console.error("Error during login:",e),this.view.showLoginError("Terjadi kesalahan saat login. Silakan coba lagi.")}}validateCredentials(e){return e.emailOrUsername&&e.password?!(e.password.length<6)||(this.view.showLoginError("Password minimal 6 karakter!"),!1):(this.view.showLoginError("Email/Username dan Password harus diisi!"),!1)}destroy(){console.log("Destroying LoginPresenter"),document.removeEventListener("navigate",this.handleNavigate);const e=document.getElementById("loginForm");e&&e.removeEventListener("submit",this.handleLoginSubmit),this.view.destroy()}}var O=a(3863),K={};K.styleTagTransform=f(),K.setAttributes=b(),K.insert=p().bind(null,"head"),K.domAPI=m(),K.insertStyleElement=y();c()(O.A,K);O.A&&O.A.locals&&O.A.locals;var G=a(3927),J={};J.styleTagTransform=f(),J.setAttributes=b(),J.insert=p().bind(null,"head"),J.domAPI=m(),J.insertStyleElement=y();c()(G.A,J);G.A&&G.A.locals&&G.A.locals;var W=a(4762),Z=a(4692);class X{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}updateStatCards(e){const t=document.querySelectorAll(".stat-number");t.length>=5&&(t[0].textContent=e.total||"0",t[1].textContent=e.pengajuan||"0",t[2].textContent=e.penawaran||"0",t[3].textContent=e.pengiriman||"0",t[4].textContent=e.selesai||"0")}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n      \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Dashboard</h2>\n              <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n            </div>\n            \n            <div class="user-profile">\n              <img id="user-avatar" src="${W}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n\n          <div class="stats-grid">\n            ${this.renderStatCard("0","Semua","bi-hourglass-split","yellow-bg","#/dashboard")}\n            ${this.renderStatCard("0","Pengajuan","bi-clipboard-check","blue-bg","#/pengajuan")}\n            ${this.renderStatCard("0","Penawaran","bi-x-circle","red-bg","#/penawaran")}\n            ${this.renderStatCard("0","Pengiriman","bi-truck","orange-bg","#/pengiriman")}\n            ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesai")}\n          </div>\n        </header>\n\n        <div class="data-section">\n          <div class="data-header">\n            <h3>Semua Data</h3>\n          </div>\n\n          <div class="table-responsive">\n            <table id="datatable" class="table table-striped" style="width:100%">\n              <thead>\n              <tr>\n                <th><input type="checkbox" id="select-all"></th>\n                <th>Jenis Sampah</th>\n                <th>Tanggal Pengajuan</th>\n                <th>Berat</th>\n                <th>Harga</th>\n                <th>Status</th>\n              </tr>\n            </thead>\n              <tbody id="applications-table-body">\n                \x3c!-- Dynamic content will be inserted here --\x3e\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    `}renderStatCard(e,t,a,n,i){return`\n      <div class="stat-card">\n        <div class="stat-content">\n          <div class="stat-number">${e}</div>\n          <div class="stat-label">${t}</div>\n        </div>\n        <div class="stat-icon ${n}">\n          <i class="bi ${a}"></i>\n        </div>\n        <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n          <i class="bi bi-arrow-down"></i>\n        </a>\n      </div>\n    `}getStatusBadge(e){const t={pengajuan:{label:"Pengajuan",class:"badge bg-warning text-dark",icon:"bi-hourglass"},"pengajuan diterima":{label:"Pengajuan Diterima",class:"badge bg-success text-white",icon:"bi-check-circle"},"pengajuan ditolak":{label:"Pengajuan Ditolak",class:"badge bg-danger text-white",icon:"bi-x-circle"}}[e.toLowerCase()]||{label:e,class:"badge bg-secondary",icon:"bi-question-circle"};return`<span class="${t.class}"><i class="bi ${t.icon} me-1"></i> ${t.label}</span>`}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll('#applications-table-body input[type="checkbox"]').forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("dashboard-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderApplicationsTable(e){const t=document.getElementById("applications-table-body");if(!t)return;const a=e.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=a,this.initDataTable()}renderApplicationRow(e){const t=["pengajuan diterima","penawaran diterima","penawaran ditolak","selesai"].includes(e.status)?`Rp. ${this.formatRupiah(e.harga_tawaran)}`:"-";return`\n    <tr>\n      <td><input type="checkbox" class="row-checkbox" value="${e.id}"></td>\n      <td>${e.jenis_sampah||"-"}</td>\n      <td>${this.formatTanggal(e.created_at)}</td>\n      <td>${e.berat} kg</td>\n      <td>${t}</td>\n      <td>${this.getStatusBadge(e.status)}</td>\n    </tr>\n  `}formatRupiah(e){return Number(e).toLocaleString("id-ID")}formatTanggal(e){return new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}getStatusStyles(e){const t={Diterima:{class:"bg-info bg-opacity-10",icon:"bi-clipboard-check"},Ditolak:{class:"bg-danger bg-opacity-10",icon:"bi-x-circle"},Dikirim:{class:"bg-warning bg-opacity-10",icon:"bi-truck"},Selesai:{class:"bg-success bg-opacity-10",icon:"bi-check-circle"},default:{class:"bg-light",icon:"bi-hourglass-split"}};return t[e]||t.default}initDataTable(){Z.fn.DataTable.isDataTable("#datatable")&&Z("#datatable").DataTable().destroy(),Z(document).ready((()=>{Z("#datatable").DataTable({responsive:!0,language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",paginate:{first:"<<",last:">>",next:">",previous:"<"}}})}))}renderDashboardData(e){this.renderApplicationsTable(e)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),Z.fn.DataTable.isDataTable("#datatable")&&Z("#datatable").DataTable().destroy()}}const Y="https://greenshort-production.up.railway.app";class Q{constructor(){this.dashboardView=new X,this.sidebarView=new r.A,this.currentUser=null,this.handleLogout=this.handleLogout.bind(this)}init(){if(console.log("Initializing DashboardPresenter"),this.currentUser=B(),this.currentUser)this.sidebarView.render(),this.dashboardView.render(),this.dashboardView.displayUserInfo(this.currentUser),async function(){try{const e=await fetch(`${Y}/api/dashboard-admin/stats`),t=await e.json();return t.success?t.data:null}catch(e){return console.error("Gagal ambil data dashboard-admin stats:",e),null}}().then((e=>{if(e){const t={total:e.total,pengajuan:e.pengajuan,penawaran:e.penawaran,pengiriman:e.pengiriman,selesai:e.selesai};this.dashboardView.updateStatCards(t)}else console.warn("Gagal mengambil data statistik dari server")})),async function(){try{const e=await fetch(`${Y}/api/penjualan-sampah`),t=await e.json();return t.success?t.data:[]}catch(e){return console.error("Gagal ambil data penjualan:",e),[]}}().then((e=>{this.dashboardView.renderDashboardData(e)})),this.setupEventListeners();else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout)}handleLogout(){console.log("Logout initiated"),P(),this.dashboardView.destroy(),this.sidebarView.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}destroy(){console.log("Destroying DashboardPresenter"),document.removeEventListener("user-logout",this.handleLogout),this.dashboardView.destroy(),this.sidebarView.destroy()}}var ee=a(4692);class te{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.baseImageUrl="https://greenshort-production.up.railway.app/uploads/"}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n      \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Dashboard</h2>\n              <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n            </div>\n            \n            <div class="user-profile">\n              <img id="user-avatar" src="${W}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n\n          <div class="stats-grid">\n            ${this.renderStatCard("0","Menunggu Validasi","bi-hourglass-split","yellow-bg","#/dashboardUser")}\n            ${this.renderStatCard("0","Diterima","bi-clipboard-check","blue-bg","#/diterima")}\n            ${this.renderStatCard("0","Ditolak","bi-x-circle","red-bg","#/ditolak")}\n            ${this.renderStatCard("0","Penjemputan","bi-truck","orange-bg","#/penjemputan")}\n            ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesaiUser")}\n          </div>\n        </header>\n\n        <div class="data-section">\n          <div class="data-header">\n            <h3>Data Pengajuan Sampah</h3>\n            <button id="refresh-btn" class="btn btn-outline-primary btn-sm">\n              <i class="bi bi-arrow-clockwise"></i> Refresh\n            </button>\n          </div>\n\n          <div class="table-responsive">\n            <table id="datatable" class="table table-striped" style="width:100%">\n              <thead>\n                <tr>\n                  <th><input type="checkbox" id="select-all"></th>\n                  <th>Gambar Sampah</th>\n                  <th>Jenis Sampah</th>\n                  <th>Berat (kg)</th>\n                  <th>Status</th>\n                  <th>Aksi</th>\n                </tr>\n              </thead>\n              <tbody id="applications-table-body">\n                <tr>\n                  <td colspan="6" class="text-center py-4">\n                    <div class="text-muted">\n                      <i class="bi bi-clock-history" style="font-size: 2rem;"></i>\n                      <p class="mt-2">Memuat data...</p>\n                    </div>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    `}renderStatCard(e,t,a,n,i){return`\n      <div class="stat-card">\n        <div class="stat-content">\n          <div class="stat-number">${e}</div>\n          <div class="stat-label">${t}</div>\n        </div>\n        <div class="stat-icon ${n}">\n          <i class="bi ${a}"></i>\n        </div>\n        <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n          <i class="bi bi-arrow-down"></i>\n        </a>\n      </div>\n    `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll('#applications-table-body input[type="checkbox"]').forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("dashboard-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}renderApplicationsTable(e){const t=document.getElementById("applications-table-body");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='\n        <tr>\n          <td colspan="6" class="text-center py-4">\n            <div class="text-muted">\n              <i class="bi bi-inbox" style="font-size: 2rem;"></i>\n              <p class="mt-2">Belum ada data pengajuan sampah</p>\n            </div>\n          </td>\n        </tr>\n      ');const a=e.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=a,this.initDataTable(),this.setupTableEventListeners()}renderApplicationRow(e){const t=this.getStatusStyles(e.status),a=e.gambar_sampah?`${this.baseImageUrl}${e.gambar_sampah}`:"";return`\n      <tr>\n        <td><input type="checkbox" class="row-checkbox" value="${e.id}"></td>\n        <td>\n          ${a?`\n            <img src="${a}" \n                 alt="Gambar Sampah" \n                 class="img-thumbnail application-image" \n                 style="width: 60px; height: 60px; object-fit: cover; cursor: pointer;"\n                 onclick="this.parentElement.querySelector('.image-modal').style.display='block'"\n                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEw0MCA0ME0yMCA0MEw0MCAyMCIgc3Ryb2tlPSIjQ0NDIiBzdHJva2Utd2lkdGg9IjIiLz4KPHN2Zz4K'; this.style.objectFit='contain';">\n            <div class="image-modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); cursor:pointer;" onclick="this.style.display='none'">\n              <img src="${a}" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); max-width:90%; max-height:90%; object-fit:contain;">\n            </div>\n          `:'\n            <div style="width: 60px; height: 60px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; display: flex; align-items: center; justify-content: center;">\n              <i class="bi bi-image text-muted"></i>\n            </div>\n          '}\n        </td>\n        <td>${e.jenisSampah||"-"}</td>\n        <td>${e.berat?e.berat.toFixed(2)+" kg":"-"}</td>\n        <td>\n          <span class="badge ${t.class}">\n            <i class="bi ${t.icon}"></i>\n            ${e.status}\n          </span>\n        </td>\n        <td>\n          <button type="button" class="btn btn-outline-primary btn-sm view-btn" data-id="${e.id}" title="Lihat Detail">\n            <i class="bi bi-eye"></i>\n          </button>\n        </td>\n      </tr>\n    `}setupTableEventListeners(){const e=document.getElementById("applications-table-body");if(!e)return;e.querySelectorAll(".view-btn").forEach((e=>{const t=e=>{e.preventDefault(),this.handleViewApplication(e.target.closest("button").dataset.id)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}))}handleViewApplication(e){const t=new CustomEvent("view-application",{detail:{applicationId:e}});document.dispatchEvent(t)}getStatusStyles(e){return{pengajuan:{class:"bg-warning bg-opacity-10 text-warning border border-warning",icon:"bi-hourglass-split"},"menunggu validasi":{class:"bg-warning bg-opacity-10 text-warning border border-warning",icon:"bi-hourglass-split"},diterima:{class:"bg-info bg-opacity-10 text-info border border-info",icon:"bi-clipboard-check"},ditolak:{class:"bg-danger bg-opacity-10 text-danger border border-danger",icon:"bi-x-circle"},penjemputan:{class:"bg-primary bg-opacity-10 text-primary border border-primary",icon:"bi-truck"},selesai:{class:"bg-success bg-opacity-10 text-success border border-success",icon:"bi-check-circle"}}[e?e.toLowerCase():""]||{class:"bg-light text-muted border",icon:"bi-question-circle"}}formatStatus(e){if(!e)return"Tidak Diketahui";return{pengajuan:"Pengajuan",diterima:"Diterima",ditolak:"Ditolak",penjemputan:"Penjemputan",selesai:"Selesai"}[e.toLowerCase()]||e}initDataTable(){ee.fn.DataTable&&ee.fn.DataTable.isDataTable("#datatable")&&ee("#datatable").DataTable().destroy(),void 0!==ee&&ee.fn.DataTable&&ee(document).ready((()=>{ee("#datatable").DataTable({responsive:!0,order:[[2,"asc"]],columnDefs:[{orderable:!1,targets:[0,1,5]},{searchable:!1,targets:[0,1,5]}],language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",infoEmpty:"Menampilkan 0 sampai 0 dari 0 data",infoFiltered:"(difilter dari _MAX_ total data)",loadingRecords:"Memuat...",processing:"Memproses...",emptyTable:"Tidak ada data yang tersedia",zeroRecords:"Tidak ditemukan data yang sesuai",paginate:{first:"<<",last:">>",next:">",previous:"<"}},pageLength:10,lengthMenu:[[10,25,50,100],[10,25,50,100]]})}))}updateStatCards(e){if(!e)return;const t=document.querySelectorAll(".stat-number");t.length>=5&&(t[0].textContent=e.menungguValidasi||"0",t[1].textContent=e.diterima||"0",t[2].textContent=e.ditolak||"0",t[3].textContent=e.penjemputan||"0",t[4].textContent=e.selesai||"0")}renderDashboardData(e,t=null){this.renderApplicationsTable(e),this.updateStatCards(t)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),ee.fn.DataTable.isDataTable("#datatable")&&ee("#datatable").DataTable().destroy()}}class ae{constructor(){}getApplications(){return[{id:1,jenisSampah:"Glass",tanggalPembelian:"03-10-2023",kuantitas:6,harga:"Rp. 50,000",total:"Rp. 300,000"},{id:2,jenisSampah:"Plastic",tanggalPembelian:"12-11-2023",kuantitas:10,harga:"Rp. 20,000",total:"Rp. 200,000"},{id:3,jenisSampah:"Metal",tanggalPembelian:"15-08-2023",kuantitas:8,harga:"Rp. 40,000",total:"Rp. 320,000"},{id:4,jenisSampah:"Paper",tanggalPembelian:"21-09-2023",kuantitas:15,harga:"Rp. 10,000",total:"Rp. 150,000"},{id:5,jenisSampah:"Organic",tanggalPembelian:"05-10-2023",kuantitas:12,harga:"Rp. 5,000",total:"Rp. 60,000"},{id:6,jenisSampah:"Electronic",tanggalPembelian:"01-12-2023",kuantitas:3,harga:"Rp. 100,000",total:"Rp. 300,000"},{id:7,jenisSampah:"Glass",tanggalPembelian:"17-07-2023",kuantitas:9,harga:"Rp. 50,000",total:"Rp. 450,000"},{id:8,jenisSampah:"Plastic",tanggalPembelian:"30-06-2023",kuantitas:20,harga:"Rp. 20,000",total:"Rp. 400,000"},{id:9,jenisSampah:"Metal",tanggalPembelian:"09-01-2024",kuantitas:4,harga:"Rp. 40,000",total:"Rp. 160,000"},{id:10,jenisSampah:"Paper",tanggalPembelian:"11-03-2024",kuantitas:18,harga:"Rp. 10,000",total:"Rp. 180,000"},{id:11,jenisSampah:"Organic",tanggalPembelian:"27-04-2024",kuantitas:14,harga:"Rp. 5,000",total:"Rp. 70,000"},{id:12,jenisSampah:"Electronic",tanggalPembelian:"03-02-2024",kuantitas:5,harga:"Rp. 100,000",total:"Rp. 500,000"},{id:13,jenisSampah:"Glass",tanggalPembelian:"06-01-2024",kuantitas:7,harga:"Rp. 50,000",total:"Rp. 350,000"},{id:14,jenisSampah:"Plastic",tanggalPembelian:"16-12-2023",kuantitas:11,harga:"Rp. 20,000",total:"Rp. 220,000"},{id:15,jenisSampah:"Metal",tanggalPembelian:"29-11-2023",kuantitas:6,harga:"Rp. 40,000",total:"Rp. 240,000"},{id:16,jenisSampah:"Paper",tanggalPembelian:"14-10-2023",kuantitas:10,harga:"Rp. 10,000",total:"Rp. 100,000"},{id:17,jenisSampah:"Organic",tanggalPembelian:"08-09-2023",kuantitas:9,harga:"Rp. 5,000",total:"Rp. 45,000"},{id:18,jenisSampah:"Electronic",tanggalPembelian:"19-08-2023",kuantitas:2,harga:"Rp. 100,000",total:"Rp. 200,000"},{id:19,jenisSampah:"Glass",tanggalPembelian:"22-07-2023",kuantitas:10,harga:"Rp. 50,000",total:"Rp. 500,000"},{id:20,jenisSampah:"Plastic",tanggalPembelian:"25-06-2023",kuantitas:13,harga:"Rp. 20,000",total:"Rp. 260,000"}]}}const ne="https://greenshort-production.up.railway.app";async function ie(e,t){try{if(!e||!t)return{success:!1,message:"User ID dan status diperlukan"};const a=await fetch(`${ne}/api/pengajuan/${e}/status/${t}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(e){return console.error("Gagal mengambil data pengajuan berdasarkan status:",e),{success:!1,message:"Tidak bisa terhubung ke server",data:[]}}}class se{constructor(){this.view=new te,this.dashboardModel=new ae,this.currentUser=null,this.handleLogout=this.handleLogout.bind(this),this.handleRefresh=this.handleRefresh.bind(this),this.handleViewApplication=this.handleViewApplication.bind(this)}init(){if(console.log("Initializing DashboardUserPresenter"),this.currentUser=B(),this.currentUser)console.log("Current user:",this.currentUser),this.view.render(),this.view.displayUserInfo(this.currentUser),this.loadDashboardData(),this.setupEventListeners();else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadDashboardData(){try{const e=this.currentUser.id_user||this.currentUser.id;if(!e)return console.error("User ID tidak ditemukan:",this.currentUser),void this.showErrorMessage("ID user tidak valid");console.log("Loading dashboard data for user ID:",e);const t=["pengajuan","pengajuan diterima","pengajuan ditolak","penawaran diterima","penawaran ditolak","selesai"];let a=[];for(const n of t)try{const t=await ie(e,n);t.success&&t.data&&t.data.length>0&&(a=[...a,...t.data])}catch(e){console.warn(`Error fetching data for status '${n}':`,e)}if(0===a.length)return console.log("No applications found for user"),void this.view.renderDashboardData([],this.calculateUserStats([]));const n=a.map((e=>({id:e.id,user_id:e.user_id,gambar_sampah:e.gambar_sampah,jenisSampah:e.jenis_sampah,berat:parseFloat(e.berat)||0,status:e.status||"pengajuan",created_at:e.created_at,updated_at:e.updated_at}))),i=this.calculateUserStats(n),s=n.filter((e=>"pengajuan"===e.status.toLowerCase().trim()));this.view.renderDashboardData(s,i)}catch(e){console.error("Error in loadDashboardData:",e),this.showErrorMessage("Terjadi kesalahan saat memuat dashboard")}}calculateUserStats(e){const t={menungguValidasi:0,diterima:0,ditolak:0,penjemputan:0,selesai:0};return e&&0!==e.length?(e.forEach((e=>{const a=e.status?e.status.toLowerCase().trim():"";switch(a){case"pengajuan":case"menunggu validasi":t.menungguValidasi++;break;case"pengajuan diterima":case"diterima":t.diterima++;break;case"pengajuan ditolak":case"ditolak":t.ditolak++;break;case"penawaran diterima":case"penjemputan":t.penjemputan++;break;case"selesai":case"penawaran ditolak":t.selesai++;break;default:console.warn("Unknown status:",a),t.menungguValidasi++}})),t):t}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout),document.addEventListener("dashboard-refresh",this.handleRefresh),document.addEventListener("view-application",this.handleViewApplication)}handleLogout(){console.log("User logout initiated"),P(),this.view.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}handleRefresh(){console.log("Dashboard refresh requested"),this.loadDashboardData(),this.showSuccessMessage("Data berhasil diperbarui")}handleViewApplication(e){const{applicationId:t}=e.detail;console.log("View application:",t);try{const e=new CustomEvent("navigate",{detail:{page:"application-detail",params:{id:t}}});document.dispatchEvent(e)}catch(e){console.error("Error viewing application:",e),this.showErrorMessage("Gagal menampilkan detail pengajuan")}}showSuccessMessage(e){console.log("Success:",e),this.showToast(e,"success")}showErrorMessage(e){console.error("Error:",e),this.showToast(e,"error")}showToast(e,t="info"){const a=document.createElement("div");switch(a.className=`toast-message toast-${t}`,a.textContent=e,a.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      padding: 12px 20px;\n      border-radius: 4px;\n      color: white;\n      font-weight: 500;\n      z-index: 9999;\n      opacity: 0;\n      transition: opacity 0.3s ease;\n    ",t){case"success":a.style.backgroundColor="#28a745";break;case"error":a.style.backgroundColor="#dc3545";break;case"warning":a.style.backgroundColor="#ffc107",a.style.color="#212529";break;default:a.style.backgroundColor="#17a2b8"}document.body.appendChild(a),setTimeout((()=>{a.style.opacity="1"}),100),setTimeout((()=>{a.style.opacity="0",setTimeout((()=>{a.parentNode&&a.parentNode.removeChild(a)}),300)}),3e3)}removeEventListeners(){document.removeEventListener("user-logout",this.handleLogout),document.removeEventListener("dashboard-refresh",this.handleRefresh),document.removeEventListener("view-application",this.handleViewApplication)}destroy(){console.log("Destroying DashboardUserPresenter"),this.removeEventListeners(),this.view.destroy()}}var re=a(2812),le={};le.styleTagTransform=f(),le.setAttributes=b(),le.insert=p().bind(null,"head"),le.domAPI=m(),le.insertStyleElement=y();c()(re.A,le);re.A&&re.A.locals&&re.A.locals;var oe=a(4692);class de{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1}render(){this.sidebarView.render(),this.app.innerHTML=`\n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n\n            \x3c!-- Main Content --\x3e\n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Data Master - Rekening</h2>\n                            <p class="text-dark mb-4">Kelola data rekening untuk sistem pembayaran.</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                    <div class="table-actions">\n                        <a href="#/rekening/tambah" class="classify-btn" data-route="tambahRekeningBtn">\n                            <i class="bi bi-plus-circle"></i>\n                            <span class="nav-text">Tambah Rekening</span>\n                        </a>\n                    </div>\n                </header>\n\n                <div class="content-section">\n                    <div class="content-header">\n                        <h3>Daftar Rekening</h3>\n                    </div>\n\n                    <div class="table-responsive">\n                        <table id="rekening-datatable" class="table table-striped" style="width:100%">\n                            <thead>\n                                <tr>\n                                    <th>Nama Pemilik</th>\n                                    <th>No Rekening</th>\n                                    <th>Bank</th>\n                                    <th>Action</th>\n                                </tr>\n                            </thead>\n                            <tbody id="rekening-table-body"></tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        `,this.initDataTable(),this.setupEventListeners()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("search-input");if(n){const e=e=>this.handleSearch(e.target.value);n.addEventListener("input",e),this.eventListeners.push({element:n,type:"input",handler:e})}}bindAddRekening(e){const t=document.querySelector('[data-route="tambahRekeningBtn"]');if(t){const a=t=>{t.preventDefault(),e()};t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}else console.warn("Button Tambah Rekening tidak ditemukan di DOM")}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderRekeningTable(e){const t=document.getElementById("rekening-table-body");if(!t)return;const a=e.map((e=>this.renderRekeningRow(e))).join("");t.innerHTML=a,this.setupActionButtons()}renderRekeningRow(e){return`\n        <tr>\n            <td>${e.nama_pemilik}</td>\n            <td>${e.no_rek}</td>\n            <td>${e.nama_bank}</td>\n            <td>\n            <div class="btn-group" role="group">\n                <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${e.id_rekening}">\n                <i class="bi bi-pencil"></i> Edit\n                </button>\n                <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${e.id_rekening}">\n                <i class="bi bi-trash"></i> Hapus\n                </button>\n            </div>\n            </td>\n        </tr>\n        `}setupActionButtons(){document.querySelectorAll(".delete-btn").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.id;if(confirm("Yakin ingin menghapus rekening ini?")){const a=new CustomEvent("delete-rekening",{detail:{id_rekening:t,targetRow:e.closest("tr")}});document.dispatchEvent(a)}}))})),document.querySelectorAll(".edit-btn").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.id,a=new CustomEvent("navigate",{detail:{page:"ubahRekening",id_rekening:t}});document.dispatchEvent(a)}))}))}initDataTable(){oe.fn.DataTable.isDataTable("#rekening-datatable")&&oe("#rekening-datatable").DataTable().destroy(),oe(document).ready((()=>{oe("#rekening-datatable").DataTable({responsive:!0,language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",paginate:{first:"<<",last:">>",next:">",previous:"<"}}})}))}handleSearch(e){console.log("Search:",e)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying DataRekeningView"),this.removeEventListeners(),oe.fn.DataTable.isDataTable("#rekening-datatable")&&oe("#rekening-datatable").DataTable().destroy(),this.sidebarView&&this.sidebarView.destroy&&this.sidebarView.destroy()}}class ce{constructor(){this.view=new de,this.currentUser=null,this.handleLogout=this.handleLogout.bind(this),this.handleAddRekening=this.handleAddRekening.bind(this),this.handleDeleteRekening=this.handleDeleteRekening.bind(this)}init(){if(console.log("Initializing DataRekeningPresenter"),this.currentUser=B(),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),this.fetchRekeningUser(this.currentUser.id_user),this.setupEventListeners(),this.view.bindAddRekening(this.handleAddRekening);else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout),document.addEventListener("delete-rekening",this.handleDeleteRekening)}handleLogout(){console.log("Logout initiated from DataRekeningPresenter"),this.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}destroy(){console.log("Destroying DataRekeningPresenter"),document.removeEventListener("user-logout",this.handleLogout),this.view&&this.view.destroy&&this.view.destroy()}handleAddRekening(){const e=new CustomEvent("navigate",{detail:{page:"tambahRekening"}});document.dispatchEvent(e)}async fetchRekeningUser(e){const t=await M(e);t.success?this.view.renderRekeningTable(t.data):console.error("Gagal mendapatkan data rekening:",t.message)}async handleDeleteRekening(e){const{id_rekening:t,targetRow:a}=e.detail,n=await async function(e){try{const t=await fetch(`${C}/api/rekening/${e}`,{method:"DELETE"});return await t.json()}catch(e){return console.error("Gagal menghapus rekening:",e),{success:!1,message:"Terjadi kesalahan saat menghapus rekening."}}}(t);alert(n.message),n.success&&a&&a.remove()}}a(2351);class he{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.eventListeners=[]}render(){this.sidebarView.render(),this.renderMainContent(),this.populateBankDropdown(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n        <button id="mobile-menu-toggle" class="mobile-menu-btn">\n            <i class="bi bi-list"></i>\n        </button>\n        <div class="sidebar-overlay"></div>\n        \n        <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n            <header>\n                <div class="header-content">\n                    <div class="dashboard-header">\n                        <h2>Tambah Rekening</h2>\n                        <p class="text-dark mb-4">Masukkan data rekening baru ke sistem.</p>\n                    </div>\n                    \n                    <div class="user-profile">\n                        <img id="user-avatar" src="${W}" alt="User">\n                        <span id="user-name">Loading...</span>\n                    </div>\n                </div>\n            </header>\n\n            <div class="rekening-section">\n                <div class="form-section">\n                    <form id="form-tambah-rekening" class="form">\n                        <div class="form-group">\n                            <label for="nama-pemilik">Nama Pemilik</label>\n                            <input type="text" id="nama-pemilik" class="form-control" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="no-rekening">Nomor Rekening</label>\n                            <input type="text" id="no-rekening" class="form-control" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="bank">Bank</label>\n                            <select id="bank" class="form-control" required>\n                                <option value="">Memuat daftar bank...</option>\n                            </select>\n                        </div>\n                        <div class="form-group">\n                            <button type="submit" class="btn btn-primary">Simpan</button>\n                            <button type="button" id="btn-kembali" class="btn btn-secondary">Kembali</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n        `}async populateBankDropdown(){const e=document.getElementById("bank");try{const t=await j();e.innerHTML='<option value="">-- Pilih Bank --</option>',t.forEach((t=>{const a=document.createElement("option");a.value=t.nama,a.textContent=`${t.nama} (${t.kode})`,e.appendChild(a)}))}catch(t){e.innerHTML='<option value="">Gagal memuat bank</option>'}}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a})}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}bindFormSubmit(e){const t=document.getElementById("form-tambah-rekening");if(t){const a=t=>{t.preventDefault();const a=document.getElementById("nama-pemilik")?.value.trim(),n=document.getElementById("no-rekening")?.value.trim(),i=document.getElementById("bank")?.value;e({namaPemilik:a,noRekening:n,bank:i})};t.addEventListener("submit",a),this.eventListeners.push({element:t,type:"submit",handler:a})}else console.error("❌ Form tidak ditemukan!")}bindBackButton(e){const t=document.getElementById("btn-kembali");if(t){const a=e;t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}}destroy(){this.removeEventListeners()}}class me{constructor(){this.view=new he,this.handleBack=this.handleBack.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this)}init(){if(this.currentUser=B(),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),this.setupEventListeners(),this.view.bindFormSubmit(this.handleFormSubmit.bind(this)),this.view.bindBackButton(this.handleBack.bind(this));else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout)}async handleFormSubmit(e){if(console.log("Data rekening disubmit:",e),!e.noRekening||!e.bank||!e.namaPemilik)return void alert("Semua field wajib diisi.");const t={no_rek:e.noRekening,nama_bank:e.bank,nama_pemilik:e.namaPemilik,id_user:this.currentUser.id_user},a=await async function(e){try{const t=await fetch(`${C}/api/rekening`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){return console.error("Gagal menyimpan rekening:",e),{success:!1,message:"Terjadi kesalahan saat menyimpan rekening"}}}(t);a.success?(alert("Rekening berhasil disimpan!"),this.handleBack()):alert("Gagal: "+a.message)}handleBack(){const e=new CustomEvent("navigate",{detail:{page:"dataRekening"}});document.dispatchEvent(e)}destroy(){console.log("Destroying TambahRekeningPresenter"),this.view&&this.view.destroy&&this.view.destroy(),document.removeEventListener("user-logout",this.handleLogout)}}var ue=a(4692);class pe{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.dataTable=null,this.disableDataTablesWarnings()}disableDataTablesWarnings(){if(void 0!==ue&&ue.fn.dataTable){ue.fn.dataTable.ext.errMode="none";const e=window.alert;window.alert=function(t){"string"==typeof t&&(t.includes("DataTables warning")||t.includes("Cannot reinitialise DataTable")||t.includes("Requested unknown parameter"))?console.warn("DataTables Warning (suppressed):",t):e.call(window,t)}}}render(){this.sidebarView.render(),this.app.innerHTML=`\n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n\n            \x3c!-- Main Content --\x3e\n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Data Master - Alamat</h2>\n                            <p class="text-dark mb-4">Input Alamat Pengiriman</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                    <div class="table-actions">\n                        <a href="#/master-alamat/tambah" class="classify-btn" data-route="tambahAlamat">\n                            <i class="bi bi-plus-circle"></i>\n                            <span class="nav-text">Tambah Alamat</span>\n                        </a>\n                    </div>\n                </header>\n\n                <div class="content-section">\n                    <div class="content-header">\n                        <h3>Daftar Alamat</h3>\n                    </div>\n\n                    \x3c!-- Loading Indicator --\x3e\n                    <div id="loading-indicator" class="text-center" style="display: none;">\n                        <div class="spinner-border text-primary" role="status">\n                            <span class="visually-hidden">Loading...</span>\n                        </div>\n                        <p class="mt-2">Memuat data alamat...</p>\n                    </div>\n\n                    \x3c!-- Error Message --\x3e\n                    <div id="error-message" class="alert alert-danger" style="display: none;"></div>\n\n                    \x3c!-- Success Message --\x3e\n                    <div id="success-message" class="alert alert-success" style="display: none;"></div>\n\n                    \x3c!-- Empty State --\x3e\n                    <div id="empty-state" class="text-center py-5" style="display: none;">\n                        <i class="bi bi-geo-alt" style="font-size: 3rem; color: #ccc;"></i>\n                        <h4 class="mt-3 text-muted">Belum Ada Alamat</h4>\n                        <p class="text-muted">Anda belum memiliki alamat yang tersimpan.</p>\n                        <a href="#/master-alamat/tambah" class="btn btn-primary">\n                            <i class="bi bi-plus-circle"></i> Tambah Alamat Pertama\n                        </a>\n                    </div>\n\n                    \x3c!-- Data Table --\x3e\n                    <div id="table-container" class="table-responsive">\n                        <table id="alamat-datatable" class="table table-striped" style="width:100%">\n                            <thead>\n                                <tr>\n                                    <th>No</th>\n                                    <th>Provinsi</th>\n                                    <th>Kabupaten/Kota</th>\n                                    <th>Kecamatan</th>\n                                    <th>Desa/Kelurahan</th>\n                                    <th>Alamat Lengkap</th>\n                                    <th>Action</th>\n                                </tr>\n                            </thead>\n                            <tbody id="alamat-table-body"></tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Confirmation Modal --\x3e\n            <div class="modal fade" id="confirmModal" tabindex="-1">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="confirmModalTitle">Konfirmasi</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body" id="confirmModalBody"></div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>\n                            <button type="button" class="btn btn-danger" id="confirmModalConfirm">Ya, Hapus</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.initDataTable(),this.setupEventListeners()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a})}bindAddAlamat(e){const t=document.querySelector('[data-route="tambahAlamat"]');if(t){const a=t=>{t.preventDefault(),e()};t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}}bindEditAlamat(e){const t=document.getElementById("table-container");if(t){const a=t=>{const a=t.target.closest(".edit-btn");if(a){t.preventDefault();const n=a.getAttribute("data-id");e(n)}};t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}}bindDeleteAlamat(e){const t=document.getElementById("table-container");if(t){const a=t=>{const a=t.target.closest(".delete-btn");if(a){t.preventDefault();const n=a.getAttribute("data-id");e(n)}};t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderAlamatData(e){const t=document.getElementById("empty-state"),a=document.getElementById("table-container");if(!e||0===e.length)return t.style.display="block",a.style.display="none",void this.destroyDataTable();t.style.display="none",a.style.display="block",this.renderAlamatTable(e)}destroyDataTable(){try{this.dataTable?(this.dataTable.destroy(),this.dataTable=null):ue.fn.DataTable.isDataTable("#alamat-datatable")&&ue("#alamat-datatable").DataTable().destroy()}catch(e){console.warn("Error destroying DataTable:",e);try{ue("#alamat-datatable").removeClass("dataTable"),ue(".dataTables_wrapper").remove()}catch(e){console.warn("Error in force cleanup:",e)}}}renderAlamatTable(e){this.destroyDataTable();const t=document.getElementById("alamat-table-body");if(!t)return;const a=e.map(((e,t)=>this.renderAlamatRow(e,t+1))).join("");t.innerHTML=a,this.initDataTable()}renderAlamatRow(e,t){return`\n            <tr>\n                <td>${t}</td>\n                <td>${e.provinsi||"-"}</td>\n                <td>${e.kabupaten||"-"}</td>\n                <td>${e.kecamatan||"-"}</td>\n                <td>${e.desa||"-"}</td>\n                <td>${e.alamat_lengkap||"-"}</td>\n                <td>\n                    <div class="btn-group" role="group">\n                        <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${e.id_alamat}">\n                            <i class="bi bi-trash"></i> Hapus\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        `}initDataTable(){try{this.destroyDataTable(),ue(document).ready((()=>{const e=ue("#alamat-datatable");0!==e.length?setTimeout((()=>{try{ue.fn.DataTable.isDataTable("#alamat-datatable")||(this.dataTable=e.DataTable({responsive:!0,retrieve:!0,destroy:!0,language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",infoEmpty:"Menampilkan 0 sampai 0 dari 0 data",infoFiltered:"(disaring dari _MAX_ total data)",emptyTable:"Tidak ada data alamat",paginate:{first:"<<",last:">>",next:">",previous:"<"}},order:[[0,"asc"]],columnDefs:[{orderable:!1,targets:-1}],processing:!1,serverSide:!1,deferRender:!0}))}catch(e){console.warn("Error initializing DataTable:",e)}}),100):console.warn("Table element not found in DOM")}))}catch(e){console.warn("Error in initDataTable:",e)}}showLoading(){const e=document.getElementById("loading-indicator"),t=document.getElementById("table-container"),a=document.getElementById("empty-state");e&&(e.style.display="block"),t&&(t.style.display="none"),a&&(a.style.display="none")}hideLoading(){const e=document.getElementById("loading-indicator");e&&(e.style.display="none")}showError(e){const t=document.getElementById("error-message");t&&(t.textContent=e,t.style.display="block",setTimeout((()=>{t.style.display="none"}),5e3))}showSuccess(e){const t=document.getElementById("success-message");t&&(t.textContent=e,t.style.display="block",setTimeout((()=>{t.style.display="none"}),3e3))}showConfirmDialog(e,t){return new Promise((a=>{const n=document.getElementById("confirmModal"),i=document.getElementById("confirmModalTitle"),s=document.getElementById("confirmModalBody"),r=document.getElementById("confirmModalConfirm");i&&(i.textContent=e),s&&(s.textContent=t);const l=new bootstrap.Modal(n);l.show();r.addEventListener("click",(()=>{l.hide(),a(!0)}),{once:!0}),n.addEventListener("hidden.bs.modal",(()=>{a(!1)}),{once:!0})}))}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying MasterAlamatView"),this.removeEventListeners(),this.destroyDataTable(),this.sidebarView&&this.sidebarView.destroy&&this.sidebarView.destroy()}}class ge{constructor(){this.apiBaseUrl="https://www.emsifa.com/api-wilayah-indonesia/api",this.backendUrl="https://greenshort-production.up.railway.app/api",this.cache={provinces:null,regencies:{},districts:{},villages:{}}}async fetchData(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(e){throw console.error("Error fetching data:",e),e}}async getProvinces(){try{if(this.cache.provinces)return this.cache.provinces;const e=await this.fetchData(`${this.apiBaseUrl}/provinces.json`);return this.cache.provinces=e,e}catch(e){throw new Error(`Failed to load provinces: ${e.message}`)}}async getRegencies(e){try{if(this.cache.regencies[e])return this.cache.regencies[e];const t=await this.fetchData(`${this.apiBaseUrl}/regencies/${e}.json`);return this.cache.regencies[e]=t,t}catch(e){throw new Error(`Failed to load regencies: ${e.message}`)}}async getDistricts(e){try{if(this.cache.districts[e])return this.cache.districts[e];const t=await this.fetchData(`${this.apiBaseUrl}/districts/${e}.json`);return this.cache.districts[e]=t,t}catch(e){throw new Error(`Failed to load districts: ${e.message}`)}}async getVillages(e){try{if(this.cache.villages[e])return this.cache.villages[e];const t=await this.fetchData(`${this.apiBaseUrl}/villages/${e}.json`);return this.cache.villages[e]=t,t}catch(e){throw new Error(`Failed to load villages: ${e.message}`)}}validateAlamatData(e){const t=[];return["provinsi","kabupaten","kecamatan","desa","alamatLengkap","latitude","longitude"].forEach((a=>{e[a]&&("string"!=typeof e[a]||e[a].trim())||t.push(`${a} is required`)})),e.latitude&&(isNaN(e.latitude)||e.latitude<-90||e.latitude>90)&&t.push("Invalid latitude value"),e.longitude&&(isNaN(e.longitude)||e.longitude<-180||e.longitude>180)&&t.push("Invalid longitude value"),{isValid:0===t.length,errors:t}}async saveAlamat(e){const t=this.validateAlamatData(e);if(!t.isValid)throw new Error(`Validation failed: ${t.errors.join(", ")}`);try{const t=JSON.parse(localStorage.getItem("currentUser"));if(!t||!t.id_user)throw new Error("User not authenticated");const a={provinsi:e.provinsi,kabupaten:e.kabupaten,kecamatan:e.kecamatan,desa:e.desa,alamat_lengkap:e.alamatLengkap,latitude:parseFloat(e.latitude),longitude:parseFloat(e.longitude),id_user:t.id_user};console.log("Sending alamat data to backend:",a);const n=await fetch(`${this.backendUrl}/alamat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await n.json();if(!n.ok)throw new Error(i.message||"Failed to save alamat");return{success:!0,message:i.message||"Alamat berhasil disimpan",data:i}}catch(e){throw console.error("Error saving alamat:",e),new Error(`Failed to save alamat: ${e.message}`)}}async getUserAlamat(e){try{const t=await fetch(`${this.backendUrl}/alamat/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch alamat");return{success:!0,data:a.data||[]}}catch(e){throw console.error("Error fetching alamat:",e),new Error(`Failed to fetch alamat: ${e.message}`)}}async deleteAlamat(e){try{const t=await fetch(`${this.backendUrl}/alamat/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to delete alamat");return{success:!0,message:a.message||"Alamat berhasil dihapus"}}catch(e){throw console.error("Error deleting alamat:",e),new Error(`Failed to delete alamat: ${e.message}`)}}async getAddresses(e){return(await this.getUserAlamat(e)).data.map((e=>({id:e.id_alamat,name:`${e.desa}, ${e.kecamatan}, ${e.kabupaten}`,address:e.alamat_lengkap})))}async getAlamatAdmin(){try{const e=await fetch(`${this.backendUrl}/admin/alamat`),t=await e.json();if(!t.success)throw new Error(t.message||"Gagal mengambil data alamat admin");return t.data}catch(e){throw console.error("Error fetching alamat admin:",e),new Error(`Failed to fetch alamat admin: ${e.message}`)}}}class be{constructor(){this.view=new pe,this.alamatModel=new ge,this.currentUser=null}async init(){try{if(this.currentUser=B(),!this.currentUser||!this.currentUser.id_user)return void console.error("User not authenticated");this.view.render(),this.view.displayUserInfo(this.currentUser),await this.loadUserAlamat(),this.view.bindAddAlamat((()=>{document.dispatchEvent(new CustomEvent("navigate",{detail:{page:"tambahAlamat"}}))})),this.bindAlamatActions()}catch(e){console.error("Error initializing MasterAlamatPresenter:",e),this.view.showError("Failed to load alamat data")}}async loadUserAlamat(){try{this.view.showLoading();const e=await this.alamatModel.getUserAlamat(this.currentUser.id_user);e.success?this.view.renderAlamatData(e.data):(console.error("Failed to load alamat data"),this.view.showError("Failed to load alamat data"))}catch(e){console.error("Error loading user alamat:",e),this.view.showError("Error loading alamat data: "+e.message)}finally{this.view.hideLoading()}}bindAlamatActions(){this.view.bindEditAlamat((async e=>{try{document.dispatchEvent(new CustomEvent("navigate",{detail:{page:"editAlamat",params:{id:e}}}))}catch(e){console.error("Error navigating to edit alamat:",e)}})),this.view.bindDeleteAlamat((async e=>{try{if(await this.view.showConfirmDialog("Hapus Alamat","Apakah Anda yakin ingin menghapus alamat ini?")){this.view.showLoading();const t=await this.alamatModel.deleteAlamat(e);t.success?(this.view.showSuccess(t.message||"Alamat berhasil dihapus"),await this.loadUserAlamat()):this.view.showError("Failed to delete alamat")}}catch(e){console.error("Error deleting alamat:",e),this.view.showError("Error deleting alamat: "+e.message)}finally{this.view.hideLoading()}}))}async refreshAlamatData(){await this.loadUserAlamat()}destroy(){this.view&&this.view.destroy()}}var ve=a(9927),ye=a(8980);class we{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.eventListeners=[],this.map=null,this.marker=null,this.currentLocation=null,this.onProvinsiChangeHandler=null,this.onKabupatenChangeHandler=null,this.onKecamatanChangeHandler=null,this.onFormSubmitHandler=null,this.onCancelHandler=null}render(){this.sidebarView.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView(),setTimeout((()=>{this.initMap()}),100)}renderMainContent(){this.app.innerHTML=`\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n            \n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Tambah Alamat</h2>\n                            <p class="text-dark mb-4">Input Alamat Pengiriman.</p>\n                        </div>\n                        \n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                </header>\n\n                <div class="alamat-section">\n                    <div class="form-section">\n                        <form id="form-alamat" class="form">\n                            \x3c!-- Row 1: Provinsi dan Kabupaten --\x3e\n                            <div class="form-row-group">\n                                <div class="form-group">\n                                    <label for="provinsi" class="form-label">Pilih Provinsi</label>\n                                    <select class="form-control" id="provinsi" name="provinsi" required>\n                                        <option value="">Loading provinsi...</option>\n                                    </select>\n                                </div>\n                                <div class="form-group">\n                                    <label for="kabupaten" class="form-label">Pilih Kabupaten/Kota</label>\n                                    <select class="form-control" id="kabupaten" name="kabupaten" required disabled>\n                                        <option value="">Pilih provinsi terlebih dahulu</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            \x3c!-- Row 2: Kecamatan dan Desa/Kelurahan --\x3e\n                            <div class="form-row-group">\n                                <div class="form-group">\n                                    <label for="kecamatan" class="form-label">Pilih Kecamatan</label>\n                                    <select class="form-control" id="kecamatan" name="kecamatan" required disabled>\n                                        <option value="">Pilih kabupaten terlebih dahulu</option>\n                                    </select>\n                                </div>\n                                <div class="form-group">\n                                    <label for="desa" class="form-label">Pilih Desa/Kelurahan</label>\n                                    <select class="form-control" id="desa" name="desa" required disabled>\n                                        <option value="">Pilih kecamatan terlebih dahulu</option>\n                                    </select>\n                                </div>\n                            </div>\n                            \n                            \x3c!-- Alamat Lengkap --\x3e\n                            <div class="form-group">\n                                <label for="alamatLengkap" class="form-label">Alamat Lengkap</label>\n                                <textarea class="form-control" id="alamatLengkap" name="alamatLengkap" rows="4" \n                                         placeholder="Masukkan alamat lengkap Anda..." required></textarea>\n                            </div>\n                            \n                            \x3c!-- Map Section --\x3e\n                            <div class="form-group">\n                                <label class="form-label">Spesifikkan Alamat Anda</label>\n                                <div class="map-container">\n                                    <div id="map" style="height: 100%; width: 100%;"></div>\n                                    <div class="map-placeholder" id="mapPlaceholder">\n                                        <div class="text-center">\n                                            <i class="fas fa-map-marker-alt fa-3x mb-3"></i>\n                                            <br>\n                                            <strong>Peta Interaktif</strong>\n                                            <br>\n                                            <small>Klik untuk menentukan lokasi tepat Anda</small>\n                                        </div>\n                                    </div>\n                                    <div class="map-controls">\n                                        <div class="map-control-btn" id="zoomIn" title="Zoom In">\n                                            <i class="fas fa-plus"></i>\n                                        </div>\n                                        <div class="map-control-btn" id="zoomOut" title="Zoom Out">\n                                            <i class="fas fa-minus"></i>\n                                        </div>\n                                        <div class="map-control-btn" id="locateMe" title="My Location">\n                                            <i class="fas fa-crosshairs"></i>\n                                        </div>\n                                    </div>\n                                </div>\n                                <input type="hidden" id="latitude" name="latitude">\n                                <input type="hidden" id="longitude" name="longitude">\n                            </div>\n                            \n                            \x3c!-- Submit Button --\x3e\n                            <div class="form-group">\n                                <button type="submit" class="btn btn-primary" id="btn-simpan">\n                                    <i class="fas fa-save me-2"></i>Simpan\n                                </button>\n                                <button type="button" id="btn-kembali" class="btn btn-secondary">Kembali</button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a}),this.setupFormEventListeners()}setupFormEventListeners(){const e=document.getElementById("provinsi");e&&this.onProvinsiChangeHandler&&(e.addEventListener("change",this.onProvinsiChangeHandler),this.eventListeners.push({element:e,type:"change",handler:this.onProvinsiChangeHandler}));const t=document.getElementById("kabupaten");t&&this.onKabupatenChangeHandler&&(t.addEventListener("change",this.onKabupatenChangeHandler),this.eventListeners.push({element:t,type:"change",handler:this.onKabupatenChangeHandler}));const a=document.getElementById("kecamatan");a&&this.onKecamatanChangeHandler&&(a.addEventListener("change",this.onKecamatanChangeHandler),this.eventListeners.push({element:a,type:"change",handler:this.onKecamatanChangeHandler}));const n=document.getElementById("form-alamat");if(n&&this.onFormSubmitHandler){const e=e=>{e.preventDefault();const t=this.validateForm();t.isValid?this.onFormSubmitHandler(e):this.showValidationErrors(t.errors)};n.addEventListener("submit",e),this.eventListeners.push({element:n,type:"submit",handler:e})}const i=document.getElementById("btn-kembali");if(i&&this.onCancelHandler){const e=e=>{e.preventDefault(),this.onCancelHandler()};i.addEventListener("click",e),this.eventListeners.push({element:i,type:"click",handler:e})}}setEventHandlers(e){this.onProvinsiChangeHandler=e.onProvinsiChange,this.onKabupatenChangeHandler=e.onKabupatenChange,this.onKecamatanChangeHandler=e.onKecamatanChange,this.onFormSubmitHandler=e.onFormSubmit,this.onCancelHandler=e.onCancel,this.setupFormEventListeners()}populateProvinces(e){const t=document.getElementById("provinsi");t&&(t.innerHTML='<option value="">Pilih Provinsi</option>',e.forEach((e=>{const a=document.createElement("option");a.value=e.id,a.textContent=e.name,t.appendChild(a)})))}populateKabupaten(e){const t=document.getElementById("kabupaten");t&&(t.innerHTML='<option value="">Pilih Kabupaten/Kota</option>',t.disabled=!1,e.forEach((e=>{const a=document.createElement("option");a.value=e.id,a.textContent=e.name,t.appendChild(a)})))}populateKecamatan(e){const t=document.getElementById("kecamatan");t&&(t.innerHTML='<option value="">Pilih Kecamatan</option>',t.disabled=!1,e.forEach((e=>{const a=document.createElement("option");a.value=e.id,a.textContent=e.name,t.appendChild(a)})))}populateDesa(e){const t=document.getElementById("desa");t&&(t.innerHTML='<option value="">Pilih Desa/Kelurahan</option>',t.disabled=!1,e.forEach((e=>{const a=document.createElement("option");a.value=e.id,a.textContent=e.name,t.appendChild(a)})))}resetKabupatenOptions(){const e=document.getElementById("kabupaten"),t=document.getElementById("kecamatan"),a=document.getElementById("desa");e&&(e.innerHTML='<option value="">Pilih provinsi terlebih dahulu</option>',e.disabled=!0),t&&(t.innerHTML='<option value="">Pilih kabupaten terlebih dahulu</option>',t.disabled=!0),a&&(a.innerHTML='<option value="">Pilih kecamatan terlebih dahulu</option>',a.disabled=!0)}resetKecamatanOptions(){const e=document.getElementById("kecamatan"),t=document.getElementById("desa");e&&(e.innerHTML='<option value="">Pilih kabupaten terlebih dahulu</option>',e.disabled=!0),t&&(t.innerHTML='<option value="">Pilih kecamatan terlebih dahulu</option>',t.disabled=!0)}resetDesaOptions(){const e=document.getElementById("desa");e&&(e.innerHTML='<option value="">Pilih kecamatan terlebih dahulu</option>',e.disabled=!0)}showLoading(e,t){const a=document.getElementById(e);a&&(a.innerHTML=`<option value="">${t}</option>`,a.disabled=!1)}showError(e,t){const a=document.getElementById(e);a&&(a.innerHTML=`<option value="">${t}</option>`)}getFormData(){return{provinsi:document.getElementById("provinsi")?.value||"",kabupaten:document.getElementById("kabupaten")?.value||"",kecamatan:document.getElementById("kecamatan")?.value||"",desa:document.getElementById("desa")?.value||"",alamatLengkap:document.getElementById("alamatLengkap")?.value||"",latitude:document.getElementById("latitude")?.value||"",longitude:document.getElementById("longitude")?.value||"",provinsiText:this.getSelectedText("provinsi"),kabupatenText:this.getSelectedText("kabupaten"),kecamatanText:this.getSelectedText("kecamatan"),desaText:this.getSelectedText("desa")}}getSelectedText(e){const t=document.getElementById(e);return t?.selectedOptions[0]?.text||""}validateForm(){const e=[];[{id:"provinsi",label:"Provinsi"},{id:"kabupaten",label:"Kabupaten/Kota"},{id:"kecamatan",label:"Kecamatan"},{id:"desa",label:"Desa/Kelurahan"},{id:"alamatLengkap",label:"Alamat Lengkap"},{id:"latitude",label:"Koordinat (klik pada peta)"},{id:"longitude",label:"Koordinat (klik pada peta)"}].forEach((({id:t,label:a})=>{const n=document.getElementById(t);n?.value?.trim()?n?.classList.remove("is-invalid"):(e.push(`${a} harus diisi`),n?.classList.add("is-invalid"))}));const t=document.getElementById("latitude")?.value,a=document.getElementById("longitude")?.value;return t&&(isNaN(t)||t<-90||t>90)&&e.push("Koordinat latitude tidak valid"),a&&(isNaN(a)||a<-180||a>180)&&e.push("Koordinat longitude tidak valid"),{isValid:0===e.length,errors:e}}showValidationErrors(e){alert("Mohon lengkapi semua field yang required:\n"+e.join("\n"))}showSuccess(e){alert(e)}showErrorMessage(e){alert(`Error: ${e}`)}setFormLoading(e){const t=document.getElementById("btn-simpan"),a=document.getElementById("form-alamat");e?(t&&(t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i>Menyimpan...'),a&&(a.style.opacity="0.7")):(t&&(t.disabled=!1,t.innerHTML='<i class="fas fa-save me-2"></i>Simpan'),a&&(a.style.opacity="1"))}showSuccessMessage(e){this.showSuccess(e)}showSubmitLoading(e){this.setFormLoading(e)}clearForm(){const e=document.getElementById("form-alamat");e&&(e.reset(),this.resetKabupatenOptions(),document.getElementById("latitude").value="",document.getElementById("longitude").value="",this.marker&&(this.map.removeLayer(this.marker),this.marker=null),e.querySelectorAll(".is-invalid").forEach((e=>{e.classList.remove("is-invalid")})))}initMap(){delete s().Icon.Default.prototype._getIconUrl,s().Icon.Default.mergeOptions({iconRetinaUrl:ve,iconUrl:ve,shadowUrl:ye}),this.map=s().map("map").setView([-2.5489,118.0149],5),s().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map);const e=document.getElementById("mapPlaceholder");e&&(e.style.display="none"),this.map.on("click",(e=>{this.placeMarker(e.latlng)})),this.marker=null,this.setupMapControls()}setupMapControls(){const e=document.getElementById("zoomIn"),t=document.getElementById("zoomOut"),a=document.getElementById("locateMe");if(e){const t=()=>this.map.zoomIn();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}if(t){const e=()=>this.map.zoomOut();t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}if(a){const e=()=>this.locateUser();a.addEventListener("click",e),this.eventListeners.push({element:a,type:"click",handler:e})}}placeMarker(e){this.marker&&this.map.removeLayer(this.marker),this.marker=s().marker(e,{draggable:!0,autoPan:!0}).addTo(this.map);const t=document.getElementById("latitude"),a=document.getElementById("longitude");t&&(t.value=e.lat),a&&(a.value=e.lng),this.marker.on("dragend",(e=>{const n=e.target.getLatLng();t&&(t.value=n.lat),a&&(a.value=n.lng)})),this.map.setView(e,this.map.getZoom())}locateUser(){navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};this.placeMarker(t),this.map.setView(t,15),this.currentLocation=t}),(e=>{console.error("Error getting location:",e),alert("Tidak dapat mendapatkan lokasi Anda. Pastikan izin lokasi telah diberikan.")}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):alert("Browser Anda tidak mendukung geolocation.")}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t?.classList.contains("mobile-open")),e?(t?.classList.add("mobile-open"),a?.classList.add("active"),document.body.style.overflow="hidden"):(t?.classList.remove("mobile-open"),a?.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e?.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),this.map&&(this.map.remove(),this.map=null)}}class fe{constructor(){this.view=new we,this.model=new ge,this.user=null}async init(){try{this.user=B(),this.setupEventHandlers(),this.view.render(),this.view.displayUserInfo(this.user),await this.loadProvinces()}catch(e){console.error("Error initializing TambahAlamatPresenter:",e),this.handleError("Gagal menginisialisasi halaman tambah alamat")}}setupEventHandlers(){this.view.setEventHandlers({onProvinsiChange:()=>this.handleProvinsiChange(),onKabupatenChange:()=>this.handleKabupatenChange(),onKecamatanChange:()=>this.handleKecamatanChange(),onFormSubmit:e=>this.handleFormSubmit(e),onCancel:()=>this.handleCancel()})}async loadProvinces(){try{const e=await this.model.getProvinces();this.view.populateProvinces(e)}catch(e){console.error("Error loading provinces:",e),this.view.showError("provinsi","Error loading provinsi")}}async handleProvinsiChange(){const e=this.view.getFormData().provinsi;if(this.view.resetKabupatenOptions(),e)try{this.view.showLoading("kabupaten","Loading kabupaten...");const t=await this.model.getRegencies(e);this.view.populateKabupaten(t)}catch(e){console.error("Error loading regencies:",e),this.view.showError("kabupaten","Error loading kabupaten")}}async handleKabupatenChange(){const e=this.view.getFormData().kabupaten;if(this.view.resetKecamatanOptions(),e)try{this.view.showLoading("kecamatan","Loading kecamatan...");const t=await this.model.getDistricts(e);this.view.populateKecamatan(t)}catch(e){console.error("Error loading districts:",e),this.view.showError("kecamatan","Error loading kecamatan")}}async handleKecamatanChange(){const e=this.view.getFormData().kecamatan;if(this.view.resetDesaOptions(),e)try{this.view.showLoading("desa","Loading desa...");const t=await this.model.getVillages(e);this.view.populateDesa(t)}catch(e){console.error("Error loading villages:",e),this.view.showError("desa","Error loading desa")}}async handleFormSubmit(e){try{this.view.setFormLoading(!0);const e=this.view.validateForm();if(!e.isValid)return void this.view.showValidationErrors(e.errors);const t=this.view.getFormData(),a={provinsi:t.provinsiText,kabupaten:t.kabupatenText,kecamatan:t.kecamatanText,desa:t.desaText,alamatLengkap:t.alamatLengkap,latitude:t.latitude,longitude:t.longitude};console.log("Saving alamat data:",a);const n=await this.model.saveAlamat(a);if(!n.success)throw new Error(n.message||"Gagal menyimpan alamat");this.view.showSuccess(n.message||"Alamat berhasil disimpan!"),setTimeout((()=>{this.navigateToMasterAlamat()}),1500)}catch(e){console.error("Error saving alamat:",e),this.view.showErrorMessage(e.message||"Terjadi kesalahan saat menyimpan alamat")}finally{this.view.setFormLoading(!1)}}handleCancel(){const e=this.view.getFormData();if(Object.values(e).some((e=>"string"==typeof e?e.trim():e))){if(!confirm("Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang."))return}this.navigateToMasterAlamat()}navigateToMasterAlamat(){document.dispatchEvent(new CustomEvent("navigate",{detail:{page:"masterAlamat"}}))}handleError(e){this.view.showErrorMessage(`Error: ${e}`)}destroy(){this.view&&this.view.destroy(),this.model=null,this.user=null}}class ke{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.currentFilter="pending",this.applicationsData=[],this.currentPage=1,this.itemsPerPage=10}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView(),setTimeout((()=>{const e=document.querySelector('[data-filter="pending"]');e&&e.classList.add("active")}),100)}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n      \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        \x3c!-- Header Section --\x3e\n        <header>\n          <div class="header-section">\n            <div class="dashboard-title">\n              <div class="title-content">\n                <h1>Dashboard</h1>\n                <p>Ringkasan status pengajuan Anda secara real-time.</p>\n              </div>\n              <div class="user-profile">\n                <img id="user-avatar" src="${W}" alt="User">\n                <span id="user-name">Loading...</span>\n              </div>\n            </div>\n\n            \x3c!-- Stats Grid --\x3e\n            <div class="stats-grid">\n              ${this.renderStatCard("0","Semua","bi-hourglass-split","yellow-bg","#/dashboard")}\n              ${this.renderStatCard("0","Pengajuan","bi-clipboard-check","blue-bg","#/pengajuan")}\n              ${this.renderStatCard("0","Penawaran","bi-x-circle","red-bg","#/penawaran")}\n              ${this.renderStatCard("0","Pengiriman","bi-truck","orange-bg","#/pengiriman")}\n              ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesai")}\n            </div>\n          </div>\n        </header>\n        \n        \x3c!-- Data Section --\x3e\n        <div class="data-section">\n          <div class="section-header">\n            <h2 class="section-title">Data Pengajuan</h2>\n          </div>\n          <div class="d-flex justify-content-end mb-2">\n          <button id="refresh-btn" class="btn btn-outline-success">\n            <i class="bi bi-arrow-clockwise"></i> Refresh Data\n          </button>\n        </div>\n          \x3c!-- Filter Tabs --\x3e\n          <div class="filter-tabs">\n            <button class="filter-tab" data-filter="pending">\n              Menunggu Validasi <span class="badge bg-light text-dark ms-1" id="badge-pending">16</span>\n            </button>\n            <button class="filter-tab" data-filter="accepted">\n              Diterima <span class="badge bg-light text-dark ms-1" id="badge-accepted">8</span>\n            </button>\n            <button class="filter-tab" data-filter="rejected">\n              Ditolak <span class="badge bg-light text-dark ms-1" id="badge-rejected">12</span>\n            </button>\n          </div>\n\n          \x3c!-- Table Container --\x3e\n          <div class="table-container">\n            <div class="table-responsive">\n              <table class="table" id="datatable">\n                <thead>\n                  <tr>\n                    <th><input type="checkbox" id="select-all" class="form-check-input"></th>\n                    <th>Nama</th>\n                    <th>No HP</th>\n                    <th>Kategori Sampah</th>\n                    <th>Gambar</th>\n                    <th>Berat</th>\n                    <th id="action-header">Action</th>\n                  </tr>\n                </thead>\n                <tbody id="applications-table-body">\n                  \x3c!-- Dynamic content will be inserted here --\x3e\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          \x3c!-- Empty State --\x3e\n          <div class="empty-state" id="empty-state" style="display: none;">\n            <i class="bi bi-inbox"></i>\n            <h4>Tidak ada data</h4>\n            <p>Belum ada pengajuan dengan status yang dipilih.</p>\n          </div>\n\n          \x3c!-- Pagination --\x3e\n          <div class="pagination-container" id="pagination-container">\n            <nav>\n              <ul class="pagination" id="pagination-list">\n                \x3c!-- Pagination will be generated dynamically --\x3e\n              </ul>\n            </nav>\n          </div>\n        </div>\n      </div>\n    `}renderStatCard(e,t,a,n,i){return`\n      <div class="stat-card">\n        <div class="stat-content">\n          <div class="stat-number">${e}</div>\n          <div class="stat-label">${t}</div>\n        </div>\n        <div class="stat-icon ${n}">\n          <i class="bi ${a}"></i>\n        </div>\n        <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n          <i class="bi bi-arrow-down"></i>\n        </a>\n      </div>\n    `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}document.querySelectorAll(".filter-tab").forEach((e=>{const t=e=>this.handleFilterTab(e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}));document.querySelectorAll(".stat-card").forEach((e=>{const t=()=>this.handleStatCardClick(e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}))}handleFilterTab(e){e.preventDefault(),document.querySelectorAll(".filter-tab").forEach((e=>e.classList.remove("active")));const t=e.target.closest(".filter-tab");if(t){t.classList.add("active");const e=t.dataset.filter;this.currentFilter=e,this.currentPage=1;const a=new CustomEvent("filter-change",{detail:{filterType:"status",filterValue:e}});document.dispatchEvent(a)}}getCurrentDisplayData(){if(!this.applicationsData||0===this.applicationsData.length)return[];let e;e="all"===this.currentFilter?this.applicationsData:this.applicationsData.filter((e=>{const t=e.statusOriginal===this.currentFilter,a=this.mapStatusToOriginal(e.status)===this.currentFilter;return t||a}));const t=(this.currentPage-1)*this.itemsPerPage,a=t+this.itemsPerPage;return e.slice(t,a)}handleStatCardClick(e){const t=e.dataset.status;if(t){const e=document.querySelector(`[data-filter="${t}"]`);e&&e.click()}}searchApplications(e){if(!e||""===e.trim())return void this.renderFilteredTable();const t=document.getElementById("applications-table-body"),a=document.getElementById("empty-state"),n=e.toLowerCase();let i=this.applicationsData.filter((e=>{let t=!0;if("all"!==this.currentFilter){const a=e.statusOriginal===this.currentFilter,n=this.mapStatusToOriginal(e.status)===this.currentFilter;t=a||n}const a=e.name&&e.name.toLowerCase().includes(n)||e.phone&&e.phone.toLowerCase().includes(n)||e.category&&e.category.toLowerCase().includes(n);return t&&a}));if(0===i.length)return t&&(t.innerHTML=""),a&&(a.style.display="block",a.querySelector("p").textContent=`Tidak ada data yang cocok dengan pencarian "${e}"`),void this.hidePagination();a&&(a.style.display="none",a.querySelector("p").textContent="Belum ada pengajuan dengan status yang dipilih."),this.currentPage=1;const s=(this.currentPage-1)*this.itemsPerPage,r=s+this.itemsPerPage,l=i.slice(s,r).map((e=>this.renderApplicationRow(e))).join("");t&&(t.innerHTML=l),this.setupRowEventListeners(),this.renderPagination(i.length)}renderFilteredTable(){const e=document.getElementById("applications-table-body"),t=document.getElementById("empty-state");if(console.log("Rendering filtered table. Current filter:",this.currentFilter),console.log("Applications data:",this.applicationsData),!this.applicationsData||0===this.applicationsData.length)return e&&(e.innerHTML=""),t&&(t.style.display="block"),void this.hidePagination();let a=this.currentFilter;"pending"===a?a="pengajuan":"accepted"===a?a="pengajuan diterima":"rejected"===a&&(a="pengajuan ditolak");let n=this.applicationsData.filter((e=>e.statusOriginal===a));const i="pending"===this.currentFilter,s=document.getElementById("action-header");if(s&&(s.style.display=i?"":"none"),console.log("Filtered data length:",n.length),0===n.length)return e&&(e.innerHTML=""),t&&(t.style.display="block"),void this.hidePagination();t&&(t.style.display="none");const r=(this.currentPage-1)*this.itemsPerPage,l=r+this.itemsPerPage,o=n.slice(r,l).map((e=>this.renderApplicationRow(e))).join("");e&&(e.innerHTML=o),this.setupRowEventListeners(),this.renderPagination(n.length)}mapStatusToOriginal(e){return{"Menunggu Validasi":"pengajuan",Diterima:"pengajuan diterima",Ditolak:"pengajuan ditolak"}[e]||e}renderApplicationRow(e){const{statusClass:t,statusIcon:a,statusLabel:n}=this.getStatusStyles(e.status),i="Menunggu Validasi"===e.status;return`\n    <tr>\n      <td><input type="checkbox" class="form-check-input row-checkbox" value="${e.id}"></td>\n      <td>${e.name||"N/A"}</td>\n      <td>${e.phone||"N/A"}</td>\n      <td>${e.category||"N/A"}</td>\n      <td><img src="${e.image||"https://via.placeholder.com/50"}" alt="Sampah" class="waste-img"></td>\n      <td>${e.weight||0} kg</td>\n      ${i?`\n        <td>\n          <a href="#/form-penawaran?id=${e.id}" \n            class="btn btn-success action-btn btn-sm accept-btn" \n            data-id="${e.id}">\n            <i class="bi bi-check-circle"></i> Diterima\n          </a>\n          <a href="#/form-penolakan?id=${e.id}" class="btn btn-danger action-btn btn-sm reject-btn" data-id="${e.id}">\n            <i class="bi bi-x-circle"></i> Ditolak\n          </a>\n        </td>\n      `:""}\n    </tr>\n  `}getStatusStyles(e){return{"Menunggu Validasi":{class:"pending",icon:"bi-hourglass-split",label:"Menunggu Validasi"},Diterima:{class:"accepted",icon:"bi-clipboard-check",label:"Diterima"},Ditolak:{class:"rejected",icon:"bi-x-circle",label:"Ditolak"},pending:{class:"pending",icon:"bi-hourglass-split",label:"Menunggu Validasi"},accepted:{class:"accepted",icon:"bi-clipboard-check",label:"Diterima"},rejected:{class:"rejected",icon:"bi-x-circle",label:"Ditolak"}}[e]||{class:"pending",icon:"bi-hourglass-split",label:e||"Unknown"}}setupRowEventListeners(){document.querySelectorAll(".detail-btn").forEach((e=>{const t=e=>this.handleDetailClick(e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}));document.querySelectorAll(".row-checkbox").forEach((e=>{const t=()=>this.updateSelectAllState();e.addEventListener("change",t),this.eventListeners.push({element:e,type:"change",handler:t})}));document.querySelectorAll(".accept-btn").forEach((e=>{const t=t=>{t.preventDefault();const a=e.dataset.id;a?window.location.href=`#/form-penawaran?id=${a}`:alert("ID pengajuan tidak ditemukan.")};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}))}handleDetailClick(e){const t=e.target.closest(".detail-btn").dataset.id,a=new CustomEvent("show-application-detail",{detail:{id:t}});document.dispatchEvent(a)}renderPagination(e){const t=Math.ceil(e/this.itemsPerPage),a=document.getElementById("pagination-list"),n=document.getElementById("pagination-container");if(!a||!n)return void console.warn("Pagination elements not found");if(t<=1||0===e)return void(n.style.display="none");n.style.display="flex";let i="";i+=`\n      <li class="page-item ${1===this.currentPage?"disabled":""}">\n        <a class="page-link" href="#" data-page="${this.currentPage-1}">\n          <i class="bi bi-chevron-left"></i>\n        </a>\n      </li>\n    `;const s=Math.max(1,this.currentPage-2),r=Math.min(t,this.currentPage+2);s>1&&(i+='<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>',s>2&&(i+='<li class="page-item disabled"><span class="page-link">...</span></li>'));for(let e=s;e<=r;e++)i+=`\n        <li class="page-item ${e===this.currentPage?"active":""}">\n          <a class="page-link" href="#" data-page="${e}">${e}</a>\n        </li>\n      `;r<t&&(r<t-1&&(i+='<li class="page-item disabled"><span class="page-link">...</span></li>'),i+=`<li class="page-item"><a class="page-link" href="#" data-page="${t}">${t}</a></li>`),i+=`\n      <li class="page-item ${this.currentPage===t?"disabled":""}">\n        <a class="page-link" href="#" data-page="${this.currentPage+1}">\n          <i class="bi bi-chevron-right"></i>\n        </a>\n      </li>\n    `,a.innerHTML=i;a.querySelectorAll("a.page-link").forEach((e=>{const t=e=>this.handlePaginationClick(e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}))}handlePaginationClick(e){e.preventDefault();const t=e.target.closest("a");if(!t||!t.dataset.page)return;const a=parseInt(t.dataset.page);isNaN(a)||a<1||a===this.currentPage||(this.currentPage=a,this.renderFilteredTable())}hidePagination(){const e=document.getElementById("pagination-container");e&&(e.style.display="none")}updateTabBadges(e){if(!Array.isArray(e))return;const t={pending:0,accepted:0,rejected:0};e.forEach((e=>{const a=e.statusOriginal?.toLowerCase();"pengajuan"===a?t.pending++:"pengajuan diterima"===a?t.accepted++:"pengajuan ditolak"===a&&t.rejected++}));const a=document.getElementById("badge-pending"),n=document.getElementById("badge-accepted"),i=document.getElementById("badge-rejected");a&&(a.textContent=t.pending),n&&(n.textContent=t.accepted),i&&(i.textContent=t.rejected)}updateSelectAllState(){const e=document.getElementById("select-all"),t=document.querySelectorAll(".row-checkbox"),a=document.querySelectorAll(".row-checkbox:checked");e&&(e.indeterminate=a.length>0&&a.length<t.length,e.checked=t.length>0&&a.length===t.length)}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll(".row-checkbox").forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("dashboard-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}displayApplications(e){this.renderApplicationsTable(e)}displayStatistics(e){if(e){const t=document.querySelectorAll(".stat-number");t.length>=5&&(t[0].textContent=e.total||"0",t[1].textContent=e.pending||"0",t[2].textContent=e.rejected||"0",t[3].textContent=e.shipped||"0",t[4].textContent=e.completed||"0")}}showError(e){console.error(e),alert(e)}showSuccess(e){const t=`\n        <div class="alert alert-success alert-dismissible fade show" role="alert">\n            <i class="bi bi-check-circle me-2"></i>\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        </div>\n    `,a=document.querySelector(".card-body");a&&a.insertAdjacentHTML("afterbegin",t),window.location.href="#/selesai"}renderApplicationsTable(e){console.log("Rendering applications table with data:",e),Array.isArray(e)?this.applicationsData=e.map((e=>({...e,statusOriginal:e.statusOriginal||this.mapStatusToOriginal(e.status)||"pending"}))):(console.warn("Applications data is not an array:",e),this.applicationsData=[]),console.log("Applications data set to:",this.applicationsData.length,"items"),this.currentPage=1,this.updateTabBadges(),this.renderFilteredTable(),console.log("Table rendered successfully")}resetFilters(){this.currentFilter="pending",this.currentPage=1,document.querySelectorAll(".filter-tab").forEach((e=>{e.classList.remove("active")}));const e=document.querySelector('[data-filter="pending"]');e&&e.classList.add("active"),this.renderFilteredTable()}renderDashboardData(e){this.renderApplicationsTable(e)}getSelectedApplications(){const e=document.querySelectorAll(".row-checkbox:checked");return Array.from(e).map((e=>e.value))}clearSelection(){const e=document.querySelectorAll(".row-checkbox"),t=document.getElementById("select-all");e.forEach((e=>e.checked=!1)),t&&(t.checked=!1)}setFilter(e){const t=document.querySelector(`[data-filter="${e}"]`);t&&t.click()}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners()}}class Ee{constructor(){this.baseUrl="https://greenshort-production.up.railway.app/api"}async getApplicationsByStatus(e){try{const t=await fetch(`${this.baseUrl}/pengajuan/status/${e}`),a=await t.json();if(!a.success||!Array.isArray(a.data))throw new Error("Respon dari server tidak valid");return a.data.map((e=>({id:e.id,name:e.name||"N/A",phone:e.phone||"-",category:e.category||e.jenis_sampah||"N/A",weight:e.weight||e.berat||0,image:e.image?`${this.baseUrl.replace("/api","")}${e.image}`:"https://via.placeholder.com/100"})))}catch(e){return console.error("Fetch error:",e),[]}}async getApplicationById(e){const t=await fetch(`${this.baseUrl}/pengajuan/id/${e}`),a=await t.json();if(!a.success||!a.data)throw new Error("Gagal mengambil data pengajuan");const n=a.data;return{id:n.id,name:n.name||"N/A",phone:n.phone||"-",category:n.category||n.jenis_sampah||"N/A",weight:n.weight||n.berat||0,image:n.image?`${this.baseUrl.replace("/api","")}${n.image}`:"https://via.placeholder.com/100"}}async submitOffer({applicationId:e,alamatId:t,hargaPerKg:a}){try{const n=await fetch(`${this.baseUrl}/pengajuan/terima/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({alamat_id:t,harga_per_kg:a})}),i=await n.json();if(!i.success)throw new Error(i.message);return i}catch(e){return console.error("Error submitting offer:",e),{success:!1,message:e.message}}}async rejectApplication({applicationId:e,reason:t}){try{const a=await fetch(`${this.baseUrl}/pengajuan/tolak/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:t})}),n=await a.json();if(!n.success)throw new Error(n.message);return n}catch(e){return console.error("Error rejecting application:",e),{success:!1,message:e.message}}}async getDashboardStats(){try{const e=await fetch(`${this.baseUrl}/dashboard-admin/stats`),t=await e.json();return t.success?t.data:null}catch(e){return console.error("Gagal ambil data dashboard-admin stats:",e),null}}}class Le{constructor(){this.view=new ke,this.pengajuanModel=new Ee,this.currentUser=null,this.sidebarView=new r.A,this.applications=[],this.handleLogout=this.handleLogout.bind(this),this.handleStatusUpdate=this.handleStatusUpdate.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this)}async init(){if(this.currentUser=B(),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),await this.updateStatistics(),await this.loadApplications(),this.setupEventListeners();else{const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadApplications(){try{const e=["pengajuan","pengajuan diterima","pengajuan ditolak","penawaran diterima","penawaran ditolak","selesai"];let t=[];for(const a of e){const e=await this.pengajuanModel.getApplicationsByStatus(a);t=[...t,...e.map((e=>({...e,statusOriginal:a,status:this.mapStatus(a)})))]}this.allApplications=t,this.view.updateTabBadges(t);let a="pengajuan";"accepted"===this.view.currentFilter?a="pengajuan diterima":"rejected"===this.view.currentFilter&&(a="pengajuan ditolak");const n=t.filter((e=>e.statusOriginal===a));this.applications=n,this.view.renderApplicationsTable(this.applications),this.updateStatistics()}catch(e){console.error("Error loading applications:",e),this.applications=[],this.view.renderApplicationsTable([]),this.view.showError("Gagal memuat data.")}}async refreshApplications(){console.log("Refreshing applications..."),await this.loadApplications()}async updateApplicationStatus(e,t){try{this.pengajuanModel.updateApplicationStatus&&await this.pengajuanModel.updateApplicationStatus(e,t);const a=this.applications.findIndex((t=>t.id===e));if(-1===a)throw new Error("Pengajuan tidak ditemukan");this.applications[a].statusOriginal=t,this.applications[a].status=this.mapStatus(t),this.view.renderApplicationsTable(this.applications),this.updateStatistics(),this.view.showSuccess(`Status berhasil diperbarui menjadi "${this.mapStatus(t)}"`)}catch(e){console.error("Error updating application status:",e),this.view.showError(`Gagal memperbarui status: ${e.message}`)}}mapStatus(e){return{pengajuan:"Menunggu Validasi","pengajuan diterima":"Diterima","pengajuan ditolak":"Ditolak"}[e]||e}async updateStatistics(){try{const e=await this.pengajuanModel.getDashboardStats();e&&this.view.displayStatistics({total:e.total,pending:e.pengajuan,rejected:e.penawaran,shipped:e.pengiriman,completed:e.selesai})}catch(e){console.error("Error updating statistics:",e)}}handleFilterChange(e,t){"status"===e&&(this.view.currentFilter=t,this.view.currentPage=1,this.loadApplications())}handleStatusUpdate(e,t){const a=this.applications.findIndex((t=>t.id===e));-1!==a?(this.applications[a].status=t,this.view.displayApplications(this.applications),this.updateStatistics(),this.view.showSuccess(`Status berhasil diperbarui menjadi "${t}"`)):this.view.showError("Pengajuan tidak ditemukan")}getApplicationById(e){return this.applications.find((t=>t.id===e))}setupEventListeners(){document.removeEventListener("user-logout",this.handleLogout),document.removeEventListener("filter-change",this.handleFilterChangeEvent),document.removeEventListener("status-update",this.handleStatusUpdateEvent),document.removeEventListener("refresh-applications",this.handleRefreshApplications),this.handleFilterChangeEvent=e=>{this.handleFilterChange(e.detail.filterType,e.detail.filterValue)},this.handleStatusUpdateEvent=e=>{this.handleStatusUpdate(e.detail.id,e.detail.status)},this.handleRefreshApplications=()=>{this.refreshApplications()},document.addEventListener("user-logout",this.handleLogout),document.addEventListener("filter-change",this.handleFilterChangeEvent),document.addEventListener("status-update",this.handleStatusUpdateEvent),document.addEventListener("refresh-applications",this.handleRefreshApplications),document.addEventListener("dashboard-refresh",this.handleRefreshApplications)}handleLogout(){this.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}destroy(){document.removeEventListener("user-logout",this.handleLogout),this.handleFilterChangeEvent&&document.removeEventListener("filter-change",this.handleFilterChangeEvent),this.handleStatusUpdateEvent&&document.removeEventListener("status-update",this.handleStatusUpdateEvent),this.handleRefreshApplications&&document.removeEventListener("refresh-applications",this.handleRefreshApplications),this.view&&this.view.destroy&&this.view.destroy(),this.applications=[],this.rawApplications=[],this.currentUser=null}}var xe=a(4692);class Se{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.currentFilter="pending",this.applicationsData=[],this.dataTable=null}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView(),this.initializeDefaultFilter()}renderMainContent(){this.app.innerHTML=`\n        <button id="mobile-menu-toggle" class="mobile-menu-btn">\n            <i class="bi bi-list"></i>\n        </button>\n        <div class="sidebar-overlay"></div>\n        \n        <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n            \x3c!-- Header Section --\x3e\n            <header>\n            <div class="header-section">\n                <div class="dashboard-title">\n                <div class="title-content">\n                    <h1>Dashboard</h1>\n                    <p>Ringkasan status pengiriman Anda secara real-time.</p>\n                </div>\n                <div class="user-profile">\n                    <img id="user-avatar" src="${W}" alt="User">\n                    <span id="user-name">Loading...</span>\n                </div>\n                </div>\n\n                \x3c!-- Stats Grid --\x3e\n                <div class="stats-grid">\n                    ${this.renderStatCard("0","Semua","bi-hourglass-split","yellow-bg","#/dashboard")}\n                    ${this.renderStatCard("0","Pengajuan","bi-clipboard-check","blue-bg","#/pengajuan")}\n                    ${this.renderStatCard("0","Penawaran","bi-x-circle","red-bg","#/penawaran")}\n                    ${this.renderStatCard("0","Pengiriman","bi-truck","orange-bg","#/pengiriman")}\n                    ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesai")}\n                </div>\n            </div>\n            </header>\n            \n            \x3c!-- Data Section --\x3e\n            <div class="data-section">\n            <div class="section-header">\n                <h2 class="section-title">Data Pengiriman</h2>\n            </div>\n\n            \x3c!-- Table Container --\x3e\n            <div class="table-container">\n                <div class="table-responsive">\n                <table class="table table-striped" id="datatable" style="width:100%">\n                    <thead>\n                    <tr>\n                    <th>Nama</th>\n                    <th>Kategori</th>\n                    <th>Tanggal</th>\n                    <th>Pengiriman</th>\n                    <th>Alamat Penjual</th>\n                    <th>Alamat Admin</th>\n                    <th>Action</th>\n                    </tr>\n                </thead>\n                    <tbody id="applications-table-body">\n                    \x3c!-- Dynamic content will be inserted here --\x3e\n                    </tbody>\n                </table>\n                </div>\n            </div>\n\n            \x3c!-- Empty State --\x3e\n            <div class="empty-state" id="empty-state" style="display: none;">\n                <i class="bi bi-inbox"></i>\n                <h4>Tidak ada data</h4>\n                <p>Belum ada Pengiriman dengan status yang dipilih.</p>\n            </div>\n            </div>\n        </div>\n        `}renderStatCard(e,t,a,n,i){return`\n        <div class="stat-card">\n            <div class="stat-content">\n            <div class="stat-number">${e}</div>\n            <div class="stat-label">${t}</div>\n            </div>\n            <div class="stat-icon ${n}">\n            <i class="bi ${a}"></i>\n            </div>\n            <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n            <i class="bi bi-arrow-down"></i>\n            </a>\n        </div>\n        `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}document.querySelectorAll(".filter-tab").forEach((e=>{const t=e=>this.handleFilterTab(e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}));document.querySelectorAll(".stat-card").forEach((e=>{const t=()=>this.handleStatCardClick(e);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}))}handleFilterTab(e){e.preventDefault(),document.querySelectorAll(".filter-tab").forEach((e=>e.classList.remove("active"))),e.target.classList.add("active");const t=e.target.dataset.filter;this.currentFilter=t,console.log("Filter tab clicked:",t),this.applyDataTableFilter()}refreshData(){console.log("Refreshing table data..."),this.applicationsData&&this.applicationsData.length>0&&this.renderApplicationsTable(this.applicationsData)}handleStatCardClick(e){const t=e.dataset.status;if(t){const e=document.querySelector(`[data-filter="${t}"]`);e&&e.click()}}applyDataTableFilter(){if(this.dataTable)try{this.dataTable.search("").columns().search(""),"pending"===this.currentFilter?this.dataTable.column(8).search("^(pending|Dijemput)$",!0,!1):"accepted"===this.currentFilter?this.dataTable.column(8).search("^(accepted|Diantar)$",!0,!1):this.dataTable.column(8).search(""),this.dataTable.draw(),console.log("Filter applied:",this.currentFilter)}catch(e){console.error("Error applying DataTable filter:",e)}else console.log("DataTable not initialized, cannot apply filter")}getFilterStatusLabel(e){return{pending:"Dijemput",accepted:"Diantar"}[e]||""}renderApplicationRow(e){const t="dijemput"===e.opsi_pengiriman?e.alamat_user:"-",a="antar sendiri"===e.opsi_pengiriman?e.alamat_admin:"-";return`\n  <tr>\n    <td>${e.nama}</td>\n    <td>${e.kategori_sampah}</td>\n    <td>${e.tanggal_akhir?new Date(e.tanggal_akhir).toLocaleDateString("id-ID"):"-"}</td>\n    <td>${e.opsi_pengiriman}</td>\n    <td>${t}</td>\n    <td>${a}</td>\n    <td>\n    <div class="btn-group">\n        <a class="btn btn-sm btn-success" href="#/form-selesai?id=${e.id}" title="Selesaikan Transaksi">\n        <i class="bi bi-check2-circle">Selesai</i>\n        </a>\n    </div>\n    </td>\n  </tr>\n`}getStatusStyles(e){return{pending:{class:"bg-warning text-dark",icon:"bi-hourglass-split",label:"Dijemput"},accepted:{class:"bg-info text-white",icon:"bi-truck",label:"Diantar"},rejected:{class:"bg-danger text-white",icon:"bi-x-circle",label:"Ditolak"},shipped:{class:"bg-primary text-white",icon:"bi-truck",label:"Dikirim"},completed:{class:"bg-success text-white",icon:"bi-check-circle",label:"Selesai"},Dijemput:{class:"bg-warning text-dark",icon:"bi-hourglass-split",label:"Dijemput"},Diantar:{class:"bg-info text-white",icon:"bi-truck",label:"Diantar"},Ditolak:{class:"bg-danger text-white",icon:"bi-x-circle",label:"Ditolak"},Dikirim:{class:"bg-primary text-white",icon:"bi-truck",label:"Dikirim"},Selesai:{class:"bg-success text-white",icon:"bi-check-circle",label:"Selesai"}}[e]||{class:"bg-secondary text-white",icon:"bi-hourglass-split",label:e||"Unknown"}}initDataTable(){if(document.getElementById("datatable")){xe.fn.DataTable.isDataTable("#datatable")&&xe("#datatable").DataTable().destroy();try{this.dataTable=xe("#datatable").DataTable({responsive:!0,pageLength:10,lengthMenu:[[10,25,50,100],[10,25,50,100]],order:[[2,"desc"]],language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",infoEmpty:"Tidak ada data yang tersedia",infoFiltered:"(difilter dari _MAX_ total data)",zeroRecords:"Tidak ada data yang cocok",emptyTable:"Tidak ada data yang tersedia",paginate:{first:"<<",last:">>",next:">",previous:"<"}}}),setTimeout((()=>{this.applyDataTableFilter()}),100),console.log("DataTable initialized successfully")}catch(e){console.error("Error initializing DataTable:",e)}}else setTimeout((()=>this.initDataTable()),100)}initializeDefaultFilter(){setTimeout((()=>{const e=document.querySelector('[data-filter="pending"]');e&&(document.querySelectorAll(".filter-tab").forEach((e=>{e.classList.remove("active")})),e.classList.add("active"),this.currentFilter="pending",console.log("Default filter set to pending"))}),200)}setupRowEventListeners(){document.querySelectorAll(".detail-btn, .complete-btn, .row-checkbox").forEach((e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)})),document.querySelectorAll(".detail-btn").forEach((e=>{e.addEventListener("click",(e=>this.handleDetailClick(e)))})),document.querySelectorAll(".complete-btn").forEach((e=>{e.addEventListener("click",(e=>this.handleCompleteClick(e)))}));document.querySelectorAll(".row-checkbox").forEach((e=>{e.addEventListener("change",(()=>this.updateSelectAllState()))}))}handleDetailClick(e){const t=e.target.closest(".detail-btn").dataset.id,a=new CustomEvent("show-application-detail",{detail:{id:t}});document.dispatchEvent(a)}handleCompleteClick(e){const t=e.target.closest(".complete-btn").dataset.id,a=new CustomEvent("complete-shipment",{detail:{id:t}});document.dispatchEvent(a)}updateTabBadges(){if(!this.applicationsData||!Array.isArray(this.applicationsData))return void console.warn("No applications data available for badge update");const e={pending:this.applicationsData.filter((e=>"pending"===e.status||"Dijemput"===e.status)).length,accepted:this.applicationsData.filter((e=>"accepted"===e.status||"Diantar"===e.status)).length};console.log("Badge counts:",e);const t=document.getElementById("badge-pending"),a=document.getElementById("badge-accepted");t&&(t.textContent=e.pending),a&&(a.textContent=e.accepted)}updateSelectAllState(){const e=document.getElementById("select-all"),t=document.querySelectorAll(".row-checkbox"),a=document.querySelectorAll(".row-checkbox:checked");e&&(e.indeterminate=a.length>0&&a.length<t.length,e.checked=t.length>0&&a.length===t.length)}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll(".row-checkbox").forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("dashboard-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}displayStatistics(e){const t=document.querySelector(".stat-card:nth-child(1) .stat-number"),a=document.querySelector(".stat-card:nth-child(2) .stat-number"),n=document.querySelector(".stat-card:nth-child(3) .stat-number"),i=document.querySelector(".stat-card:nth-child(4) .stat-number"),s=document.querySelector(".stat-card:nth-child(5) .stat-number");t&&(t.textContent=e.total||"0"),a&&(a.textContent=e.pending||"0"),n&&(n.textContent=e.accepted||"0"),i&&(i.textContent=e.shipped||"0"),s&&(s.textContent=e.completed||"0")}displayApplications(e){this.renderApplicationsTable(e)}renderApplicationsTable(e){console.log("Rendering applications table with data:",e),this.applicationsData=e||[];const t=document.getElementById("applications-table-body");if(t){if(xe.fn.DataTable.isDataTable("#datatable")&&(xe("#datatable").DataTable().destroy(),this.dataTable=null),t.innerHTML="",0===this.applicationsData.length)t.innerHTML='<tr><td colspan="7" class="text-center">Tidak ada data tersedia</td></tr>',this.showEmptyState(!0);else{const e=this.applicationsData.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=e,this.showEmptyState(!1)}this.updateTabBadges(),setTimeout((()=>{0!==this.applicationsData.length?this.initDataTable():console.log("No data to initialize DataTable")}),150)}else console.error("Table body element not found")}getFilteredData(e=this.currentFilter){return this.applicationsData?this.applicationsData.filter((t=>{switch(e){case"pending":return"pending"===t.status||"Dijemput"===t.status;case"accepted":return"accepted"===t.status||"Diantar"===t.status;default:return!0}})):[]}renderDashboardData(e){this.renderApplicationsTable(e)}getSelectedApplications(){const e=document.querySelectorAll(".row-checkbox:checked");return Array.from(e).map((e=>e.value))}clearSelection(){const e=document.querySelectorAll(".row-checkbox"),t=document.getElementById("select-all");e.forEach((e=>e.checked=!1)),t&&(t.checked=!1)}setFilter(e){const t=document.querySelector(`[data-filter="${e}"]`);t&&t.click()}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}showError(e){const t=document.createElement("div");t.className="toast position-fixed top-0 end-0 m-3 bg-danger text-white",t.innerHTML=`\n        <div class="toast-body">\n            <i class="bi bi-exclamation-circle me-2"></i>\n            ${e}\n        </div>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),3e3)}showSuccess(e){const t=document.createElement("div");t.className="toast position-fixed top-0 end-0 m-3 bg-success text-white",t.innerHTML=`\n        <div class="toast-body">\n            <i class="bi bi-check-circle me-2"></i>\n            ${e}\n        </div>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),3e3)}bindAddPengiriman(e){this.addPengirimanHandler=e}bindFilterChange(e){this.filterChangeHandler=e}bindStatusUpdate(e){this.statusUpdateHandler=e}showEmptyState(e){const t=document.getElementById("empty-state"),a=document.querySelector(".table-container");t&&a&&(e?(t.style.display="block",a.style.display="none"):(t.style.display="none",a.style.display="block"))}ensureProperInitialization(){const e=["applications-table-body","badge-pending","badge-accepted","datatable"].filter((e=>!document.getElementById(e)));return!(e.length>0)||(console.warn("Missing required elements:",e),!1)}debugApplicationsData(){console.log("=== DEBUGGING APPLICATIONS DATA ==="),console.log("Current applications count:",this.applicationsData?.length||0),console.log("Applications data:",this.applicationsData),console.log("Current filter:",this.currentFilter),console.log("Table body exists:",!!document.getElementById("applications-table-body")),console.log("DataTable initialized:",!!this.dataTable)}destroy(){this.removeEventListeners(),this.dataTable&&(this.dataTable.destroy(),this.dataTable=null),xe.fn.DataTable.isDataTable("#datatable")&&xe("#datatable").DataTable().destroy()}}class De{async getApplications(){try{const e=await fetch("https://greenshort-production.up.railway.app/api/pengiriman");return(await e.json()).data||[]}catch(e){return console.error("Gagal mengambil data pengiriman:",e),[]}}async getDashboardStats(){try{const e=await fetch("https://greenshort-production.up.railway.app/api/dashboard-admin/stats"),t=await e.json();return t.success?t.data:null}catch(e){return console.error("Gagal mengambil dashboard-admin stats:",e),null}}}class Ae{constructor(){this.view=new Se,this.currentUser=null,this.pengirimanModel=new De,this.sidebarView=new r.A,this.applications=[],this.handleLogout=this.handleLogout.bind(this),this.handleAddPengiriman=this.handleAddPengiriman.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleStatusUpdate=this.handleStatusUpdate.bind(this),this.handleCompleteShipment=this.handleCompleteShipment.bind(this),this.handleShowDetail=this.handleShowDetail.bind(this)}async init(){if(console.log("Initializing PengirimanPresenter"),this.currentUser=B(),this.currentUser)try{this.view.render(),this.view.displayUserInfo(this.currentUser),this.setupEventListeners(),await this.loadApplications(),await this.updateStatistics(),this.view.bindAddPengiriman(this.handleAddPengiriman),this.view.bindStatusUpdate(this.handleStatusUpdate),console.log("✅ PengirimanPresenter initialized successfully")}catch(e){console.error("❌ Error initializing PengirimanPresenter:",e),this.view.showError("Gagal menginisialisasi halaman")}else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadApplications(){try{this.applications=await this.pengirimanModel.getApplications(),this.view.renderApplicationsTable(this.applications)}catch(e){console.error("Gagal load pengiriman:",e),this.view.showError("Gagal memuat data pengiriman")}}async updateStatistics(){try{const e=await this.pengirimanModel.getDashboardStats();e&&this.view.displayStatistics({total:e.total,pending:e.pengajuan,accepted:e.penawaran,shipped:e.pengiriman,completed:e.selesai})}catch(e){console.error("Error updating statistics:",e)}}calculateStatistics(e){if(!e||!Array.isArray(e))return{total:0,pending:0,accepted:0,shipped:0,completed:0,totalValue:"Rp. 0",wasteTypes:{}};const t=e.length,a=e.filter((e=>"pending"===e.status||"Dijemput"===e.status)).length,n=e.filter((e=>"accepted"===e.status||"Diantar"===e.status)).length,i=e.filter((e=>"shipped"===e.status||"Dikirim"===e.status)).length,s=e.filter((e=>"completed"===e.status||"Selesai"===e.status)).length,r=e.reduce(((e,t)=>e+(t.totalHarga||0)),0),l={};return e.forEach((e=>{const t=e.kategoriSampah||e.jenisSampah||"Unknown";l[t]=(l[t]||0)+1})),{total:t,pending:a,accepted:n,shipped:i,completed:s,totalValue:`Rp. ${r.toLocaleString("id-ID")}`,wasteTypes:l}}debugApplicationData(){console.log("=== DEBUGGING APPLICATION DATA ==="),console.log("Applications count:",this.applications?.length||0),console.log("First application:",this.applications?.[0]),console.log("Available statuses:",[...new Set(this.applications?.map((e=>e.status))||[])]),console.log("Model data count:",this.pengirimanModel.getAllPengiriman().length),console.log("===================================")}handleFilterChange(e,t){console.log(`Filtering by ${e}:`,t);let a=[...this.applications];if("status"===e&&"all"!==t)a=a.filter((e=>e.status===t));else if("wasteType"===e&&"all"!==t)a=a.filter((e=>(e.kategoriSampah||e.jenisSampah)===t));else if("search"===e&&""!==t.trim()){const e=t.toLowerCase();a=a.filter((t=>(t.nama||"").toLowerCase().includes(e)||(t.kategoriSampah||t.jenisSampah||"").toLowerCase().includes(e)||(t.alamat||"").toLowerCase().includes(e)))}this.view.displayApplications(a),this.view.displayStatistics(this.calculateStatistics(a))}handleStatusUpdate(e,t){console.log(`Updating status for application ${e} to ${t}`);const a=this.applications.findIndex((t=>t.id===e));-1!==a?(this.applications[a].status=t,this.pengirimanModel.updateStatusPengiriman(e,t),this.view.displayApplications(this.applications),this.updateStatistics(),this.view.showSuccess(`Status berhasil diperbarui menjadi "${t}"`)):this.view.showError("Pengiriman tidak ditemukan")}handleCompleteShipment(e){const t=e.detail.id;console.log(`Completing shipment for application ${t}`),this.handleStatusUpdate(t,"completed")}handleShowDetail(e){const t=e.detail.id;this.showApplicationDetail(t)}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout),document.addEventListener("dashboard-refresh",(async()=>{await this.refresh()})),document.addEventListener("show-application-detail",this.handleShowDetail),document.addEventListener("complete-shipment",this.handleCompleteShipment)}showApplicationDetail(e){const t=this.getApplicationById(e);if(t){const e=new CustomEvent("navigate",{detail:{page:"pengiriman-detail",data:t}});document.dispatchEvent(e)}}handleLogout(){console.log("Logout initiated from PengirimanPresenter"),this.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}handleAddPengiriman(){console.log("Navigating to add pengiriman form");const e=new CustomEvent("navigate",{detail:{page:"add-pengiriman"}});document.dispatchEvent(e)}async refresh(){console.log("Refreshing pengiriman data...");try{await this.loadApplications(),this.view.showSuccess("Data berhasil diperbarui")}catch(e){console.error("Error refreshing data:",e),this.view.showError("Gagal memperbarui data")}}getApplicationById(e){return this.applications.find((t=>t.id===e))}exportApplications(e="json"){if("json"===e)return JSON.stringify(this.applications,null,2)}destroy(){console.log("Destroying PengirimanPresenter"),document.removeEventListener("user-logout",this.handleLogout),document.removeEventListener("dashboard-refresh",this.refresh),document.removeEventListener("show-application-detail",this.handleShowDetail),document.removeEventListener("complete-shipment",this.handleCompleteShipment),this.view&&this.view.destroy&&this.view.destroy(),this.applications=[],this.currentUser=null}}var Ie=a(4692);class Ce{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n      \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Dashboard</h2>\n              <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n            </div>\n            \n            <div class="user-profile">\n              <img id="user-avatar" src="${W}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n\n          <div class="stats-grid">\n            ${this.renderStatCard("0","Semua","bi-hourglass-split","yellow-bg","#/dashboard")}\n            ${this.renderStatCard("0","Pengajuan","bi-clipboard-check","blue-bg","#/pengajuan")}\n            ${this.renderStatCard("0","Penawaran","bi-x-circle","red-bg","#/penawaran")}\n            ${this.renderStatCard("0","Pengiriman","bi-truck","orange-bg","#/pengiriman")}\n            ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesai")}\n          </div>\n        </header>\n\n        <div class="data-section">\n          <div class="data-header">\n            <h3>Data Selesai</h3>\n          </div>\n\n          <div class="table-responsive">\n            <table id="datatable" class="table table-striped" style="width:100%">\n              <thead>\n                <tr>\n                  <th><input type="checkbox" id="select-all"></th>\n                  <th>Nama</th>\n                  <th>Jenis Sampah</th>\n                  <th>Berat</th>\n                  <th>Harga</th>\n                  <th>Total Harga</th>\n                  <th>Gambar Sampah</th>\n                </tr>\n              </thead>\n              <tbody id="applications-table-body">\n                \x3c!-- Dynamic content will be inserted here --\x3e\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    `}renderStatCard(e,t,a,n,i){return`\n      <div class="stat-card">\n        <div class="stat-content">\n          <div class="stat-number">${e}</div>\n          <div class="stat-label">${t}</div>\n        </div>\n        <div class="stat-icon ${n}">\n          <i class="bi ${a}"></i>\n        </div>\n        <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n          <i class="bi bi-arrow-down"></i>\n        </a>\n      </div>\n    `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll('#applications-table-body input[type="checkbox"]').forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("selesai-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderApplicationsTable(e){const t=document.getElementById("applications-table-body");if(!t)return;const a=e.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=a,this.initDataTable()}renderApplicationRow(e){const{statusClass:t,statusIcon:a}=this.getStatusStyles(e.status);return`\n    <tr>\n      <td><input type="checkbox" class="row-checkbox" value="${e.id}"></td>\n      <td>${e.nama||"N/A"}</td>\n      <td>${e.jenisSampah||"N/A"}</td>\n      <td>${e.berat||e.kuantitas||"N/A"}</td>\n      <td>${e.harga||"N/A"}</td>\n      <td>${e.totalHarga||e.total||"N/A"}</td>\n      <td>\n      <img \n        src="${e.gambarSampah?e.gambarSampah.startsWith("/uploads/")?`https://greenshort-production.up.railway.app${e.gambarSampah}`:`https://greenshort-production.up.railway.app/uploads/${e.gambarSampah}`:"https://via.placeholder.com/50"}" \n        alt="Sampah" \n        style="width: 50px; height: 50px; object-fit: cover;"\n      >\n    </td>\n    </tr>\n  `}getStatusStyles(e){const t={Diterima:{class:"bg-info bg-opacity-10",icon:"bi-clipboard-check"},Ditolak:{class:"bg-danger bg-opacity-10",icon:"bi-x-circle"},Dikirim:{class:"bg-warning bg-opacity-10",icon:"bi-truck"},Selesai:{class:"bg-success bg-opacity-10",icon:"bi-check-circle"},default:{class:"bg-light",icon:"bi-hourglass-split"}};return t[e]||t.default}initDataTable(){Ie.fn.DataTable.isDataTable("#datatable")&&Ie("#datatable").DataTable().destroy(),Ie(document).ready((()=>{Ie("#datatable").DataTable({responsive:!0,language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",paginate:{first:"<<",last:">>",next:">",previous:"<"}}})}))}displayStatistics(e){const t=document.querySelector(".stat-card:nth-child(1) .stat-number"),a=document.querySelector(".stat-card:nth-child(2) .stat-number"),n=document.querySelector(".stat-card:nth-child(3) .stat-number"),i=document.querySelector(".stat-card:nth-child(4) .stat-number"),s=document.querySelector(".stat-card:nth-child(5) .stat-number");t&&(t.textContent=e.total||"0"),a&&(a.textContent=e.pending||"0"),n&&(n.textContent=e.rejected||"0"),i&&(i.textContent=e.shipped||"0"),s&&(s.textContent=e.completed||"0")}renderSelesaiData(e){this.renderApplicationsTable(e)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),Ie.fn.DataTable.isDataTable("#datatable")&&Ie("#datatable").DataTable().destroy()}}async function Te(){try{const e=await fetch("https://greenshort-production.up.railway.app/api/penjualan/selesai/tabel"),t=await e.json();return t.success?t.data:[]}catch(e){return console.error("❌ Error fetchSelesaiData:",e),[]}}class Me{constructor(){this.view=new Ce,this.sidebarView=new r.A,this.currentUser=null,this.handleLogout=this.handleLogout.bind(this),this.handleRefresh=this.handleRefresh.bind(this)}async init(){if(this.currentUser=B(),!this.currentUser)return void document.dispatchEvent(new CustomEvent("navigate",{detail:{page:"login"}}));this.view.render(),this.view.displayUserInfo(this.currentUser);const e=await Te();this.view.renderSelesaiData(e),await this.updateStatistics(),this.setupEventListeners()}async updateStatistics(){try{const e=await async function(){try{const e=await fetch("https://greenshort-production.up.railway.app/api/dashboard-admin/stats"),t=await e.json();return t.success?t.data:null}catch(e){return console.error("❌ Error fetchSelesaiStats:",e),null}}();e&&this.view.displayStatistics({total:e.total,pending:e.pengajuan,rejected:e.penawaran,shipped:e.pengiriman,completed:e.selesai})}catch(e){console.error("❌ Error updateStatistics:",e)}}getDummySelesaiData(){return[{id:1,nama:"John Doe",jenisSampah:"Plastik Botol",berat:"5 kg",harga:"Rp 2.000",totalHarga:"Rp 10.000",gambarSampah:"https://via.placeholder.com/100x100?text=Plastik",status:"Selesai",tanggalPembelian:"2024-01-15"},{id:2,nama:"Jane Smith",jenisSampah:"Kertas Bekas",berat:"3 kg",harga:"Rp 1.500",totalHarga:"Rp 4.500",gambarSampah:"https://via.placeholder.com/100x100?text=Kertas",status:"Selesai",tanggalPembelian:"2024-01-14"},{id:3,nama:"Bob Wilson",jenisSampah:"Kaleng Aluminium",berat:"2 kg",harga:"Rp 5.000",totalHarga:"Rp 10.000",gambarSampah:"https://via.placeholder.com/100x100?text=Kaleng",status:"Selesai",tanggalPembelian:"2024-01-13"},{id:4,nama:"Alice Brown",jenisSampah:"Kardus",berat:"7 kg",harga:"Rp 1.000",totalHarga:"Rp 7.000",gambarSampah:null,status:"Selesai",tanggalPembelian:"2024-01-12"}]}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout),document.addEventListener("selesai-refresh",this.handleRefresh)}async handleRefresh(){const e=await Te();this.view.renderSelesaiData(e)}handleLogout(){console.log("Logout initiated"),P(),this.view.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}destroy(){console.log("Destroying SelesaiPresenter"),document.removeEventListener("user-logout",this.handleLogout),document.removeEventListener("selesai-refresh",this.handleRefresh),this.view.destroy()}}var je=a(4692);class Pe{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.dataTable=null,this.baseImageUrl="https://greenshort-production.up.railway.app/uploads/"}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n            \n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                        <h2>Dashboard</h2>\n                        <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n                        </div>\n                        \n                        <div class="user-profile">\n                        <img id="user-avatar" src="${W}" alt="User">\n                        <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n            \n                    <div class="stats-grid">\n                      ${this.renderStatCard("0","Menunggu Validasi","bi-hourglass-split","yellow-bg","#/dashboardUser")}\n                      ${this.renderStatCard("0","Diterima","bi-clipboard-check","blue-bg","#/diterima")}\n                      ${this.renderStatCard("0","Ditolak","bi-x-circle","red-bg","#/ditolak")}\n                      ${this.renderStatCard("0","Penjemputan","bi-truck","orange-bg","#/penjemputan")}\n                      ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesaiUser")}\n                    </div>\n                </header>\n        \n                <div class="data-section">\n                    <div class="data-header">\n                        <h3>Data Pengajuan Diterima</h3>\n                        <button id="refresh-btn" class="btn btn-primary btn-sm">\n                            <i class="bi bi-arrow-clockwise"></i> Refresh\n                        </button>\n                    </div>\n            \n                    <div class="table-responsive">\n                        <table id="datatable" class="table table-striped" style="width:100%">\n                        <thead>\n                            <tr>\n                                <th>Gambar Sampah</th>\n                                <th>Jenis Sampah</th>\n                                <th>Berat (kg)</th>\n                                <th>Harga Tawaran</th>\n                                <th>Status</th>\n                                <th>Aksi</th>\n                            </tr>\n                        </thead>\n                        <tbody id="applications-table-body">\n                            \x3c!-- Dynamic content will be inserted here --\x3e\n                        </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        `}renderStatCard(e,t,a,n,i){return`\n      <div class="stat-card">\n        <div class="stat-content">\n          <div class="stat-number">${e}</div>\n          <div class="stat-label">${t}</div>\n        </div>\n        <div class="stat-icon ${n}">\n          <i class="bi ${a}"></i>\n        </div>\n        <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n          <i class="bi bi-arrow-down"></i>\n        </a>\n      </div>\n    `}renderApplicationsTable(e){const t=document.getElementById("applications-table-body");if(!t)return;if(!e||!Array.isArray(e))return void(t.innerHTML='\n                <tr>\n                    <td colspan="6" class="text-center py-4">\n                        <i class="bi bi-info-circle me-2"></i>\n                        Tidak ada data pengajuan yang diterima\n                    </td>\n                </tr>\n            ');const a=e.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=a,this.initDataTable(),this.setupActionListeners()}renderApplicationRow(e){const t=e.gambar_sampah?`${this.baseImageUrl}${e.gambar_sampah}`:"";return`\n      <tr data-id="${e.id||""}">\n        <td>\n          ${t?`\n            <img src="${t}" \n                 alt="Gambar Sampah" \n                 class="img-thumbnail application-image" \n                 style="width: 60px; height: 60px; object-fit: cover; cursor: pointer;"\n                 onclick="this.parentElement.querySelector('.image-modal').style.display='block'"\n                 onerror="this.src='https://via.placeholder.com/60?text=No+Image'; this.style.objectFit='contain';">\n            <div class="image-modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); cursor:pointer;" onclick="this.style.display='none'">\n              <img src="${t}" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); max-width:90%; max-height:90%; object-fit:contain;">\n            </div>\n          `:'\n            <div style="width: 60px; height: 60px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; display: flex; align-items: center; justify-content: center;">\n              <i class="bi bi-image text-muted"></i>\n            </div>\n          '}\n        </td>\n        <td>${e.jenis_sampah||e.jenisSampah}</td>\n        <td>${e.berat||"0"} kg</td>\n        <td>${(e=>{const t=parseFloat(e);return isNaN(t)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)})(e.harga||e.harga_tawaran)}</td>\n        <td>\n          <span class="badge bg-success">\n            <i class="bi bi-check-circle me-1"></i>\n            ${e.status||"Diterima"}\n          </span>\n        </td>\n        <td>\n          <div class="action-buttons d-flex">\n            <button class="btn btn-success btn-sm me-1" \n                    onclick="window.location.href='#/form-ongkir?id=${e.id}'" \n                    title="Terima">\n                <i class="bi bi-check-circle"></i> Terima\n            </button>\n            <button class="btn btn-danger btn-sm action-reject" \n                    data-id="${e.id}" data-action="reject" title="Tolak">\n              <i class="bi bi-x-circle"></i> Tolak\n            </button>\n          </div>\n        </td>\n      </tr>\n    `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}}setupActionListeners(){const e=document.getElementById("applications-table-body");e&&(this.boundActionHandler||(this.boundActionHandler=e=>{e.preventDefault();const t=e.target.closest(".action-accept, .action-reject");if(!t)return;const a=t.dataset.id,n=t.dataset.action,i=new CustomEvent("application-action",{detail:{id:a,action:n}});document.dispatchEvent(i)}),e.removeEventListener("click",this.boundActionHandler),e.addEventListener("click",this.boundActionHandler))}handleRefresh(){const e=new CustomEvent("diterima-refresh");document.dispatchEvent(e)}showSuccess(e){const t=document.createElement("div");t.className="alert alert-success alert-dismissible fade show position-fixed",t.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",t.innerHTML=`\n            <i class="bi bi-check-circle me-2"></i>\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.remove()}),3e3)}showError(e){const t=document.createElement("div");t.className="alert alert-danger alert-dismissible fade show position-fixed",t.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",t.innerHTML=`\n            <i class="bi bi-exclamation-triangle me-2"></i>\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.remove()}),5e3)}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView(),this.dataTable&&this.dataTable.columns.adjust().responsive.recalc()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}showLoadingState(){const e=document.getElementById("applications-table-body");e&&(e.innerHTML='\n                <tr>\n                    <td colspan="6" class="text-center py-4">\n                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>\n                        Memuat data pengajuan yang diterima...\n                    </td>\n                </tr>\n            ')}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}getStatusStyles(e){return{pengajuan:{class:"bg-warning bg-opacity-10 text-warning border border-warning",icon:"bi-hourglass-split"},"menunggu validasi":{class:"bg-warning bg-opacity-10 text-warning border border-warning",icon:"bi-hourglass-split"},diterima:{class:"bg-info bg-opacity-10 text-info border border-info",icon:"bi-clipboard-check"},ditolak:{class:"bg-danger bg-opacity-10 text-danger border border-danger",icon:"bi-x-circle"},penjemputan:{class:"bg-primary bg-opacity-10 text-primary border border-primary",icon:"bi-truck"},selesai:{class:"bg-success bg-opacity-10 text-success border border-success",icon:"bi-check-circle"}}[e?e.toLowerCase():""]||{class:"bg-light text-muted border",icon:"bi-question-circle"}}formatStatus(e){if(!e)return"Tidak Diketahui";return{pengajuan:"Pengajuan",diterima:"Diterima",ditolak:"Ditolak",penjemputan:"Penjemputan",selesai:"Selesai"}[e.toLowerCase()]||e}initDataTable(){if(this.dataTable&&(this.dataTable.destroy(),this.dataTable=null),void 0!==je&&je.fn.DataTable)try{this.dataTable=je("#datatable").DataTable({responsive:!0,pageLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"Semua"]],order:[[1,"asc"]],columnDefs:[{targets:[0],orderable:!1,searchable:!1,responsivePriority:1},{targets:[2,3],className:"text-end"},{targets:[4],className:"text-center"},{targets:[5],orderable:!1,searchable:!1,responsivePriority:2,className:"text-center"}],language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",infoEmpty:"Tidak ada data yang tersedia",infoFiltered:"(difilter dari _MAX_ total data)",emptyTable:"Tidak ada data pengajuan yang diterima",zeroRecords:"Tidak ditemukan data yang sesuai",paginate:{first:"<<",last:">>",next:">",previous:"<"}},drawCallback:()=>{this.setupActionListeners()}})}catch(e){console.error("Error initializing DataTable:",e)}else console.warn("jQuery DataTables not available, using basic table")}getSelectedRows(){const e=document.querySelectorAll('#applications-table-body input[type="checkbox"]:checked');return Array.from(e).map((e=>e.value))}updateStatCards(e){if(!e)return;const t=document.querySelectorAll(".stat-number");t.length>=5&&(t[0].textContent=e.menungguValidasi||"0",t[1].textContent=e.diterima||"0",t[2].textContent=e.ditolak||"0",t[3].textContent=e.penjemputan||"0",t[4].textContent=e.selesai||"0")}renderDashboardData(e,t=null){this.renderApplicationsTable(e),this.updateStatCards(t)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),this.dataTable&&(this.dataTable.destroy(),this.dataTable=null),this.sidebar&&this.sidebar.destroy()}}class Be{constructor(){this.view=new Pe,this.currentUser=null,this.handleRefresh=this.handleRefresh.bind(this),this.handleDiterimaRefresh=this.handleDiterimaRefresh.bind(this),this.handleApplicationAction=this.handleApplicationAction.bind(this)}async init(){if(console.log("Initializing DiterimaPresenter"),this.currentUser=B(),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),await this.loadAcceptedApplications(),this.setupEventListeners();else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}setupEventListeners(){document.addEventListener("dashboard-refresh",this.handleRefresh),document.addEventListener("diterima-refresh",this.handleDiterimaRefresh),document.addEventListener("application-action",this.handleApplicationAction)}async loadAcceptedApplications(){try{this.view.showLoadingState();const e=this.currentUser.id_user||this.currentUser.id;if(!e)return console.error("User ID tidak ditemukan:",this.currentUser),void this.view.showError("ID user tidak valid");console.log("Loading dashboard data for user ID:",e);const t=["pengajuan","pengajuan diterima","pengajuan ditolak","penawaran diterima","penawaran ditolak","selesai"];let a=[];for(const n of t)try{const t=await ie(e,n);t.success&&t.data&&t.data.length>0&&(a=[...a,...t.data])}catch(e){console.warn(`Error fetching data for status '${n}':`,e)}if(0===a.length)return console.log("No applications found for user"),void this.view.renderDashboardData([],this.calculateUserStats([]));const n=a.map((e=>({id:e.id,user_id:e.user_id,gambar_sampah:e.gambar_sampah,jenisSampah:e.jenis_sampah,berat:parseFloat(e.berat)||0,harga:null!==e.harga_tawaran?parseFloat(e.harga_tawaran):0,status:e.status||"pengajuan diterima"})));console.log("Transformed applications:",n);const i=this.calculateUserStats(n);console.log("Calculated stats:",i);const s=n.filter((e=>"pengajuan diterima"===e.status.toLowerCase().trim()));this.view.renderDashboardData(s,i)}catch(e){console.error("Error in loadAcceptedApplications:",e),this.view.showError("Terjadi kesalahan saat memuat dashboard")}}calculateUserStats(e){const t={menungguValidasi:0,diterima:0,ditolak:0,penjemputan:0,selesai:0};return e&&0!==e.length?(e.forEach((e=>{const a=e.status?e.status.toLowerCase().trim():"";switch(a){case"pengajuan":case"menunggu validasi":t.menungguValidasi++;break;case"pengajuan diterima":case"diterima":t.diterima++;break;case"pengajuan ditolak":case"ditolak":t.ditolak++;break;case"penawaran diterima":case"penjemputan":t.penjemputan++;break;case"selesai":case"penawaran ditolak":t.selesai++;break;default:console.warn("Unknown status:",a),t.menungguValidasi++}})),t):t}async handleApplicationAction(e){const{id:t,action:a}=e.detail;try{"accept"===a?await this.acceptApplication(t):"reject"===a&&await this.rejectApplication(t)}catch(e){console.error(`Error handling ${a} action:`,e),this.view.showError(`Gagal ${"accept"===a?"menerima":"menolak"} pengajuan`)}}async acceptApplication(e){if(confirm("Apakah Anda yakin ingin menerima pengajuan ini?"))try{this.view.showSuccess("Pengajuan berhasil diterima"),await this.loadAcceptedApplications()}catch(e){throw console.error("Error accepting application:",e),e}}async rejectApplication(e){if(confirm("Apakah Anda yakin ingin menolak tawaran ini?"))try{await async function(e){const t=await fetch(`https://greenshort-production.up.railway.app/api/penawaran/tolak/${e}`,{method:"PUT"}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.message||"Gagal menolak penawaran");return a}(e),this.view.showSuccess("Penawaran berhasil ditolak"),setTimeout((()=>{window.location.hash="#/diterima"}),1e3)}catch(e){console.error("Error rejecting penawaran:",e),this.view.showError("Gagal menolak penawaran: "+e.message)}}async handleRefresh(){console.log("Refreshing accepted applications data"),await this.loadAcceptedApplications()}async handleDiterimaRefresh(){console.log("Specific refresh for accepted applications"),await this.loadAcceptedApplications()}getSelectedApplications(){return this.view.getSelectedRows()}exportData(){const e=this.getSelectedApplications();0!==e.length?console.log("Exporting selected applications:",e):alert("Pilih data yang ingin diekspor")}handleBulkAction(e){if(0!==this.getSelectedApplications().length)switch(e){case"export":this.exportData();break;case"print":this.printSelected();break;default:console.log(`Unknown bulk action: ${e}`)}else alert("Pilih data untuk diproses")}printSelected(){const e=this.getSelectedApplications();0!==e.length?(console.log("Printing selected applications:",e),window.print()):alert("Pilih data yang ingin dicetak")}removeEventListeners(){document.removeEventListener("dashboard-refresh",this.handleRefresh),document.removeEventListener("diterima-refresh",this.handleDiterimaRefresh),document.removeEventListener("application-action",this.handleApplicationAction)}destroy(){console.log("Destroying DiterimaPresenter"),this.removeEventListeners(),this.view.destroy()}}var $e=a(4692);class Re{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.baseImageUrl="https://greenshort-production.up.railway.app/uploads/"}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n            \n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                        <h2>Dashboard</h2>\n                        <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n                        </div>\n                        \n                        <div class="user-profile">\n                        <img id="user-avatar" src="${W}" alt="User">\n                        <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n            \n                    <div class="stats-grid">\n                      ${this.renderStatCard("0","Menunggu Validasi","bi-hourglass-split","yellow-bg","#/dashboardUser")}\n                      ${this.renderStatCard("0","Diterima","bi-clipboard-check","blue-bg","#/diterima")}\n                      ${this.renderStatCard("0","Ditolak","bi-x-circle","red-bg","#/ditolak")}\n                      ${this.renderStatCard("0","Penjemputan","bi-truck","orange-bg","#/penjemputan")}\n                      ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesaiUser")}\n                    </div>\n                </header>\n        \n                <div class="data-section">\n                    <div class="data-header">\n                        <h3>Data Pengajuan Ditolak</h3>\n                    </div>\n            \n                    <div class="table-responsive">\n                        <table id="datatable" class="table table-striped" style="width:100%">\n                        <thead>\n                            <tr>\n                                <th>Gambar Sampah</th>\n                                <th>Jenis Sampah</th>\n                                <th>Berat (kg)</th>\n                                <th>Status</th>\n                                <th>Alasan Penolakan</th>\n                            </tr>\n                        </thead>\n                        <tbody id="applications-table-body">\n                            \x3c!-- Dynamic content will be inserted here --\x3e\n                        </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        `}renderStatCard(e,t,a,n,i){return`\n          <div class="stat-card">\n            <div class="stat-content">\n              <div class="stat-number">${e}</div>\n              <div class="stat-label">${t}</div>\n            </div>\n            <div class="stat-icon ${n}">\n              <i class="bi ${a}"></i>\n            </div>\n            <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n              <i class="bi bi-arrow-down"></i>\n            </a>\n          </div>\n        `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll('#applications-table-body input[type="checkbox"]').forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("dashboard-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderApplicationsTable(e){const t=document.getElementById("applications-table-body");if(!t)return;if(!e||!Array.isArray(e))return void(t.innerHTML='\n                <tr>\n                    <td colspan="6" class="text-center py-4">\n                        <i class="bi bi-info-circle me-2"></i>\n                        Tidak ada data pengajuan yang diterima\n                    </td>\n                </tr>\n            ');const a=e.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=a,this.initDataTable()}renderApplicationRow(e){const t=e.gambar_sampah?`${this.baseImageUrl||""}${e.gambar_sampah}`:"";return`\n      <tr data-id="${e.id||""}">\n        <td>\n          ${t?`<img src="${t}" class="img-thumbnail" style="width:60px;height:60px;object-fit:cover;" onerror="this.src='https://via.placeholder.com/60?text=No+Image';">`:'<div style="width: 60px; height: 60px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; display: flex; align-items: center; justify-content: center;">\n                  <i class="bi bi-image text-muted"></i>\n                </div>'}\n        </td>\n        <td>${e.jenisSampah||"-"}</td>\n        <td>${e.berat||0} kg</td>\n        <td><span class="badge bg-danger">${e.status||"pengajuan ditolak"}</span></td>\n        <td>${e.alasan||e.alasan_penolakan}</td>\n      </tr>\n    `}getStatusStyles(e){const t={Diterima:{class:"bg-info bg-opacity-10 text-info",icon:"bi-clipboard-check"},Ditolak:{class:"bg-danger bg-opacity-10 text-danger",icon:"bi-x-circle"},Dikirim:{class:"bg-warning bg-opacity-10 text-warning",icon:"bi-truck"},Penjemputan:{class:"bg-warning bg-opacity-10 text-warning",icon:"bi-truck"},Selesai:{class:"bg-success bg-opacity-10 text-success",icon:"bi-check-circle"},"Menunggu Validasi":{class:"bg-secondary bg-opacity-10 text-secondary",icon:"bi-hourglass-split"},default:{class:"bg-light text-muted",icon:"bi-hourglass-split"}};return{statusClass:t[e]?.class||t.default.class,statusIcon:t[e]?.icon||t.default.icon}}initDataTable(){$e.fn.DataTable.isDataTable("#datatable")&&$e("#datatable").DataTable().destroy(),$e(document).ready((()=>{$e("#datatable").DataTable({responsive:!0,pageLength:10,lengthMenu:[[10,25,50,100],[10,25,50,100]],order:[[1,"desc"]],columnDefs:[{targets:0,orderable:!1,searchable:!1,className:"text-center"},{targets:3,className:"text-center"},{targets:4,className:"text-wrap",width:"200px"}],language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data ditolak",infoEmpty:"Tidak ada data ditolak",infoFiltered:"(difilter dari _MAX_ total data)",emptyTable:"Tidak ada pengajuan yang ditolak",zeroRecords:"Tidak ditemukan data yang sesuai",paginate:{first:"<<",last:">>",next:">",previous:"<"}}})}))}updateStatCards(e){if(!e)return;const t=document.querySelectorAll(".stat-number");t.length>=5&&(t[0].textContent=e.menungguValidasi||"0",t[1].textContent=e.diterima||"0",t[2].textContent=e.ditolak||"0",t[3].textContent=e.penjemputan||"0",t[4].textContent=e.selesai||"0")}renderDashboardData(e,t=null){this.renderApplicationsTable(e),this.updateStatCards(t)}updateRejectedData(e){this.renderApplicationsTable(e)}getSelectedRows(){const e=document.querySelectorAll('#applications-table-body input[type="checkbox"]:checked');return Array.from(e).map((e=>e.value))}clearSelection(){const e=document.getElementById("select-all"),t=document.querySelectorAll('#applications-table-body input[type="checkbox"]');e&&(e.checked=!1),t.forEach((e=>e.checked=!1))}showError(e){const t=document.createElement("div");t.className="alert alert-danger alert-dismissible fade show position-fixed",t.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",t.innerHTML=`\n            <i class="bi bi-exclamation-triangle me-2"></i>\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.remove()}),5e3)}showLoading(e=!0){const t=document.getElementById("applications-table-body");t&&e&&(t.innerHTML='\n                <tr>\n                    <td colspan="8" class="text-center py-4">\n                        <div class="spinner-border text-primary" role="status">\n                            <span class="visually-hidden">Loading...</span>\n                        </div>\n                        <div class="mt-2">Memuat data...</div>\n                    </td>\n                </tr>\n            ')}showLoadingState(){const e=document.getElementById("applications-table-body");e&&(e.innerHTML='\n                <tr>\n                    <td colspan="6" class="text-center py-4">\n                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>\n                        Memuat data pengajuan yang diterima...\n                    </td>\n                </tr>\n            ')}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),$e.fn.DataTable.isDataTable("#datatable")&&$e("#datatable").DataTable().destroy()}}class Ue{constructor(){this.view=new Re,this.currentUser=null,this.handleRefresh=this.handleRefresh.bind(this),this.handleDataUpdate=this.handleDataUpdate.bind(this)}init(){if(console.log("Initializing DitolakPresenter"),this.currentUser=B(),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),this.loadRejectedApplications(),this.setupEventListeners();else{console.log("User not logged in, redirecting to login");const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadRejectedApplications(){try{this.view.showLoadingState();const e=this.currentUser.id_user||this.currentUser.id;if(!e)return console.error("User ID tidak ditemukan:",this.currentUser),void this.view.showError("ID user tidak valid");console.log("Loading dashboard data for user ID:",e);const t=["pengajuan","pengajuan diterima","pengajuan ditolak","penawaran diterima","penawaran ditolak","selesai"];let a=[];for(const n of t)try{const t=await ie(e,n);t.success&&t.data&&t.data.length>0&&(a=[...a,...t.data])}catch(e){console.warn(`Error fetching data for status '${n}':`,e)}if(0===a.length)return console.log("No applications found for user"),void this.view.renderDashboardData([],this.calculateUserStats([]));const n=a.map((e=>({id:e.id,user_id:e.user_id,gambar_sampah:e.gambar_sampah,jenisSampah:e.jenis_sampah,berat:parseFloat(e.berat)||0,status:e.status||"pengajuan ditolak",alasan:e.alasan_penolakan})));console.log("Transformed applications:",n);const i=this.calculateUserStats(n);console.log("Calculated stats:",i);const s=n.filter((e=>"pengajuan ditolak"===e.status.toLowerCase().trim()));this.view.renderDashboardData(s,i)}catch(e){console.error("Error in loadAcceptedApplications:",e),this.view.showError("Terjadi kesalahan saat memuat dashboard")}}calculateUserStats(e){const t={menungguValidasi:0,diterima:0,ditolak:0,penjemputan:0,selesai:0};return e&&0!==e.length?(e.forEach((e=>{const a=e.status?e.status.toLowerCase().trim():"";switch(a){case"pengajuan":case"menunggu validasi":t.menungguValidasi++;break;case"pengajuan diterima":case"diterima":t.diterima++;break;case"pengajuan ditolak":case"ditolak":t.ditolak++;break;case"penawaran diterima":case"penjemputan":t.penjemputan++;break;case"selesai":case"penawaran ditolak":t.selesai++;break;default:console.warn("Unknown status:",a),t.menungguValidasi++}})),t):t}getSampleRejectedData(){return[{id:1,jenisSampah:"Plastik PET",tanggalPembelian:"2024-12-01",kuantitas:"5 kg",harga:"Rp 3,000/kg",total:"Rp 15,000",status:"Ditolak",keterangan:"Kualitas plastik tidak sesuai standar"},{id:2,jenisSampah:"Kardus",tanggalPembelian:"2024-11-28",kuantitas:"10 kg",harga:"Rp 2,500/kg",total:"Rp 25,000",status:"Ditolak",keterangan:"Kardus dalam kondisi basah"},{id:3,jenisSampah:"Logam",tanggalPembelian:"2024-11-25",kuantitas:"3 kg",harga:"Rp 8,000/kg",total:"Rp 24,000",status:"Ditolak",keterangan:"Berat tidak sesuai dengan yang dilaporkan"}]}setupEventListeners(){document.addEventListener("dashboard-refresh",this.handleRefresh),document.addEventListener("rejected-data-update",this.handleDataUpdate)}handleRefresh(){console.log("Refreshing rejected applications data"),this.loadRejectedApplications()}handleDataUpdate(e){const{data:t}=e.detail;t&&this.view.updateRejectedData(t)}showError(e){console.error(e),window.showToast?window.showToast(e,"error"):alert(e)}showSuccess(e){console.log(e),window.showToast?window.showToast(e,"success"):alert(e)}async handleBulkAction(e){const t=this.view.getSelectedRows();if(0!==t.length)try{switch(e){case"delete":await this.handleBulkDelete(t);break;case"resubmit":await this.handleBulkResubmit(t);break;default:console.log(`Unknown action: ${e}`)}}catch(t){console.error(`Error performing bulk action ${e}:`,t),this.showError(`Gagal melakukan aksi ${e}`)}else this.showError("Pilih setidaknya satu item")}async handleBulkDelete(e){confirm(`Apakah Anda yakin ingin menghapus ${e.length} item?`)&&(this.showSuccess(`Berhasil menghapus ${e.length} item`),this.loadRejectedApplications(),this.view.clearSelection())}async handleBulkResubmit(e){confirm(`Apakah Anda yakin ingin mengajukan ulang ${e.length} item?`)&&(this.showSuccess(`Berhasil mengajukan ulang ${e.length} item`),this.loadRejectedApplications(),this.view.clearSelection())}removeEventListeners(){document.removeEventListener("dashboard-refresh",this.handleRefresh),document.removeEventListener("rejected-data-update",this.handleDataUpdate)}destroy(){console.log("Destroying DitolakPresenter"),this.removeEventListeners(),this.view.destroy()}}var _e=a(4692);class Fe{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n      \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Penawaran</h2>\n              <p class="text-dark mb-4">Kelola dan pantau semua penawaran harga sampah.</p>\n            </div>\n            \n            <div class="user-profile">\n              <img id="user-avatar" src="${W}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n\n          <div class="stats-grid">\n            ${this.renderStatCard("0","Semua","bi-hourglass-split","yellow-bg","#/dashboard")}\n            ${this.renderStatCard("0","Pengajuan","bi-clipboard-check","blue-bg","#/pengajuan")}\n            ${this.renderStatCard("0","Penawaran","bi-x-circle","red-bg","#/penawaran")}\n            ${this.renderStatCard("0","Pengiriman","bi-truck","orange-bg","#/pengiriman")}\n            ${this.renderStatCard("0","Selesai","bi-check-circle","green-bg","#/selesai")}\n          </div>\n        </header>\n\n        <div class="data-section">\n          <div class="data-header">\n            <h3>Data Penawaran</h3>\n          </div>\n\n          <div class="table-responsive">\n            <table id="datatable" class="table table-striped" style="width:100%">\n              <thead>\n                <tr>\n                  <th><input type="checkbox" id="select-all"></th>\n                  <th>Nama</th>\n                  <th>Kategori Sampah</th>\n                  <th>Berat</th>\n                  <th>Harga</th>\n                  <th>Total Harga</th>\n                  <th>Status</th>\n                </tr>\n              </thead>\n              <tbody id="offers-table-body">\n                \x3c!-- Dynamic content will be inserted here --\x3e\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    `}renderStatCard(e,t,a,n,i="#"){return`\n      <div class="stat-card">\n        <div class="stat-content">\n          <div class="stat-number">${e}</div>\n          <div class="stat-label">${t}</div>\n        </div>\n        <div class="stat-icon ${n}">\n          <i class="bi ${a}"></i>\n        </div>\n        <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n          <i class="bi bi-arrow-down"></i>\n        </a>\n      </div>\n    `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("add-offer-btn");if(n){const e=()=>this.handleAddOffer();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("refresh-btn");if(i){const e=()=>this.handleRefresh();i.addEventListener("click",e),this.eventListeners.push({element:i,type:"click",handler:e})}const s=document.getElementById("select-all");if(s){const e=e=>this.toggleSelectAll(e.target.checked);s.addEventListener("change",e),this.eventListeners.push({element:s,type:"change",handler:e})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll('#offers-table-body input[type="checkbox"]').forEach((t=>{t.checked=e}))}handleAddOffer(){const e=new CustomEvent("add-offer");document.dispatchEvent(e)}handleRefresh(){const e=new CustomEvent("penawaran-refresh");document.dispatchEvent(e)}handleEditOffer(e){const t=new CustomEvent("edit-offer",{detail:{offerId:e}});document.dispatchEvent(t)}handleDeleteOffer(e){if(confirm("Apakah Anda yakin ingin menghapus penawaran ini?")){const t=new CustomEvent("delete-offer",{detail:{offerId:e}});document.dispatchEvent(t)}}handleApproveOffer(e){const t=new CustomEvent("approve-offer",{detail:{offerId:e}});document.dispatchEvent(t)}handleRejectOffer(e){if(confirm("Apakah Anda yakin ingin menolak penawaran ini?")){const t=new CustomEvent("reject-offer",{detail:{offerId:e}});document.dispatchEvent(t)}}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderOffersTable(e){const t=document.getElementById("offers-table-body");if(!t)return;const a=e.map((e=>this.renderOfferRow(e))).join("");t.innerHTML=a,this.initDataTable(),this.setupTableActions()}renderOfferRow(e){console.log("🕵️ Offer row:",e);const{statusClass:t,statusText:a}=this.getStatusStyles(e.status);return`\n    <tr>\n      <td><input type="checkbox" class="row-checkbox" value="${e.id}"></td>\n      <td>${e.nama}</td>\n      <td>${e.jenisSampah}</td>\n      <td>${e.berat} kg</td>\n      <td>Rp ${e.harga.toLocaleString("id-ID")}</td>\n      <td>Rp ${null!==e.total?e.total.toLocaleString("id-ID"):"0"}</td> \x3c!-- Fix disini --\x3e\n      <td><span class="badge ${t}">${a}</span></td>\n    </tr>\n  `}setupTableActions(){document.querySelectorAll(".btn-edit").forEach((e=>{const t=e=>{const t=e.currentTarget.getAttribute("data-offer-id");this.handleEditOffer(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})})),document.querySelectorAll(".btn-approve").forEach((e=>{const t=e=>{const t=e.currentTarget.getAttribute("data-offer-id");this.handleApproveOffer(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})})),document.querySelectorAll(".btn-reject").forEach((e=>{const t=e=>{const t=e.currentTarget.getAttribute("data-offer-id");this.handleRejectOffer(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})})),document.querySelectorAll(".btn-delete").forEach((e=>{const t=e=>{const t=e.currentTarget.getAttribute("data-offer-id");this.handleDeleteOffer(t)};e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}))}getStatusStyles(e){return console.log("👀 Status diterima oleh getStatusStyles:",e),"penawaran diterima"===e?{statusClass:"bg-success",statusText:"penawaran diterima"}:"penawaran ditolak"===e?{statusClass:"bg-danger",statusText:"penawaran ditolak"}:{statusClass:"bg-secondary",statusText:e||"Tidak diketahui"}}formatDate(e){return new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"2-digit",day:"2-digit"})}initDataTable(){_e.fn.DataTable.isDataTable("#datatable")&&_e("#datatable").DataTable().destroy(),_e(document).ready((()=>{_e("#datatable").DataTable({responsive:!0,order:[[1,"desc"]],language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ penawaran per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ penawaran",infoEmpty:"Tidak ada penawaran yang ditemukan",infoFiltered:"(difilter dari _MAX_ total penawaran)",zeroRecords:"Tidak ada penawaran yang cocok ditemukan",paginate:{first:"<<",last:">>",next:">",previous:"<"}}})}))}updateStatistics(e){const t=document.querySelectorAll(".stat-number");t.length>=5&&e&&(t[0].textContent=e.total||"0",t[1].textContent=e.pengajuan||"0",t[2].textContent=e.penawaran||"0",t[3].textContent=e.pengiriman||"0",t[4].textContent=e.selesai||"0")}renderPenawaranData(e,t=null){this.renderOffersTable(e),t&&this.updateStatistics(t)}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),_e.fn.DataTable.isDataTable("#datatable")&&_e("#datatable").DataTable().destroy()}}class qe{constructor(){this.penawaranView=new Fe,this.sidebarView=new r.A,this.currentUser=null,this.applications=[],this.handleLogout=this.handleLogout.bind(this)}init(){if(console.log("Initializing PenawaranPresenter"),this.currentUser=B(),this.currentUser)this.sidebarView.render(),this.penawaranView.render(),this.loadStatistikCard(),this.loadPenawaranData(),this.penawaranView.displayUserInfo(this.currentUser),this.setupEventListeners();else{const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadPenawaranData(){try{const e=await async function(){try{const e=await fetch("https://greenshort-production.up.railway.app/api/penawaran/status/semua"),t=await e.json();return t.success?t.data:[]}catch(e){return console.error("❌ Gagal ambil semua penawaran:",e),[]}}();console.log("📦 Semua Penawaran:",e),this.penawaranView.renderPenawaranData(e)}catch(e){console.error("❌ Gagal load semua penawaran:",e)}}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout)}async loadStatistikCard(){try{const e=await async function(){try{const e=await fetch("https://greenshort-production.up.railway.app/api/dashboard-admin/stats"),t=await e.json();return t.success?t.data:null}catch(e){return console.error("❌ Gagal ambil statistik penawaran:",e),null}}();e&&this.penawaranView.updateStatistics({total:e.total,pengajuan:e.pengajuan,penawaran:e.penawaran,pengiriman:e.pengiriman,selesai:e.selesai})}catch(e){console.error("❌ Gagal ambil statistik card:",e)}}handleLogout(){console.log("Logout initiated"),P(),this.penawaranView.destroy(),this.sidebarView.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}destroy(){console.log("Destroying PenawaranPresenter"),document.removeEventListener("user-logout",this.handleLogout),this.penawaranView.destroy(),this.sidebarView.destroy()}}var Ne=a(4692);class He{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.applicationsData=[],this.dataTable=null,this.statsData={dijemput:0,diantar:0,total:0}}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n          <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n  \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n          \x3c!-- Header Section --\x3e\n          <header>\n              <div class="header-section">\n                  <div class="dashboard-title">\n                      <div class="title-content">\n                          <h1>Dashboard Penjemputan</h1>\n                          <p>Kelola status penjemputan sampah Anda secara real-time.</p>\n                      </div>\n                      <div class="user-profile">\n                          <img id="user-avatar" src="${W}" alt="User">\n                          <span id="user-name">Loading...</span>\n                      </div>\n                  </div>\n  \n                  \x3c!-- Stats Grid --\x3e\n                  <div class="stats-grid">\n                      ${this.renderStatCard("80","Menunggu Validasi","bi-hourglass-split","yellow-bg","#/dashboardUser")}\n                      ${this.renderStatCard("16","Diterima","bi-clipboard-check","blue-bg","#/diterima")}\n                      ${this.renderStatCard("8","Ditolak","bi-x-circle","red-bg","#/ditolak")}\n                      ${this.renderStatCard("24","Penjemputan","bi-truck","orange-bg","#/penjemputan")}\n                      ${this.renderStatCard("42","Selesai","bi-check-circle","green-bg","#/selesaiUser")}\n                  </div>\n              </div>\n          </header>\n  \n          \x3c!-- Data Section --\x3e\n          <div class="data-section">\n              <div class="section-header">\n                  <h2 class="section-title">Data Penjemputan</h2>\n              </div>\n  \n              \x3c!-- Tabs --\x3e\n              <ul class="nav nav-tabs" id="penjemputanTabs" role="tablist">\n                  <li class="nav-item" role="presentation">\n                      <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button"\n                          role="tab" aria-controls="all" aria-selected="true">\n                          Semua <span class="badge bg-light text-dark ms-1" id="badge-all">0</span>\n                      </button>\n                  </li>\n                  <li class="nav-item" role="presentation">\n                      <button class="nav-link" id="dijemput-tab" data-bs-toggle="tab" data-bs-target="#dijemput" type="button"\n                          role="tab" aria-controls="dijemput" aria-selected="false">\n                          Dijemput <span class="badge bg-light text-dark ms-1" id="badge-dijemput">0</span>\n                      </button>\n                  </li>\n                  <li class="nav-item" role="presentation">\n                      <button class="nav-link" id="diantar-tab" data-bs-toggle="tab" data-bs-target="#diantar" type="button"\n                          role="tab" aria-controls="diantar" aria-selected="false">\n                          Diantar <span class="badge bg-light text-dark ms-1" id="badge-diantar">0</span>\n                      </button>\n                  </li>\n              </ul>\n  \n              \x3c!-- Tab Content --\x3e\n              <div class="tab-content" id="penjemputanTabsContent">\n                  <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="all-tab">\n                      <div class="table-responsive pt-3">\n                          <table class="table table-striped datatable" id="table-all" style="width:100%">\n                              <thead>\n                                <tr>\n                                    <th>Jenis Sampah</th>\n                                    <th>Berat</th>\n                                    <th>Harga (Rp/kg)</th>\n                                    <th>Total</th>\n                                    <th>Ongkir</th>\n                                    <th>Alamat Admin</th>\n                                    <th>Estimasi Tanggal</th>\n                                    <th>Opsi</th>\n                                </tr>\n                              </thead>\n                              <tbody id="body-all"></tbody>\n                          </table>\n                      </div>\n                  </div>\n  \n                  <div class="tab-pane fade" id="dijemput" role="tabpanel" aria-labelledby="dijemput-tab">\n                      <div class="table-responsive pt-3">\n                          <table class="table table-striped datatable" id="table-dijemput" style="width:100%">\n                              <thead>\n                                <tr>\n                                    <th>Jenis Sampah</th>\n                                    <th>Berat</th>\n                                    <th>Harga (Rp/kg)</th>\n                                    <th>Total</th>\n                                    <th>Ongkir</th>\n                                    <th>Alamat Admin</th>\n                                    <th>Estimasi Tanggal</th>\n                                    <th>Opsi</th>\n                                </tr>\n                              </thead>\n\n                              <tbody id="body-dijemput"></tbody>\n                          </table>\n                      </div>\n                  </div>\n  \n                  <div class="tab-pane fade" id="diantar" role="tabpanel" aria-labelledby="diantar-tab">\n                      <div class="table-responsive pt-3">\n                          <table class="table table-striped datatable" id="table-diantar" style="width:100%">\n                              <thead>\n                                <tr>\n                                    <th>Jenis Sampah</th>\n                                    <th>Berat</th>\n                                    <th>Harga (Rp/kg)</th>\n                                    <th>Total</th>\n                                    <th>Ongkir</th>\n                                    <th>Alamat Admin</th>\n                                    <th>Estimasi Tanggal</th>\n                                    <th>Opsi</th>\n                                </tr>\n                               </thead>\n\n                              <tbody id="body-diantar"></tbody>\n                          </table>\n                      </div>\n                  </div>\n              </div>\n          </div>\n      </div>\n    `,this.activateDefaultTab()}activateDefaultTab(){const e=(t=1)=>{const a=document.getElementById("all-tab"),n=document.getElementById("all");if(!a||!n)return t<5?(console.log(`Attempt ${t}: Tab elements not found, retrying...`),void setTimeout((()=>e(t+1)),100)):void console.error("Failed to find tab elements after 5 attempts");console.log(`Attempt ${t}: Activating default tab...`);const i=document.querySelectorAll(".nav-link"),s=document.querySelectorAll(".tab-pane");i.forEach((e=>{e.classList.remove("active"),e.setAttribute("aria-selected","false")})),s.forEach((e=>{e.classList.remove("active","show")})),a.classList.add("active"),a.setAttribute("aria-selected","true"),n.classList.add("active","show"),setTimeout((()=>{const i=a.classList.contains("active"),s=n.classList.contains("active")&&n.classList.contains("show");if(i&&s){if(console.log('✅ Tab "Semua" berhasil diaktifkan!'),window.bootstrap&&bootstrap.Tab)try{bootstrap.Tab.getOrCreateInstance(a)}catch(e){console.log("Bootstrap Tab instance creation skipped")}}else console.warn("⚠️ Tab activation verification failed, retrying..."),t<3&&setTimeout((()=>e(t+1)),200)}),50)};setTimeout((()=>e()),100)}showTableLoading(e=!0){e?this.showLoading(!0):this.showLoading(!1)}addTabStyles(){const e=document.createElement("style");e.id="penjemputan-tab-styles",e.textContent="\n      /* Tab Navigation Styles */\n      .nav-tabs .nav-link.active {\n        color: #28a745 !important;\n        border-color: #28a745 #28a745 #fff !important;\n        background-color: #fff !important;\n        font-weight: 600;\n      }\n      \n      .nav-tabs .nav-link.active:hover,\n      .nav-tabs .nav-link.active:focus {\n        color: #28a745 !important;\n        border-color: #28a745 #28a745 #fff !important;\n      }\n      \n      .nav-tabs .nav-link:hover {\n        color: #28a745;\n        border-color: #28a745;\n      }\n      \n      /* Tab Content Styles */\n      .tab-content > .tab-pane {\n        display: none;\n      }\n      \n      .tab-content > .active {\n        display: block;\n      }\n      \n      /* Loading Overlay */\n      .table-loading-overlay {\n        border-radius: 8px;\n      }\n      \n      /* Ensure tab visibility */\n      #penjemputanTabsContent .tab-pane.active.show {\n        display: block !important;\n        opacity: 1 !important;\n        visibility: visible !important;\n      }\n    ";const t=document.getElementById("penjemputan-tab-styles");t&&t.remove(),document.head.appendChild(e)}render(){this.sidebar.render(),this.renderMainContent(),this.addTabStyles(),this.setupEventListeners(),this.checkMobileView()}renderStatCard(e,t,a,n,i){return`\n            <div class="stat-card">\n                <div class="stat-content">\n                    <div class="stat-number">${e}</div>\n                    <div class="stat-label">${t}</div>\n                </div>\n                <div class="stat-icon ${n}">\n                    <i class="bi ${a}"></i>\n                </div>\n                <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n                <i class="bi bi-arrow-down"></i>\n                </a>\n            </div>\n        `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a})}showLoading(e=!0){let t=document.getElementById("loading-state");if(!t){t=document.createElement("div"),t.id="loading-state",t.className="loading-state text-center py-4",t.innerHTML='\n            <div class="spinner-border text-primary" role="status">\n                <span class="visually-hidden">Loading...</span>\n            </div>\n            <p class="mt-2">Memuat data...</p>\n        ';const e=document.querySelector(".tab-content");e&&e.prepend(t)}t.style.display=e?"block":"none";const a=document.getElementById("penjemputanTabsContent");a&&(a.style.display=e?"none":"block")}renderApplicationsTable(e){this.applicationsData=e||[],this.showLoading(!1);const t={all:document.getElementById("body-all"),dijemput:document.getElementById("body-dijemput"),diantar:document.getElementById("body-diantar")};Object.values(t).forEach((e=>e.innerHTML="")),this.applicationsData.forEach((e=>{const a=this.normalizeStatus(e.status||""),n=this.renderApplicationRow(e);t.all.innerHTML+=n,"dijemput"===a?t.dijemput.innerHTML+=n:"antar sendiri"===a&&(t.diantar.innerHTML+=n)})),this.updateStats(),this.updateTabBadges(),this.initDataTables()}renderApplicationRow(e){const t=this.formatDate(e.tanggal_awal),a=this.formatDate(e.tanggal_akhir),n=this.formatCurrency(e.price||0),i=this.formatCurrency(e.totalPrice||0),s=this.formatCurrency(e.ongkir||0);return`\n      <tr>\n        <td>${e.category||"-"}</td>\n        <td>${e.weight||0} kg</td>\n        <td>${n}</td>\n        <td>${i}</td>\n        <td>${s}</td>\n        <td>${e.address||"-"}</td>\n        <td>${t} - ${a}</td>\n        <td>${this.normalizeStatus(e.status)}</td>\n      </tr>\n    `}formatCurrency(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e).replace("Rp","Rp ")}normalizeStatus(e){const t=(e||"").toLowerCase();return t.includes("dijemput")?"dijemput":t.includes("antar")?"antar sendiri":t}getStatusStyles(e){return{dijemput:{class:"status-shipped",icon:"bi-truck",label:"Dijemput"},diantar:{class:"status-completed",icon:"bi-check-circle",label:"Diantar"}}[e]||{class:"status-pending",icon:"bi-hourglass-split",label:e||"Unknown"}}formatDate(e){if(!e)return"N/A";const t=new Date(e);return isNaN(t.getTime())?"N/A":t.toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"})}initDataTables(){["table-all","table-dijemput","table-diantar"].forEach((e=>{Ne.fn.DataTable.isDataTable(`#${e}`)&&Ne(`#${e}`).DataTable().destroy(),Ne(`#${e}`).DataTable({responsive:!0,pageLength:10,language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",paginate:{next:">",previous:"<"},zeroRecords:"Tidak ada data yang cocok"}})}))}updateStats(){if(!this.applicationsData)return;this.statsData={total:this.applicationsData.length,dijemput:this.applicationsData.filter((e=>"dijemput"===this.normalizeStatus(e.status))).length,diantar:this.applicationsData.filter((e=>"diantar"===this.normalizeStatus(e.status))).length};const e=document.getElementById("stat-total-penjemputan"),t=document.getElementById("stat-dijemput"),a=document.getElementById("stat-diantar");e&&(e.textContent=this.statsData.total),t&&(t.textContent=this.statsData.dijemput),a&&(a.textContent=this.statsData.diantar)}updateTabBadges(){if(!this.applicationsData)return;const e={all:this.applicationsData.length,dijemput:this.applicationsData.filter((e=>"dijemput"===this.normalizeStatus(e.status))).length,diantar:this.applicationsData.filter((e=>"antar sendiri"===this.normalizeStatus(e.status))).length};Object.keys(e).forEach((t=>{const a=document.getElementById(`badge-${t}`);a&&(a.textContent=e[t])}))}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}updateDashboardStats(e){const t=document.querySelectorAll(".stat-card .stat-number");t.length>=5&&(t[0].textContent=e.menunggu_validasi||"0",t[1].textContent=e.diterima||"0",t[2].textContent=e.ditolak||"0",t[3].textContent=e.penjemputan||"0",t[4].textContent=e.selesai||"0")}renderDashboardData(e){this.renderApplicationsTable(e)}clearSelection(){}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),this.dataTable&&(this.dataTable.destroy(),this.dataTable=null)}}class Ve{constructor(){this.view=new He,this.isLoading=!1,this.currentData=[],this.setupEventListeners()}async init(){if(this.currentUser=B(),console.log("Current User:",this.currentUser),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),await this.loadUserDashboardStats(this.currentUser.id_user),await this.loadPenjemputanData(this.currentUser.id_user),this.setupEventListeners();else{const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadPenjemputanData(e){if(!this.isLoading){this.isLoading=!0,this.view.showTableLoading(!0);try{const t=await async function(e){const t=await fetch(`https://greenshort-production.up.railway.app/api/pengiriman/${e}`),a=await t.json();if(!a.success)throw new Error(a.message||"Gagal fetch data");return a.data.map((e=>({...e,category:e.jenis_sampah,weight:e.berat,price:e.harga_tawaran,totalPrice:e.total,date:new Date(e.tanggal_awal),address:e.alamat_admin,status:e.opsi_pengiriman})))}(e);this.currentData=t,this.view.renderDashboardData(this.currentData)}catch(e){console.error("Error loading pengiriman:",e),this.handleError("Gagal memuat data pengiriman")}finally{this.isLoading=!1,this.view.showTableLoading(!1)}}}async loadUserDashboardStats(e){try{console.log("Fetching stats for User ID:",e);const t=await async function(e){const t=await fetch(`https://greenshort-production.up.railway.app/api/dashboard-user/stats/${e}`),a=await t.json();if(!a.success)throw new Error(a.message||"Gagal fetch stats user");return a.data}(e);this.view.updateDashboardStats(t)}catch(e){console.error("Error loading user dashboard stats:",e),alert("Error: Gagal memuat dashboard penjemputan")}}normalizeStatus(e){return{shipped:"dijemput",completed:"diantar",Dikirim:"dijemput",Selesai:"diantar"}[e]||e}setupEventListeners(){}handleError(e){console.error("PenjemputanPresenter Error:",e),this.showNotification(e,"error"),this.view.renderDashboardData([])}showNotification(e,t="info"){console.log(`[${t.toUpperCase()}] ${e}`),"undefined"!=typeof window&&window.showNotification?window.showNotification(e,t):"error"===t&&alert(`Error: ${e}`)}destroy(){console.log("Destroying PenjemputanPresenter..."),this.view&&this.view.destroy(),this.currentData=[],this.isLoading=!1}}var ze=a(4692);class Oe{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.baseImageUrl="https://greenshort-production.up.railway.app/uploads/"}render(){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n      \n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Dashboard</h2>\n              <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n            </div>\n            \n            <div class="user-profile">\n              <img id="user-avatar" src="${W}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n\n          <div class="stats-grid">\n            ${this.renderStatCard("80","Menunggu Validasi","bi-hourglass-split","yellow-bg","#/dashboardUser")}\n            ${this.renderStatCard("16","Diterima","bi-clipboard-check","blue-bg","#/diterima")}\n            ${this.renderStatCard("8","Ditolak","bi-x-circle","red-bg","#/ditolak")}\n            ${this.renderStatCard("24","Penjemputan","bi-truck","orange-bg","#/penjemputan")}\n            ${this.renderStatCard("42","Selesai","bi-check-circle","green-bg","#/selesaiUser")}\n          </div>\n        </header>\n\n        <div class="data-section">\n          <div class="data-header">\n            <h3>Data Selesai</h3>\n          </div>\n\n          <div class="table-responsive">\n            <table id="datatable" class="table table-striped" style="width:100%">\n              <thead>\n                <tr>\n                  <th>Gambar</th>\n                  <th>Jenis Sampah</th>\n                  <th>Berat</th>\n                  <th>Status</th>\n                  <th>Total</th>\n                  <th>Bukti Transfer</th>\n                </tr>\n              </thead>\n              <tbody id="applications-table-body">\n                \x3c!-- Dynamic content will be inserted here --\x3e\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    `}renderStatCard(e,t,a,n,i){return`\n          <div class="stat-card">\n            <div class="stat-content">\n              <div class="stat-number">${e}</div>\n              <div class="stat-label">${t}</div>\n            </div>\n            <div class="stat-icon ${n}">\n              <i class="bi ${a}"></i>\n            </div>\n            <a href="${i}" class="stat-more" aria-label="View more ${t} items">\n              <i class="bi bi-arrow-down"></i>\n            </a>\n          </div>\n        `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("refresh-btn");if(n){const e=()=>this.handleRefresh();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("select-all");if(i){const e=e=>this.toggleSelectAll(e.target.checked);i.addEventListener("change",e),this.eventListeners.push({element:i,type:"change",handler:e})}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");document.querySelector(".main-content");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}toggleSelectAll(e){document.querySelectorAll('#applications-table-body input[type="checkbox"]').forEach((t=>{t.checked=e}))}handleRefresh(){const e=new CustomEvent("selesaiUser-refresh");document.dispatchEvent(e)}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}renderApplicationsTable(e){const t=document.getElementById("applications-table-body");if(!t)return;if(!e||!Array.isArray(e))return void(t.innerHTML='\n                <tr>\n                    <td colspan="6" class="text-center py-4">\n                        <i class="bi bi-info-circle me-2"></i>\n                        Tidak ada data pengajuan yang diterima\n                    </td>\n                </tr>\n            ');const a=e.map((e=>this.renderApplicationRow(e))).join("");t.innerHTML=a,this.initDataTable()}renderApplicationRow(e){const t=e.gambar_sampah?`${this.baseImageUrl}${e.gambar_sampah}`:"";return`\n      <tr>\n        <td>\n          ${t?`\n            <img src="${t}" \n                 alt="Gambar Sampah" \n                 class="img-thumbnail application-image" \n                 style="width: 60px; height: 60px; object-fit: cover; cursor: pointer;"\n                 onclick="this.parentElement.querySelector('.image-modal').style.display='block'"\n                 onerror="this.src='https://via.placeholder.com/60?text=No+Image'; this.style.objectFit='contain';">\n            <div class="image-modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); cursor:pointer;" onclick="this.style.display='none'">\n              <img src="${t}" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); max-width:90%; max-height:90%; object-fit:contain;">\n            </div>\n          `:'\n            <div style="width: 60px; height: 60px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; display: flex; align-items: center; justify-content: center;">\n              <i class="bi bi-image text-muted"></i>\n            </div>\n          '}\n        </td>\n        <td>${e.jenisSampah}</td>\n        <td>${e.berat}</td>\n        <td>${e.status}</td>\n        <td>${e.total}</td>\n        <td>\n          ${"selesai"===e.status.toLowerCase().trim()&&"-"!==e.buktiTf?`<a href="https://greenshort-production.up.railway.app/uploads/${e.bukti_tf}" target="_blank">Lihat Bukti</a>`:"-"}\n        </td>\n      </tr>\n    `}getStatusStyles(e){const t={Diterima:{class:"bg-info bg-opacity-10",icon:"bi-clipboard-check"},Ditolak:{class:"bg-danger bg-opacity-10",icon:"bi-x-circle"},Dikirim:{class:"bg-warning bg-opacity-10",icon:"bi-truck"},Selesai:{class:"bg-success bg-opacity-10",icon:"bi-check-circle"},default:{class:"bg-light",icon:"bi-hourglass-split"}};return t[e]||t.default}initDataTable(){ze.fn.DataTable.isDataTable("#datatable")&&ze("#datatable").DataTable().destroy(),ze(document).ready((()=>{ze("#datatable").DataTable({responsive:!0,language:{search:"Cari:",lengthMenu:"Tampilkan _MENU_ data per halaman",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",paginate:{first:"<<",last:">>",next:">",previous:"<"}}})}))}updateStatCards(e){if(!e)return;const t=document.querySelectorAll(".stat-number");t.length>=5&&(t[0].textContent=e.menungguValidasi||"0",t[1].textContent=e.diterima||"0",t[2].textContent=e.ditolak||"0",t[3].textContent=e.penjemputan||"0",t[4].textContent=e.selesai||"0")}renderDashboardData(e,t=null){this.renderApplicationsTable(e),this.updateStatCards(t)}showError(e){const t=document.createElement("div");t.className="alert alert-danger alert-dismissible fade show position-fixed",t.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",t.innerHTML=`\n            <i class="bi bi-exclamation-triangle me-2"></i>\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.remove()}),5e3)}showLoadingState(){const e=document.getElementById("applications-table-body");e&&(e.innerHTML='\n                <tr>\n                    <td colspan="6" class="text-center py-4">\n                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>\n                        Memuat data pengajuan yang diterima...\n                    </td>\n                </tr>\n            ')}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),ze.fn.DataTable.isDataTable("#datatable")&&ze("#datatable").DataTable().destroy()}}class Ke{constructor(){this.view=new Oe,this.sidebarView=new r.A,this.currentUser=null,this.handleLogout=this.handleLogout.bind(this),this.handleRefresh=this.handleRefresh.bind(this)}async init(){if(console.log("Initializing SelesaiUserPresenter"),this.currentUser=B(),this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),await this.loadData(),this.setupEventListeners();else{const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadData(){try{this.view.showLoadingState();const e=this.currentUser.id_user||this.currentUser.id;if(!e)return console.error("User ID tidak ditemukan:",this.currentUser),void this.view.showError("ID user tidak valid");console.log("Loading dashboard data for user ID:",e);const t=["pengajuan","pengajuan diterima","pengajuan ditolak","penawaran diterima","penawaran ditolak","selesai"];let a=[];for(const n of t)try{const t=await ie(e,n);t.success&&t.data&&t.data.length>0&&(a=[...a,...t.data])}catch(e){console.warn(`Error fetching data for status '${n}':`,e)}if(0===a.length)return console.log("No applications found for user"),void this.view.renderDashboardData([],this.calculateUserStats([]));const n=a.map((e=>{const t=e.status?e.status.toLowerCase().trim():"",a="selesai"===t;return{id:e.id,user_id:e.user_id,gambar_sampah:e.gambar_sampah,jenisSampah:e.jenis_sampah,berat:parseFloat(e.berat)||0,status:e.status||"-",total:a&&e.total||"-",bukti_tf:a&&e.bukti_tf||"-",alasan:e.alasan_penolakan||"-"}})),i=this.calculateUserStats(n),s=n.filter((e=>{const t=e.status.toLowerCase().trim();return"selesai"===t||"penawaran ditolak"===t}));this.view.renderDashboardData(s,i)}catch(e){console.error("Error in loadRejectedApplications:",e),this.view.showError("Terjadi kesalahan saat memuat dashboard")}}calculateUserStats(e){const t={menungguValidasi:0,diterima:0,ditolak:0,penjemputan:0,selesai:0};return e&&0!==e.length?(e.forEach((e=>{const a=e.status?e.status.toLowerCase().trim():"";switch(a){case"pengajuan":case"menunggu validasi":t.menungguValidasi++;break;case"pengajuan diterima":case"diterima":t.diterima++;break;case"pengajuan ditolak":case"ditolak":t.ditolak++;break;case"penawaran diterima":case"penjemputan":t.penjemputan++;break;case"selesai":case"penawaran ditolak":t.selesai++;break;default:console.warn("Unknown status:",a),t.menungguValidasi++}})),t):t}handleRefresh(){console.log("Refreshing selesai data"),this.loadData()}handleLogout(){P(),this.view.destroy();const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}setupEventListeners(){document.addEventListener("user-logout",this.handleLogout),document.addEventListener("selesaiUser-refresh",this.handleRefresh)}destroy(){document.removeEventListener("user-logout",this.handleLogout),document.removeEventListener("selesaiUser-refresh",this.handleRefresh),this.view.destroy()}}var Ge=a(6375),Je={};Je.styleTagTransform=f(),Je.setAttributes=b(),Je.insert=p().bind(null,"head"),Je.domAPI=m(),Je.insertStyleElement=y();c()(Ge.A,Je);Ge.A&&Ge.A.locals&&Ge.A.locals;var We=a(7122);function Ze(e){this.l2=e.l2||.01}Ze.prototype.apply=function(e){return We.lKK(We.d_2(this.l2),We.czq(We.EwI(e)))},Ze.prototype.getConfig=function(){return{l2:this.l2}},Ze.className="L2",We.JFn.registerClass(Ze);const Xe=class{constructor(){this.modelUrl="https://modelai14.s3.ap-southeast-2.amazonaws.com/model.json",this.model=null,this.labels=["Cardboard","Food_Organics","Glass","Metal","Miscellaneous_Trash","Paper","Plastic","Textile_Trash","Vegetation"],this.labelAliases={Cardboard:"Kardus",Food_Organics:"Sisa Makanan",Glass:"Kaca",Metal:"Logam",Miscellaneous_Trash:"Sampah Campuran",Paper:"Kertas",Plastic:"Plastik",Textile_Trash:"Sampah Tekstil",Vegetation:"Tanaman/Sampah Organik"}}async loadModel(){this.model=await We.O0W(this.modelUrl,{customObjects:{L2:Ze}}),console.log("Model berhasil dimuat")}async preprocessImage(e){return new Promise(((t,a)=>{const n=new Image;n.src=URL.createObjectURL(e),n.onload=()=>{const e=We.TaL.fromPixels(n).resizeBilinear([224,224]).toFloat().div(We.d_2(255)).sub(.5).mul(2).expandDims();URL.revokeObjectURL(n.src),t(e)},n.onerror=()=>a(new Error("Gagal memuat gambar"))}))}async predict(e){if(!this.model)throw new Error("Model belum dimuat");const t=await this.preprocessImage(e);try{const e=this.model.predict(t),a=await e.data(),n=this.processClassificationResponse(a);return We.ASo(t),We.ASo(e),n}catch(e){throw We.ASo(t),e}}processClassificationResponse(e){const t=e.indexOf(Math.max(...e)),a=this.labels[t],n=100*e[t],i=Array.from(e).map(((e,t)=>({val:e,idx:t}))).sort(((e,t)=>t.val-e.val)).slice(0,3).map((e=>e.idx)).map((t=>({className:this.labels[t],alias:this.labelAliases[this.labels[t]],confidence:100*e[t]})));return{predictedClass:a,alias:this.labelAliases[a],confidence:n,topPredictions:i}}},Ye={cardboard:"Kardus",organic:"Organik",glass:"Kaca",metal:"Logam",miscellaneous:"Lainnya",paper:"Kertas",plastic:"Plastik",textile:"Kain",vegetation:"Vegetasi",Cardboard:"Kardus",Food_Organics:"Bahan Organik Makanan",Glass:"Kaca",Metal:"Logam",Miscellaneous_Trash:"Sampah Lainnya",Paper:"Kertas",Plastic:"Plastik",Textile_Trash:"Sampah Tekstil",Vegetation:"Vegetasi"};class Qe{constructor(){this.apiUrl="https://modelai14.s3.ap-southeast-2.amazonaws.com/dataset.json",this.dataset=null,this.isLoading=!1}async loadDataset(){if(!this.dataset&&!this.isLoading){this.isLoading=!0;try{console.log("Loading recommendation dataset...");const e=await fetch(this.apiUrl);if(!e.ok)throw new Error(`Failed to load dataset: ${e.status} ${e.statusText}`);this.dataset=await e.json(),console.log("Dataset loaded successfully:",this.dataset.length,"entries")}catch(e){throw console.error("Error loading dataset:",e),e}finally{this.isLoading=!1}}}normalizeWasteType(e){if(Ye[e])return Ye[e];const t=e.toLowerCase();return Ye[t]?Ye[t]:e}async getRecommendation(e,t){try{if(await this.loadDataset(),!this.dataset||!Array.isArray(this.dataset))throw new Error("Dataset not available or invalid format");const a=this.normalizeWasteType(e),n=parseFloat(t);if(isNaN(n)||n<=0)throw new Error("Invalid weight value");console.log(`Processing recommendation for category: ${a}, weight: ${n} kg`),console.log("Available categories in dataset:",[...new Set(this.dataset.map((e=>e.kategori)))]);const i=this.dataset.find((e=>e.kategori===a&&n>=e.berat_min_kg&&n<=e.berat_max_kg));if(i)return{kategori:a,berat_input_kg:n,berat_min_kg:i.berat_min_kg,berat_max_kg:i.berat_max_kg,rekomendasi:i.rekomendasi,message:`Rekomendasi untuk ${a} dengan berat ${n} kg`};const s=this.dataset.find((e=>e.kategori===a));if(s)return{kategori:a,berat_input_kg:n,berat_min_kg:s.berat_min_kg,berat_max_kg:s.berat_max_kg,rekomendasi:s.rekomendasi,message:`Berat sampah Anda (${n} kg) tidak sesuai dengan rentang rekomendasi umum (${s.berat_min_kg} - ${s.berat_max_kg} kg), namun berikut adalah rekomendasi umum untuk kategori ${a}.`};const r=[...new Set(this.dataset.map((e=>e.kategori)))];throw new Error(`No recommendation found for category "${a}". Available categories: ${r.join(", ")}`)}catch(e){throw console.error("Recommendation error:",e),new Error(`Failed to generate recommendation: ${e.message}`)}}}class et{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.uploadedImage=null,this.uploadedFile=null,this.classificationResult=null,this.showRecommendation=!1,this.model=new Xe,this.model.loadModel(),this.rekomendasiModel=new Qe,this.render(),this.initModelLoading(),this.wasteTypeColors={Cardboard:"#fd7e14",Food_Organics:"#198754",Glass:"#20c997",Metal:"#6c757d",Miscellaneous_Trash:"#dc3545",Paper:"#0dcaf0",Plastic:"#0d6efd",Textile_Trash:"#6f42c1",Vegetation:"#198754"}}render(){this.sidebarView.render(),this.app.innerHTML=`\n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n\n            \x3c!-- Main Content --\x3e\n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Klasifikasi Sampah</h2>\n                            <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                </header>\n\n                \x3c!-- Upload Section --\x3e\n                <section class="sampah-section">\n                    <div class="bg-white rounded-4 shadow-sm p-5 mx-auto" style="max-width: 64rem;">\n                        <div class="upload-box mb-3" id="upload-box">\n                            <i class="fas fa-upload"></i>\n                            <p>Upload Gambar Sampah</p>\n                            <input type="file" id="image-upload" accept="image/*" style="display: none;">\n                        </div>\n                        <div class="d-flex justify-content-end">\n                            <button class="btn btn-classify" type="button" id="classify-btn" disabled>Klasifikasi</button>\n                            </div>\n                            <div id="model-status" style="margin-top: 1rem; font-size: 0.9rem; color: #6c757d;">Memuat model...</div>\n                    </div>\n                </section>\n\n                \x3c!-- Result Section --\x3e\n                <section class="px-4 pb-5" id="result-section" style="display: none;">\n                    <div class="result-card">\n                        <h3 class="result-title">Hasil Klasifikasi</h3>\n                        <div class="result-content">\n                            <img id="result-image" src="" alt="Uploaded waste image" />\n                            <div class="result-text">\n                                \x3c!-- Classification Results --\x3e\n                                <div class="classification-results">\n                                    <div class="prediction-section">\n                                        <h4>Top Prediction:</h4>\n                                        <div class="top-prediction" id="top-prediction">\n                                            <div class="prediction-item">\n                                                <div class="prediction-label">\n                                                    <span class="color-indicator" id="top-color"></span>\n                                                    <span id="top-waste-type">-</span>\n                                                </div>\n                                                <div class="confidence-score">\n                                                    Confidence: <span id="top-confidence">-</span>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    \n                                    <div class="alternative-section">\n                                        <h4>Alternative Predictions:</h4>\n                                        <div class="alternative-predictions" id="alternative-predictions">\n                                            \x3c!-- Alternative predictions will be inserted here --\x3e\n                                        </div>\n                                    </div>\n                                </div>\n                                \n                                \x3c!-- Form Input Quantity --\x3e\n                                <div class="form-section">\n                                    <form id="form-tambah-quantity" class="form">\n                                        <div class="form-group">\n                                            <label for="quantity">Input Quantity</label>\n                                            <input type="text" id="quantity" class="form-control" required>\n                                        </div>\n                                    </form>\n                                </div>\n                                \n                                \x3c!-- Action Buttons --\x3e\n                                <div class="result-buttons">\n                                    <button class="btn btn-classify" type="button" id="recycle-btn">Sampah di daur ulang</button>\n                                    <button class="btn btn-classify" type="button" id="sell-btn">Sampah Dijual</button>\n                                </div>\n                                \n                                \x3c!-- Recommendation Section (Initially Hidden) --\x3e\n                                <div id="recommendation-section" style="display: none; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e9ecef;">\n                                    <p><span>Rekomendasi Pengolahan sampah</span><span id="waste-recommendation">-</span></p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </section>\n            </div>\n        `,this.bindEvents()}bindEvents(){this.eventListeners.forEach((({element:e,event:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[];const e=document.getElementById("upload-box"),t=document.getElementById("image-upload"),a=document.getElementById("classify-btn"),n=()=>t.click();e.addEventListener("click",n),this.eventListeners.push({element:e,event:"click",handler:n});const i=e=>this.handleFileUpload(e);t.addEventListener("change",i),this.eventListeners.push({element:t,event:"change",handler:i});const s=t=>{t.preventDefault(),e.classList.add("dragover")},r=()=>{e.classList.remove("dragover")},l=t=>{t.preventDefault(),e.classList.remove("dragover");const a=t.dataTransfer.files;a.length>0&&this.handleFileUpload({target:{files:a}})};e.addEventListener("dragover",s),e.addEventListener("dragleave",r),e.addEventListener("drop",l),this.eventListeners.push({element:e,event:"dragover",handler:s}),this.eventListeners.push({element:e,event:"dragleave",handler:r}),this.eventListeners.push({element:e,event:"drop",handler:l});const o=()=>this.classifyWaste();a.addEventListener("click",o),this.eventListeners.push({element:a,event:"click",handler:o});const d=document.getElementById("recycle-btn"),c=document.getElementById("sell-btn"),h=()=>this.handleWasteAction("recycle"),m=()=>this.handleWasteAction("sell");d&&(d.addEventListener("click",h),this.eventListeners.push({element:d,event:"click",handler:h})),c&&(c.addEventListener("click",m),this.eventListeners.push({element:c,event:"click",handler:m}))}setModelStatus(e,t="loading"){const a=document.getElementById("model-status");a&&(a.textContent=e,a.className=`model-status ${t}`)}async initModelLoading(){this.setModelStatus("Memuat model...","#6c757d");try{await this.model.loadModel(),this.setModelStatus("Model berhasil dimuat","#28a745")}catch(e){console.error("Gagal memuat model:",e),this.setModelStatus("Gagal memuat model","#dc3545")}}handleFileUpload(e){const t=e.target.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void alert("Please select a valid image file.");if(t.size>5242880)return void alert("File size should be less than 5MB.");this.uploadedFile=t;const a=new FileReader;a.onload=e=>{this.uploadedImage=e.target.result,this.displayUploadedImage(e.target.result),document.getElementById("classify-btn").disabled=!1},a.readAsDataURL(t)}displayUploadedImage(e){const t=document.getElementById("upload-box");t.classList.add("has-image"),t.innerHTML=`\n      <img src="${e}" alt="Uploaded waste image">\n      <p style="margin-top: 1rem; color: #28a745; font-weight: 600;">\n        <i class="fas fa-check-circle"></i> Gambar berhasil diupload\n      </p>\n      <p style="font-size: 0.75rem; color: #6c757d;">Klik untuk mengganti gambar</p>\n    `}async classifyWaste(){const e=document.getElementById("classify-btn"),t=e.innerHTML;e.innerHTML='<span class="loading"></span>Mengklasifikasi...',e.disabled=!0;try{if(!this.model.model)throw new Error("Model belum selesai dimuat.");const e=(await this.model.predict(this.uploadedFile)).topPredictions.map((e=>({type:e.className,confidence:parseFloat(e.confidence.toFixed(2)),color:this.wasteTypeColors[e.className]||"#6c757d"})));this.classificationResult={topPrediction:e[0],alternativePredictions:e.slice(1)},this.showRecommendation=!1,this.displayClassificationResult()}catch(e){alert(`Terjadi kesalahan saat mengklasifikasi sampah: ${e.message}`)}finally{e.innerHTML=t,e.disabled=!1}}displayClassificationResult(){const e=document.getElementById("result-section");document.getElementById("result-image").src=this.uploadedImage,document.getElementById("top-waste-type").textContent=this.classificationResult.topPrediction.type,document.getElementById("top-confidence").textContent=this.classificationResult.topPrediction.confidence+"%",document.getElementById("top-color").style.backgroundColor=this.classificationResult.topPrediction.color;const t=document.getElementById("alternative-predictions");t.innerHTML="",this.classificationResult.alternativePredictions.forEach((e=>{const a=document.createElement("div");a.className="prediction-item alternative-item",a.innerHTML=`\n        <div class="prediction-label">\n          <span class="color-indicator" style="background-color: ${e.color}"></span>\n          <span>${e.type}</span>\n        </div>\n        <div class="confidence-score">${e.confidence}%</div>\n      `,t.appendChild(a)})),document.getElementById("recommendation-section").style.display="none",e.style.display="block",e.scrollIntoView({behavior:"smooth"})}async handleWasteAction(e){const t=document.getElementById("quantity").value.trim();if(!t||isNaN(t))return void alert("Silakan masukkan quantity dalam angka.");const a=this.classificationResult.topPrediction.type;"recycle"===e?confirm("Apakah Anda yakin ingin mendaur ulang sampah ini?")&&(alert(`Sampah akan didaur ulang sebanyak ${t} kg.`),await this.showWasteRecommendation(a,t)):"sell"===e&&confirm("Apakah Anda yakin ingin menjual sampah ini?")&&(this.saveClassificationDataForSell(t),window.location.href="#/penjualan-sampah")}saveClassificationDataForSell(e){const t={image:this.uploadedImage,category:this.classificationResult.topPrediction.type,confidence:this.classificationResult.topPrediction.confidence,quantity:parseFloat(e),timestamp:(new Date).toISOString()};try{localStorage.setItem("penjualanSampahData",JSON.stringify(t)),console.log("Data penjualan sampah disimpan:",t)}catch(e){console.error("Gagal menyimpan data penjualan:",e),alert("Terjadi kesalahan saat menyimpan data untuk penjualan")}}async showWasteRecommendation(e,t){const a=document.getElementById("recommendation-section"),n=document.getElementById("waste-recommendation");n.innerHTML='<span class="loading"></span> Memuat rekomendasi...',a.style.display="block";try{this.rekomendasiModel.dataset||await this.rekomendasiModel.loadDataset();const i=await this.rekomendasiModel.getRecommendation(e,t);if(i&&i.rekomendasi){let e=[];e=Array.isArray(i.rekomendasi)?i.rekomendasi:"string"==typeof i.rekomendasi?i.rekomendasi.split(","):[String(i.rekomendasi)];const t=e.map((e=>`<li>${e.trim()}</li>`)).join("");n.innerHTML=`\n          <div class="recommendation-content">\n            <h5>Rekomendasi untuk ${i.kategori}</h5>\n            <div class="recommendation-details">\n              <p><strong>Berat input:</strong> ${i.berat_input_kg} kg</p>\n              <p><strong>Rentang optimal:</strong> ${i.berat_min_kg} - ${i.berat_max_kg} kg</p>\n              ${i.message?`<p class="text-info">${i.message}</p>`:""}\n              <div class="recommendation-text">\n                <h6>Cara Pengolahan:</h6>\n                <ol>\n                  ${t}\n                </ol>\n              </div>\n            </div>\n          </div>\n        `}else n.innerHTML='\n          <div class="recommendation-content">\n            <p class="text-warning">Rekomendasi tidak tersedia untuk jenis sampah ini.</p>\n            <p class="text-muted">Silakan konsultasikan dengan petugas pengelola sampah setempat.</p>\n          </div>\n        ';a.scrollIntoView({behavior:"smooth"})}catch(e){console.error("Error getting recommendation:",e),n.innerHTML=`\n        <div class="recommendation-content">\n          <p class="text-danger">Gagal memuat rekomendasi.</p>\n          <p class="text-muted">Error: ${e.message}</p>\n          <p class="text-info">Silakan coba lagi atau konsultasikan dengan petugas pengelola sampah setempat.</p>\n        </div>\n      `,a.style.display="block"}}destroy(){this.eventListeners.forEach((({element:e,event:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}}class tt{constructor(){this.view=new et}init(){this.view.render();const e=B();this.view.displayUserInfo(e)}destroy(){this.view.destroy()}}var at=a(7096),nt={};nt.styleTagTransform=f(),nt.setAttributes=b(),nt.insert=p().bind(null,"head"),nt.domAPI=m(),nt.insertStyleElement=y();c()(at.A,nt);at.A&&at.A.locals&&at.A.locals;class it{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.profileData={namaLengkap:"Nazira Ayu",username:"Jeje",email:"Jeje@gmail.com",noTelepon:"081703023782"}}render(){this.sidebarView.render(),this.app.innerHTML=`\n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n\n            \x3c!-- Main Content --\x3e\n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Pengaturan Akun</h2>\n                            <p class="text-dark mb-4">Edit Profile Kamu</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                    <div class="table-actions">\n                        <a href="#/detail-profile" class="classify-btn" data-route="detailProfile">\n                            <i class="bi bi-person-circle"></i>\n                            <span class="nav-text">Detail Profile</span>\n                        </a>\n                        <a href="#/edit-profile" class="classify-btn active" data-route="editProfile">\n                            <i class="bi bi-pencil-square"></i>\n                            <span class="nav-text">Edit Profile</span>\n                        </a>\n                        <a href="#/ubah-password" class="classify-btn" data-route="ubahPassword">\n                            <i class="bi bi-key"></i>\n                            <span class="nav-text">Ubah Password</span>\n                        </a>\n                    </div>\n                </header>\n\n                <div class="content-section">\n                    <div class="content-header">\n                        <h3>Edit Profile</h3>\n                    </div>\n\n                    <form id="edit-profile-form" class="needs-validation" novalidate>\n                        <div class="row">\n                            \x3c!-- Profile Image Card --\x3e\n                            <div class="col-md-4 mb-4">\n                                <div class="card h-100">\n                                    <div class="card-body text-center">\n                                        <div class="user-avatar mb-3 position-relative">\n                                            <img id="profile-image" src="${W}" alt="Profile Image" class="rounded-circle" style="width: 120px; height: 120px; object-fit: cover;">\n                                            <div class="image-overlay">\n                                                <button type="button" class="btn btn-primary btn-sm upload-btn" id="upload-image-btn">\n                                                    <i class="bi bi-camera"></i>\n                                                </button>\n                                            </div>\n                                        </div>\n                                        <div class="profile-info">\n                                            <h4 class="card-title" id="preview-name">Nazira Ayu</h4>\n                                            <p class="text-muted mb-3" id="preview-role">User</p>\n                                            <input type="file" id="image-input" accept="image/*" style="display: none;">\n                                            <small class="text-muted d-block">\n                                                Ukuran maksimal: 2MB<br>\n                                                Format: JPG, PNG, GIF\n                                            </small>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            \x3c!-- Edit Form --\x3e\n                            <div class="col-md-8 mb-4">\n                                <div class="card h-100">\n                                    <div class="card-header">\n                                        <h5 class="card-title mb-0">\n                                            <i class="bi bi-pencil-square me-2"></i>\n                                            Edit Informasi Profile\n                                        </h5>\n                                    </div>\n                                    <div class="card-body">\n                                        <div class="row">\n                                            <div class="col-md-6 mb-3">\n                                                <label for="nama-lengkap" class="form-label fw-bold">\n                                                    Nama Lengkap <span class="text-danger">*</span>\n                                                </label>\n                                                <input type="text" class="form-control" id="nama-lengkap" \n                                                       name="namaLengkap" value="${this.profileData.namaLengkap}" \n                                                       required>\n                                                <div class="invalid-feedback">\n                                                    Nama lengkap harus diisi.\n                                                </div>\n                                            </div>\n                                            <div class="col-md-6 mb-3">\n                                                <label for="username" class="form-label fw-bold">\n                                                    Username <span class="text-danger">*</span>\n                                                </label>\n                                                <input type="text" class="form-control" id="username" \n                                                       name="username" value="${this.profileData.username}" \n                                                       required>\n                                                <div class="invalid-feedback">\n                                                    Username harus diisi.\n                                                </div>\n                                            </div>\n                                        </div>\n                                        \n                                        <div class="row">\n                                            <div class="col-md-6 mb-3">\n                                                <label for="email" class="form-label fw-bold">\n                                                    Email <span class="text-danger">*</span>\n                                                </label>\n                                                <input type="email" class="form-control" id="email" \n                                                       name="email" value="${this.profileData.email}" \n                                                       required>\n                                                <div class="invalid-feedback">\n                                                    Email harus valid.\n                                                </div>\n                                            </div>\n                                            <div class="col-md-6 mb-3">\n                                                <label for="no-telepon" class="form-label fw-bold">\n                                                    No. Telepon <span class="text-danger">*</span>\n                                                </label>\n                                                <input type="tel" class="form-control" id="no-telepon" \n                                                       name="noTelepon" value="${this.profileData.noTelepon}" \n                                                       required>\n                                                <div class="invalid-feedback">\n                                                    Nomor telepon harus diisi.\n                                                </div>\n                                            </div>\n                                        </div>\n\n                                        <div class="row mt-4">\n                                            <div class="col-12">\n                                                <div class="d-flex gap-2 justify-content-end">\n                                                    <button type="button" class="btn btn-outline-secondary" id="cancel-btn">\n                                                        <i class="bi bi-x-circle me-2"></i>\n                                                        Batal\n                                                    </button>\n                                                    <button type="submit" class="btn btn-primary" id="save-btn">\n                                                        <i class="bi bi-check-circle me-2"></i>\n                                                        Simpan Perubahan\n                                                    </button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n            </div>\n\n            \x3c!-- Loading Modal --\x3e\n            <div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">\n                <div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <div class="modal-body text-center p-4">\n                            <div class="spinner-border text-primary mb-3" role="status">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                            <p class="mb-0">Menyimpan perubahan...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Success Modal --\x3e\n            <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">\n                <div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <div class="modal-body text-center p-4">\n                            <div class="text-success mb-3">\n                                <i class="bi bi-check-circle-fill" style="font-size: 3rem;"></i>\n                            </div>\n                            <h5 class="mb-2">Berhasil!</h5>\n                            <p class="mb-3">Profile berhasil diperbarui.</p>\n                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.setupEventListeners(),this.displayUserInfo()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("upload-image-btn"),i=document.getElementById("image-input");if(n&&i){const e=()=>i.click();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e});const t=e=>this.handleImageUpload(e);i.addEventListener("change",t),this.eventListeners.push({element:i,type:"change",handler:t})}const s=document.getElementById("edit-profile-form");if(s){const e=e=>this.handleFormSubmit(e);s.addEventListener("submit",e),this.eventListeners.push({element:s,type:"submit",handler:e})}const r=document.getElementById("cancel-btn");if(r){const e=()=>this.handleCancel();r.addEventListener("click",e),this.eventListeners.push({element:r,type:"click",handler:e})}const l=document.getElementById("nama-lengkap");if(l){const e=e=>this.updateNamePreview(e.target.value);l.addEventListener("input",e),this.eventListeners.push({element:l,type:"input",handler:e})}this.setupFormValidation()}setupFormValidation(){document.getElementById("edit-profile-form").querySelectorAll("input[required]").forEach((e=>{const t=()=>this.validateField(e),a=()=>this.clearFieldError(e);e.addEventListener("blur",t),e.addEventListener("input",a),this.eventListeners.push({element:e,type:"blur",handler:t}),this.eventListeners.push({element:e,type:"input",handler:a})}))}validateField(e){const t=e.value.trim();let a=!0;return(e.hasAttribute("required")&&!t||"email"===e.type&&t&&!this.isValidEmail(t))&&(a=!1),a?e.classList.remove("is-invalid"):e.classList.add("is-invalid"),a}clearFieldError(e){e.value.trim()&&e.classList.remove("is-invalid")}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}handleImageUpload(e){const t=e.target.files[0];if(!t)return;if(t.size>2097152)return void alert("Ukuran file terlalu besar. Maksimal 2MB.");if(!t.type.startsWith("image/"))return void alert("File harus berupa gambar.");const a=new FileReader;a.onload=e=>{const t=document.getElementById("profile-image");t&&(t.src=e.target.result)},a.readAsDataURL(t)}updateNamePreview(e){const t=document.getElementById("preview-name");t&&(t.textContent=e||"Nama Lengkap")}handleFormSubmit(e){e.preventDefault();const t=e.target,a=new FormData(t),n=t.querySelectorAll("input[required]");let i=!0;if(n.forEach((e=>{this.validateField(e)||(i=!1)})),!i)return;const s=new bootstrap.Modal(document.getElementById("loadingModal"));s.show(),setTimeout((()=>{this.saveProfile(a),this.saveProfileHandler&&this.saveProfileHandler(this.profileData),s.hide();new bootstrap.Modal(document.getElementById("successModal")).show()}),2e3)}saveProfile(e){this.profileData={namaLengkap:e.get("namaLengkap"),username:e.get("username"),email:e.get("email"),noTelepon:e.get("noTelepon")}}handleCancel(){if(confirm("Apakah Anda yakin ingin membatalkan perubahan?")){window.location.hash="#/detail-profile",document.getElementById("nama-lengkap").value=this.profileData.namaLengkap,document.getElementById("username").value=this.profileData.username,document.getElementById("email").value=this.profileData.email,document.getElementById("no-telepon").value=this.profileData.noTelepon,document.getElementById("profile-image").src=W,document.getElementById("image-input").value="";const e=document.getElementById("edit-profile-form");e.classList.remove("was-validated"),e.querySelectorAll(".is-invalid").forEach((e=>e.classList.remove("is-invalid"))),this.updateNamePreview(this.profileData.namaLengkap)}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e=null){const t=document.getElementById("user-name"),a=document.getElementById("preview-name"),n=document.getElementById("preview-role");t&&e&&(t.textContent=e.nama_lengkap),a&&e&&(a.textContent=e.nama_lengkap),n&&e&&(n.textContent=e.role),e&&(document.getElementById("nama-lengkap").value=e.nama_lengkap,document.getElementById("username").value=e.username,document.getElementById("email").value=e.email,document.getElementById("no-telepon").value=e.no_hp)}bindSaveProfile(e){this.saveProfileHandler=e}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying EditProfileView"),this.removeEventListeners(),this.sidebarView&&this.sidebarView.destroy&&this.sidebarView.destroy()}}class st{constructor(){this.view=new it}init(){this.view.render();const e=B();this.view.displayUserInfo(e),this.view.bindSaveProfile(this.handleSaveProfile.bind(this))}async handleSaveProfile(e){const t=B();if(!t||!t.id_user)return;const a=await async function(e,t){try{const a=await fetch(`${C}/api/user/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()}catch(e){return console.error("Gagal update profil:",e),{success:!1,message:"Terjadi kesalahan saat update profile"}}}(t.id_user,{nama_lengkap:e.namaLengkap,username:e.username,email:e.email,no_hp:e.noTelepon});if(a.success){const a={...t,nama_lengkap:e.namaLengkap,username:e.username,email:e.email,no_hp:e.noTelepon};localStorage.setItem("currentUser",JSON.stringify(a)),console.log("✅ Profil berhasil diperbarui")}else alert("❌ "+a.message)}destroy(){this.view.destroy()}}var rt=a(2302),lt={};lt.styleTagTransform=f(),lt.setAttributes=b(),lt.insert=p().bind(null,"head"),lt.domAPI=m(),lt.insertStyleElement=y();c()(rt.A,lt);rt.A&&rt.A.locals&&rt.A.locals;class ot{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.passwordStrength={score:0,feedback:[]}}render(){this.sidebarView.render(),this.app.innerHTML=`\n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n\n            \x3c!-- Main Content --\x3e\n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Pengaturan Akun</h2>\n                            <p class="text-dark mb-4">Ubah Password Kamu</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Sevri Vendrian</span>\n                        </div>\n                    </div>\n                    <div class="table-actions">\n                        <a href="#/detail-profile" class="classify-btn" data-route="detailProfile">\n                            <i class="bi bi-person-circle"></i>\n                            <span class="nav-text">Detail Profile</span>\n                        </a>\n                        <a href="#/edit-profile" class="classify-btn" data-route="editProfile">\n                            <i class="bi bi-pencil-square"></i>\n                            <span class="nav-text">Edit Profile</span>\n                        </a>\n                        <a href="#/ubah-password" class="classify-btn active" data-route="ubahPassword">\n                            <i class="bi bi-key"></i>\n                            <span class="nav-text">Ubah Password</span>\n                        </a>\n                    </div>\n                </header>\n\n                <div class="content-section">\n                    <div class="content-header">\n                        <h3>Ubah Password</h3>\n                    </div>\n\n                    <div class="row justify-content-center">\n                        \x3c!-- Password Change Form --\x3e\n                        <div class="col-lg-8 col-md-10">\n                            <div class="card">\n                                <div class="card-header">\n                                    <h5 class="card-title mb-0">\n                                        <i class="bi bi-shield-lock me-2"></i>\n                                        Keamanan Password\n                                    </h5>\n                                </div>\n                                <div class="card-body">\n                                    <form id="change-password-form" class="needs-validation" novalidate>\n                                        \x3c!-- Current Password --\x3e\n                                        <div class="mb-4">\n                                            <label for="current-password" class="form-label fw-bold">\n                                                Password Saat Ini <span class="text-danger">*</span>\n                                            </label>\n                                            <div class="input-group">\n                                                <input type="password" class="form-control" id="current-password" \n                                                       name="currentPassword" required>\n                                                <button class="btn btn-outline-secondary" type="button" id="toggle-current">\n                                                    <i class="bi bi-eye"></i>\n                                                </button>\n                                            </div>\n                                            <div class="invalid-feedback">\n                                                Password saat ini harus diisi.\n                                            </div>\n                                        </div>\n\n                                        \x3c!-- New Password --\x3e\n                                        <div class="mb-3">\n                                            <label for="new-password" class="form-label fw-bold">\n                                                Password Baru <span class="text-danger">*</span>\n                                            </label>\n                                            <div class="input-group">\n                                                <input type="password" class="form-control" id="new-password" \n                                                       name="newPassword" required>\n                                                <button class="btn btn-outline-secondary" type="button" id="toggle-new">\n                                                    <i class="bi bi-eye"></i>\n                                                </button>\n                                            </div>\n                                            <div class="invalid-feedback">\n                                                Password baru harus diisi.\n                                            </div>\n                                        </div>\n\n                                        \x3c!-- Password Strength Indicator --\x3e\n                                        <div class="mb-4">\n                                            <div class="password-strength-container">\n                                                <div class="d-flex justify-content-between align-items-center mb-2">\n                                                    <small class="text-muted">Kekuatan Password:</small>\n                                                    <small id="strength-text" class="fw-bold">Sangat Lemah</small>\n                                                </div>\n                                                <div class="progress password-strength-bar">\n                                                    <div class="progress-bar" id="strength-bar" role="progressbar" \n                                                         style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>\n                                                </div>\n                                                <div id="password-feedback" class="mt-2">\n                                                    <small class="text-muted">\n                                                        Password harus mengandung minimal 8 karakter\n                                                    </small>\n                                                </div>\n                                            </div>\n                                        </div>\n\n                                        \x3c!-- Confirm Password --\x3e\n                                        <div class="mb-4">\n                                            <label for="confirm-password" class="form-label fw-bold">\n                                                Konfirmasi Password Baru <span class="text-danger">*</span>\n                                            </label>\n                                            <div class="input-group">\n                                                <input type="password" class="form-control" id="confirm-password" \n                                                       name="confirmPassword" required>\n                                                <button class="btn btn-outline-secondary" type="button" id="toggle-confirm">\n                                                    <i class="bi bi-eye"></i>\n                                                </button>\n                                            </div>\n                                            <div class="invalid-feedback">\n                                                Konfirmasi password tidak cocok.\n                                            </div>\n                                        </div>\n\n                                        \x3c!-- Password Requirements --\x3e\n                                        <div class="alert alert-info mb-4">\n                                            <h6 class="alert-heading">\n                                                <i class="bi bi-info-circle me-2"></i>\n                                                Persyaratan Password:\n                                            </h6>\n                                            <ul class="mb-0 password-requirements">\n                                                <li id="req-length" class="requirement">\n                                                    <i class="bi bi-x-circle text-danger me-2"></i>\n                                                    Minimal 8 karakter\n                                                </li>\n                                                <li id="req-uppercase" class="requirement">\n                                                    <i class="bi bi-x-circle text-danger me-2"></i>\n                                                    Minimal 1 huruf besar\n                                                </li>\n                                                <li id="req-lowercase" class="requirement">\n                                                    <i class="bi bi-x-circle text-danger me-2"></i>\n                                                    Minimal 1 huruf kecil\n                                                </li>\n                                                <li id="req-number" class="requirement">\n                                                    <i class="bi bi-x-circle text-danger me-2"></i>\n                                                    Minimal 1 angka\n                                                </li>\n                                                <li id="req-special" class="requirement">\n                                                    <i class="bi bi-x-circle text-danger me-2"></i>\n                                                    Minimal 1 karakter khusus (!@#$%^&*)\n                                                </li>\n                                            </ul>\n                                        </div>\n\n                                        \x3c!-- Action Buttons --\x3e\n                                        <div class="row">\n                                            <div class="col-12">\n                                                <div class="d-flex gap-2 justify-content-end">\n                                                    <button type="button" class="btn btn-outline-secondary" id="cancel-btn">\n                                                        <i class="bi bi-x-circle me-2"></i>\n                                                        Batal\n                                                    </button>\n                                                    <button type="submit" class="btn btn-primary" id="save-btn">\n                                                        <i class="bi bi-check-circle me-2"></i>\n                                                        Ubah Password\n                                                    </button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </form>\n                                </div>\n                            </div>\n\n                            \x3c!-- Security Tips Card --\x3e\n                            <div class="card mt-4">\n                                <div class="card-header">\n                                    <h5 class="card-title mb-0">\n                                        <i class="bi bi-shield-check me-2"></i>\n                                        Tips Keamanan\n                                    </h5>\n                                </div>\n                                <div class="card-body">\n                                    <div class="row">\n                                        <div class="col-md-6 mb-3">\n                                            <div class="d-flex">\n                                                <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>\n                                                <div>\n                                                    <h6 class="mb-1">Gunakan Password Unik</h6>\n                                                    <small class="text-muted">Jangan gunakan password yang sama untuk akun lain</small>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="col-md-6 mb-3">\n                                            <div class="d-flex">\n                                                <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>\n                                                <div>\n                                                    <h6 class="mb-1">Kombinasi Karakter</h6>\n                                                    <small class="text-muted">Campurkan huruf, angka, dan simbol</small>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="col-md-6 mb-3">\n                                            <div class="d-flex">\n                                                <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>\n                                                <div>\n                                                    <h6 class="mb-1">Hindari Informasi Pribadi</h6>\n                                                    <small class="text-muted">Jangan gunakan nama, tanggal lahir, atau info pribadi</small>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="col-md-6 mb-3">\n                                            <div class="d-flex">\n                                                <i class="bi bi-check-circle-fill text-success me-3 mt-1"></i>\n                                                <div>\n                                                    <h6 class="mb-1">Update Berkala</h6>\n                                                    <small class="text-muted">Ubah password secara berkala untuk keamanan</small>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Loading Modal --\x3e\n            <div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">\n                <div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <div class="modal-body text-center p-4">\n                            <div class="spinner-border text-primary mb-3" role="status">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                            <p class="mb-0">Mengubah password...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Success Modal --\x3e\n            <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">\n                <div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <div class="modal-body text-center p-4">\n                            <div class="text-success mb-3">\n                                <i class="bi bi-shield-check-fill" style="font-size: 3rem;"></i>\n                            </div>\n                            <h5 class="mb-2">Password Berhasil Diubah!</h5>\n                            <p class="mb-3">Password Anda telah berhasil diperbarui. Silakan login dengan password baru.</p>\n                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \x3c!-- Error Modal --\x3e\n            <div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">\n                <div class="modal-dialog modal-dialog-centered">\n                    <div class="modal-content">\n                        <div class="modal-body text-center p-4">\n                            <div class="text-danger mb-3">\n                                <i class="bi bi-x-circle-fill" style="font-size: 3rem;"></i>\n                            </div>\n                            <h5 class="mb-2" id="errorModalTitle">Gagal Mengubah Password</h5>\n                            <p class="mb-3" id="errorModalMessage">Password lama salah.</p>\n                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Tutup</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.setupEventListeners(),this.displayUserInfo()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a}),this.setupPasswordToggles();const n=document.getElementById("change-password-form");if(n){const e=e=>this.handleFormSubmit(e);n.addEventListener("submit",e),this.eventListeners.push({element:n,type:"submit",handler:e})}const i=document.getElementById("cancel-btn");if(i){const e=()=>this.handleCancel();i.addEventListener("click",e),this.eventListeners.push({element:i,type:"click",handler:e})}const s=document.getElementById("new-password");if(s){const e=e=>this.checkPasswordStrength(e.target.value);s.addEventListener("input",e),this.eventListeners.push({element:s,type:"input",handler:e})}const r=document.getElementById("confirm-password");if(r){const e=()=>this.validatePasswordMatch();r.addEventListener("input",e),this.eventListeners.push({element:r,type:"input",handler:e})}this.setupFormValidation()}setupPasswordToggles(){[{btn:"toggle-current",input:"current-password"},{btn:"toggle-new",input:"new-password"},{btn:"toggle-confirm",input:"confirm-password"}].forEach((({btn:e,input:t})=>{const a=document.getElementById(e),n=document.getElementById(t);if(a&&n){const e=()=>this.togglePasswordVisibility(n,a);a.addEventListener("click",e),this.eventListeners.push({element:a,type:"click",handler:e})}}))}togglePasswordVisibility(e,t){const a=t.querySelector("i");"password"===e.type?(e.type="text",a.className="bi bi-eye-slash"):(e.type="password",a.className="bi bi-eye")}setupFormValidation(){document.getElementById("change-password-form").querySelectorAll("input[required]").forEach((e=>{const t=()=>this.validateField(e),a=()=>this.clearFieldError(e);e.addEventListener("blur",t),e.addEventListener("input",a),this.eventListeners.push({element:e,type:"blur",handler:t}),this.eventListeners.push({element:e,type:"input",handler:a})}))}validateField(e){const t=e.value.trim();let a=!0;return e.hasAttribute("required")&&!t&&(a=!1),"confirm-password"===e.id&&(a=this.validatePasswordMatch()),a?e.classList.remove("is-invalid"):e.classList.add("is-invalid"),a}clearFieldError(e){e.value.trim()&&e.classList.remove("is-invalid")}validatePasswordMatch(){const e=document.getElementById("new-password").value,t=document.getElementById("confirm-password").value,a=document.getElementById("confirm-password");return t&&e!==t?(a.classList.add("is-invalid"),!1):!t||(a.classList.remove("is-invalid"),!0)}checkPasswordStrength(e){const t={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/\d/.test(e),special:/[!@#$%^&*(),.?":{}|<>]/.test(e)};Object.keys(t).forEach((e=>{const a=document.getElementById(`req-${e}`);a&&(t[e]?a.classList.add("met"):a.classList.remove("met"))}));const a=Object.values(t).filter(Boolean).length;this.updatePasswordStrengthIndicator(a,e.length)}updatePasswordStrengthIndicator(e,t){const a=document.getElementById("strength-bar"),n=document.getElementById("strength-text");let i="",s="",r=0;0===t?(s="Sangat Lemah",r=0,i="strength-very-weak"):e<2?(s="Sangat Lemah",r=20,i="strength-very-weak"):e<3?(s="Lemah",r=40,i="strength-weak"):e<4?(s="Cukup",r=60,i="strength-fair"):e<5?(s="Bagus",r=80,i="strength-good"):(s="Sangat Kuat",r=100,i="strength-strong"),a.style.width=r+"%",a.className=`progress-bar ${i}`,n.textContent=s,n.className=`fw-bold text-${i.split("-")[1]}`}handleFormSubmit(e){e.preventDefault();const t=e.target,a=new FormData(t),n=t.querySelectorAll("input[required]");let i=!0;n.forEach((e=>{this.validateField(e)||(i=!1)}));if(a.get("newPassword").length<8&&(i=!1,document.getElementById("new-password").classList.add("is-invalid")),!i)return;const s=new bootstrap.Modal(document.getElementById("loadingModal"));s.show(),setTimeout((()=>{if(a.get("newPassword")!==a.get("confirmPassword")){const e=document.getElementById("confirm-password");e.classList.add("is-invalid");const t=e.nextElementSibling;return t&&t.classList.contains("invalid-feedback")&&(t.textContent="Konfirmasi password tidak cocok."),void s.hide()}this.changePassword(a),s.hide()}),2e3)}changePassword(e){const t={currentPassword:e.get("currentPassword"),newPassword:e.get("newPassword")};this.changePasswordHandler&&this.changePasswordHandler(t)}handleCancel(){if(confirm("Apakah Anda yakin ingin membatalkan perubahan password?")){const e=document.getElementById("change-password-form");e.reset(),e.classList.remove("was-validated"),e.querySelectorAll(".is-invalid").forEach((e=>e.classList.remove("is-invalid"))),this.updatePasswordStrengthIndicator(0,0),document.querySelectorAll(".requirement").forEach((e=>{e.classList.remove("met")})),document.querySelectorAll('input[type="text"]').forEach((e=>{e.id.includes("password")&&(e.type="password")})),document.querySelectorAll(".bi-eye-slash").forEach((e=>{e.className="bi bi-eye"}))}}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e=null){const t=document.getElementById("user-name");t&&(t.textContent=e?e.name||e.username:"Sevri Vendrian")}bindChangePassword(e){this.changePasswordHandler=e}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying UbahPasswordView"),this.removeEventListeners(),this.sidebarView&&this.sidebarView.destroy&&this.sidebarView.destroy()}}class dt{constructor(){this.view=new ot}init(){this.view.render();const e=B();this.view.displayUserInfo(e),this.view.bindChangePassword(this.handleChangePassword.bind(this))}async handleChangePassword(e){const t=B();if(!t||!t.id_user)return;const a=await async function(e,t){try{const a=await fetch(`${C}/api/user/password/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()}catch(e){return console.error("Gagal ubah password:",e),{success:!1,message:"Terjadi kesalahan"}}}(t.id_user,{currentPassword:e.currentPassword,newPassword:e.newPassword});if(a.success){new bootstrap.Modal(document.getElementById("successModal")).show();const e=document.querySelector("#successModal button[data-bs-dismiss='modal']");if(e){const t=()=>{P(),window.location.hash="#/login",e.removeEventListener("click",t)};e.addEventListener("click",t)}}else{const e=new bootstrap.Modal(document.getElementById("errorModal")),t=document.getElementById("errorModalTitle"),n=document.getElementById("errorModalMessage");t&&(t.textContent="Gagal Mengubah Password"),n&&(n.textContent=a.message||"Terjadi kesalahan."),e.show()}}destroy(){this.view.destroy()}}class ct{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[]}render(){this.sidebarView.render(),this.app.innerHTML=`\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n\n      <div class="main-content">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Edit Rekening</h2>\n              <p class="text-dark mb-4">Perbarui data rekening</p>\n            </div>\n            <div class="user-profile">\n              <img id="user-avatar" src="${W}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n        </header>\n\n        <div class="rekening-section">\n          <div class="form-section">\n            <form id="form-edit-rekening" class="form">\n              <div class="form-group">\n                <label for="nama-pemilik">Nama Pemilik</label>\n                <input type="text" id="nama-pemilik" class="form-control" required>\n              </div>\n              <div class="form-group">\n                <label for="no-rekening">Nomor Rekening</label>\n                <input type="text" id="no-rekening" class="form-control" required>\n              </div>\n              <div class="form-group">\n                <label for="bank">Bank</label>\n                <select id="bank" class="form-control" required>\n                  <option value="">Memuat daftar bank...</option>\n                </select>\n              </div>\n              <div class="form-group">\n                <button type="submit" class="btn btn-primary">Simpan</button>\n                <button type="button" id="btn-kembali" class="btn btn-secondary">Kembali</button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    `,this.populateBankDropdown()}async populateBankDropdown(){const e=document.getElementById("bank");try{const t=await j();e.innerHTML='<option value="">-- Pilih Bank --</option>',t.forEach((t=>{const a=document.createElement("option");a.value=t.nama,a.textContent=`${t.nama} (${t.kode})`,e.appendChild(a)}))}catch{e.innerHTML='<option value="">Gagal memuat bank</option>'}}bindFormSubmit(e){const t=document.getElementById("form-edit-rekening"),a=t=>{t.preventDefault();const a={namaPemilik:document.getElementById("nama-pemilik").value.trim(),noRekening:document.getElementById("no-rekening").value.trim(),bank:document.getElementById("bank").value};e(a)};t.addEventListener("submit",a),this.eventListeners.push({element:t,type:"submit",handler:a})}bindBackButton(e){const t=document.getElementById("btn-kembali");t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}setFormData({namaPemilik:e,noRekening:t,bank:a}){document.getElementById("nama-pemilik").value=e,document.getElementById("no-rekening").value=t,document.getElementById("bank").value=a}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.name||e.username)}destroy(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)}))}}class ht{constructor(e){this.view=new ct,this.id_rekening=e,this.currentUser=B(),this.handleBack=this.handleBack.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this)}async init(){if(this.currentUser)this.view.render(),this.view.displayUserInfo(this.currentUser),this.view.bindFormSubmit(this.handleFormSubmit),this.view.bindBackButton(this.handleBack),await this.loadRekeningData();else{const e=new CustomEvent("navigate",{detail:{page:"login"}});document.dispatchEvent(e)}}async loadRekeningData(){const e=await M(this.currentUser.id_user);if(console.log("Hasil fetch rekening:",e),!e||"object"!=typeof e||!Array.isArray(e.data))return void console.error("Gagal memuat data rekening dari server:",e);const t=e.data.find((e=>String(e.id_rekening)===String(this.id_rekening)));t?this.view.setFormData({namaPemilik:t.nama_pemilik,noRekening:t.no_rek,bank:t.nama_bank}):console.warn("❗ ID rekening tidak ditemukan dalam data.")}async handleFormSubmit(e){if(!e.noRekening||!e.bank||!e.namaPemilik)return void alert("Semua field wajib diisi.");const t=await async function(e,t){try{const a=await fetch(`http://localhost:3000/api/rekening/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()}catch(e){return{success:!1,message:"Network error"}}}(this.id_rekening,{no_rek:e.noRekening,nama_bank:e.bank,nama_pemilik:e.namaPemilik});t.success?(alert("Rekening berhasil diubah!"),this.handleBack()):alert("Gagal: "+t.message)}handleBack(){const e=new CustomEvent("navigate",{detail:{page:"dataRekening"}});document.dispatchEvent(e)}destroy(){this.view&&"function"==typeof this.view.destroy&&this.view.destroy()}}class mt{constructor(){this.app=document.getElementById("content"),this.sidebarView=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1}render(){this.sidebarView.render(),this.app.innerHTML=`\n            \x3c!-- Mobile Menu Toggle --\x3e\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n\n            \x3c!-- Main Content --\x3e\n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <h2>Pengaturan Akun</h2>\n                            <p class="text-dark mb-4">Atur Profile Kamu</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                    <div class="table-actions">\n                        <a href="#/detail-profile" class="classify-btn" data-route="detailProfile">\n                            <i class="bi bi-person-circle"></i>\n                            <span class="nav-text">Detail Profile</span>\n                        </a>\n                        <a href="#/edit-profile" class="classify-btn" data-route="editProfile">\n                            <i class="bi bi-pencil-square"></i>\n                            <span class="nav-text">Edit Profile</span>\n                        </a>\n                        <a href="#/ubah-password" class="classify-btn" data-route="ubahPassword">\n                            <i class="bi bi-key"></i>\n                            <span class="nav-text">Ubah Password</span>\n                        </a>\n                    </div>\n                </header>\n\n                <div class="content-section">\n                    <div class="content-header">\n                        <h3>Detail Profile</h3>\n                    </div>\n\n                    <div class="row">\n                        \x3c!-- Profile Card --\x3e\n                        <div class="col-md-4 mb-4">\n                            <div class="card h-100">\n                                <div class="card-body text-center">\n                                    <div class="user-avatar mb-3">\n                                        <img src="${W}" alt="foto profile" class="rounded-circle" style="width: 120px; height: 120px; object-fit: cover;">\n                                    </div>\n                                    <div class="profile-info">\n                                        <h4 class="card-title"></h4>\n                                        <p class="text-muted mb-3"></p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Profile Details --\x3e\n                        <div class="col-md-8 mb-4">\n                            <div class="card h-100">\n                                <div class="card-header">\n                                    <h5 class="card-title mb-0">\n                                        <i class="bi bi-person-vcard me-2"></i>\n                                        Informasi Profile\n                                    </h5>\n                                </div>\n                                <div class="card-body">\n                                    <div class="table-responsive">\n                                        <table class="table table-borderless">\n                                            <tbody>\n                                                <tr>\n                                                    <td class="fw-bold" style="width: 30%;">Nama Lengkap</td>\n                                                    <td>:</td>\n                                                    <td id="detail-nama"></td>\n                                                </tr>\n                                                <tr>\n                                                    <td class="fw-bold">Username</td>\n                                                    <td>:</td>\n                                                    <td id="detail-username"></td>\n                                                </tr>\n                                                <tr>\n                                                    <td class="fw-bold">Email</td>\n                                                    <td>:</td>\n                                                    <td id="detail-email"></td>\n                                                </tr>\n                                                <tr>\n                                                    <td class="fw-bold">No. Telepon</td>\n                                                    <td>:</td>\n                                                    <td id="detail-phone"></td>\n                                                </tr> \n                                            </tbody>\n                                        </table>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.setupEventListeners(),this.displayUserInfo()}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("edit-photo-btn");if(n){const e=()=>this.handleEditPhoto();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}}bindEditProfile(e){const t=document.querySelector('[data-route="editProfileBtn"]');if(t){const a=t=>{t.preventDefault(),e()};t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}else console.warn("Button Edit Profile tidak ditemukan di DOM")}bindUbahPassword(e){const t=document.querySelector('[data-route="ubahPasswordBtn"]');if(t){const a=t=>{t.preventDefault(),e()};t.addEventListener("click",a),this.eventListeners.push({element:t,type:"click",handler:a})}else console.warn("Button Ubah Password tidak ditemukan di DOM")}handleEditPhoto(){console.log("Edit foto clicked")}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}displayUserInfo(e=null){const t=document.getElementById("user-name");t&&(t.textContent=e?e.name||e.username:"Sevri Vendrian")}updateProfileData(e){this.displayUserInfo(e);const t=document.querySelector(".profile-info .card-title"),a=document.querySelector(".profile-info .text-muted");t&&(t.textContent=e.nama_lengkap),a&&(a.textContent=e.role),document.getElementById("detail-nama").textContent=e.nama_lengkap,document.getElementById("detail-username").textContent=e.username,document.getElementById("detail-email").textContent=e.email,document.getElementById("detail-phone").textContent=e.no_hp}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){console.log("Destroying DetailProfilView"),this.removeEventListeners(),this.sidebarView&&this.sidebarView.destroy&&this.sidebarView.destroy()}}class ut{constructor(){this.view=new mt}async init(){this.view.render();const e=B();if(e&&e.id_user){const t=await T(e.id_user);t&&t.success&&this.view.updateProfileData(t.user)}}destroy(){this.view.destroy()}}var pt=a(9843);class gt{constructor(){this.view=new pt.A,this.view.setPresenter(this)}init(){this.view.render();const e=B();this.view.displayUserInfo(e),this.view.enableSubmit()}async submitPengajuan(){const e=B(),t=this.view.getFormData(),a=new FormData;a.append("user_id",e.id_user),a.append("kategori_sampah",t.kategoriSampah),a.append("berat",t.beratSampah);const n=await this.base64ToFile(t.gambarSampah,"gambar.jpg");a.append("gambar",n);const i=await async function(e){try{const t=await fetch(`${ne}/api/pengajuan`,{method:"POST",body:e});return await t.json()}catch(e){return console.error("Error saat mengirim pengajuan:",e),{success:!1,message:"Gagal terhubung ke server."}}}(a);i.success?this.view.showSuccess("Pengajuan berhasil disimpan."):this.view.showError(i.message)}async base64ToFile(e,t){const a=await fetch(e),n=await a.blob();return new File([n],t,{type:n.type})}}class bt{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.applicationData=null,this.isSubmitting=!1}render(e=null){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView(),e&&this.loadApplicationData(e)}renderMainContent(){this.app.innerHTML=`\n        <button id="mobile-menu-toggle" class="mobile-menu-btn">\n            <i class="bi bi-list"></i>\n        </button>\n        <div class="sidebar-overlay"></div>\n        \n        <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n            \x3c!-- Header Section --\x3e\n            <header>\n                <div class="header-section">\n                    <div class="dashboard-title">\n                        <div class="title-content">\n                            <h1>Form Penolakan</h1>\n                            <p>Tolak pengajuan dengan memberikan alasan yang jelas.</p>\n                        </div>\n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                </div>\n            </header>\n            \n            \x3c!-- Form Section --\x3e\n            <div class="rekening-section">\n                <div class="section-header">\n                    <h2 class="section-title">Detail Pengajuan & Form Penolakan</h2>\n                </div>\n\n                <div class="row">\n                    \x3c!-- Detail Pengajuan --\x3e\n                    <div class="col-lg-6 mb-4">\n                        <div class="card">\n                            <div class="card-header">\n                                <h5 class="card-title mb-0">\n                                    <i class="bi bi-info-circle"></i> Detail Pengajuan\n                                </h5>\n                            </div>\n                            <div class="card-body" id="application-detail">\n                                <div class="text-center">\n                                    <div class="spinner-border text-primary" role="status">\n                                    <span class="visually-hidden">Loading...</span>\n                                    </div>\n                                    <p class="mt-2">Memuat data pengajuan...</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Form Penolakan --\x3e\n                    <div class="col-lg-6 mb-4">\n                        <div class="card">\n                            <div class="card-header">\n                                <h5 class="card-title mb-0">\n                                    <i class="bi bi-x-circle text-danger"></i> Form Penolakan\n                                </h5>\n                            </div>\n                            <div class="card-body">\n                                <form id="rejection-form">\n                                    <div class="mb-3">\n                                        <label for="rejection-reason" class="form-label">\n                                            Alasan Penolakan <span class="text-danger">*</span>\n                                        </label>\n                                        <textarea \n                                            class="form-control" \n                                            id="rejection-reason" \n                                            name="rejectionReason"\n                                            rows="5" \n                                            placeholder="Masukkan alasan mengapa pengajuan ini ditolak..."\n                                            required>\n                                        </textarea>\n                                        <div class="form-text">\n                                            Berikan alasan yang jelas dan konstruktif untuk membantu user memahami penolakan.\n                                        </div>\n                                        <div class="invalid-feedback" id="reason-error">\n                                            Alasan penolakan wajib diisi.\n                                        </div>\n                                    </div>\n\n                                    <div class="d-flex gap-2">\n                                        <button \n                                            type="submit" \n                                            class="btn btn-danger flex-fill" \n                                            id="submit-rejection"\n                                            disabled\n                                        >\n                                            <i class="bi bi-x-circle"></i>\n                                            <span class="btn-text">Tolak Pengajuan</span>\n                                            <span class="spinner-border spinner-border-sm d-none" role="status"></span>\n                                        </button>\n                                        <button \n                                            type="button" \n                                            class="btn btn-secondary" \n                                            id="cancel-rejection"\n                                        >\n                                            <i class="bi bi-arrow-left"></i> Kembali\n                                        </button>\n                                    </div>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Success/Error Messages --\x3e\n                <div id="message-container"></div>\n            </div>\n        </div>\n        `}renderApplicationDetail(e){const t=document.getElementById("application-detail");if(!t||!e)return;const{statusClass:a,statusIcon:n,statusLabel:i}=this.getStatusStyles(e.status);t.innerHTML=`\n    <div class="application-info">\n        <div class="row">\n            <div class="col-md-6 mb-3">\n                <div class="info-group">\n                    <label class="info-label">Nama Lengkap</label>\n                    <div class="info-value">${e.name||"N/A"}</div>\n                </div>\n            </div>\n            <div class="col-md-6 mb-3">\n                <div class="info-group">\n                    <label class="info-label">No. HP</label>\n                    <div class="info-value">${e.phone||"N/A"}</div>\n                </div>\n            </div>\n        </div>\n\n        <div class="row">\n            <div class="col-md-6 mb-3">\n                <div class="info-group">\n                    <label class="info-label">Kategori Sampah</label>\n                    <div class="info-value">${e.category||"N/A"}</div>\n                </div>\n            </div>\n            <div class="col-md-6 mb-3">\n                <div class="info-group">\n                    <label class="info-label">Berat</label>\n                    <div class="info-value">${e.weight||0} kg</div>\n                </div>\n            </div>\n        </div>\n\n        <div class="row">\n            <div class="col-12 mb-3">\n                <div class="info-group">\n                    <label class="info-label">Foto Sampah</label>\n                    <div class="info-value">\n                        <div class="image-container">\n                        <img \n                            src="${e.image||"https://via.placeholder.com/300x200"}" \n                            alt="Foto Sampah" \n                            class="img-thumbnail waste-detail-img"\n                            style="max-width: 100%; height: auto; cursor: pointer;"\n                            onclick="this.requestFullscreen()"\n                        >\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        ${e.description?`\n        <div class="row">\n            <div class="col-12 mb-3">\n                <div class="info-group">\n                    <label class="info-label">Deskripsi</label>\n                    <div class="info-value">${e.description}</div>\n                </div>\n            </div>\n        </div>\n        `:""}\n    </div>\n    `;const s=document.getElementById("submit-rejection");s&&(s.disabled=!1),this.applicationData=e}getStatusStyles(e){return{"Menunggu Validasi":{class:"pending",icon:"bi-hourglass-split",label:"Menunggu Validasi"},Diterima:{class:"accepted",icon:"bi-clipboard-check",label:"Diterima"},Ditolak:{class:"rejected",icon:"bi-x-circle",label:"Ditolak"},pending:{class:"pending",icon:"bi-hourglass-split",label:"Menunggu Validasi"},accepted:{class:"accepted",icon:"bi-clipboard-check",label:"Diterima"},rejected:{class:"rejected",icon:"bi-x-circle",label:"Ditolak"}}[e]||{class:"pending",icon:"bi-hourglass-split",label:e||"Unknown"}}formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("rejection-form");if(n){const e=e=>this.handleFormSubmit(e);n.addEventListener("submit",e),this.eventListeners.push({element:n,type:"submit",handler:e})}const i=document.getElementById("cancel-rejection");if(i){const e=()=>this.handleCancel();i.addEventListener("click",e),this.eventListeners.push({element:i,type:"click",handler:e})}const s=document.getElementById("rejection-reason");if(s){const e=()=>this.validateForm();s.addEventListener("input",e),this.eventListeners.push({element:s,type:"input",handler:e})}}handleFormSubmit(e){if(e.preventDefault(),this.isSubmitting)return;const t=e.target,a=new FormData(t),n={applicationId:this.applicationData?.id,reason:a.get("rejectionReason").trim(),category:a.get("rejectionCategory"),notifyUser:a.has("notifyUser"),rejectedAt:(new Date).toISOString(),rejectedBy:"admin"};this.validateFormData(n)&&this.submitRejection(n)}validateForm(){const e=document.getElementById("rejection-reason"),t=document.getElementById("submit-rejection");if(e&&t){const a=e.value.trim().length>=10;t.disabled=!a||this.isSubmitting,e.value.trim().length>0&&e.value.trim().length<10?(e.classList.add("is-invalid"),document.getElementById("reason-error").textContent="Alasan penolakan minimal 10 karakter."):e.classList.remove("is-invalid")}}validateFormData(e){return!e.reason||e.reason.length<10?(this.showError("Alasan penolakan minimal 10 karakter."),!1):!!e.applicationId||(this.showError("Data pengajuan tidak valid."),!1)}submitRejection(e){this.isSubmitting=!0,this.updateSubmitButton(!0);const t=new CustomEvent("submit-rejection",{detail:e});document.dispatchEvent(t)}updateSubmitButton(e){const t=document.getElementById("submit-rejection"),a=t.querySelector(".btn-text"),n=t.querySelector(".spinner-border");e?(t.disabled=!0,a.textContent="Memproses...",n.classList.remove("d-none")):(t.disabled=!1,a.textContent="Tolak Pengajuan",n.classList.add("d-none"),this.isSubmitting=!1)}handleCancel(){confirm("Apakah Anda yakin ingin membatalkan proses penolakan?")&&window.history.back()}loadApplicationData(e){const t=new CustomEvent("load-application-detail",{detail:{id:e}});document.dispatchEvent(t)}displayApplicationData(e){this.applicationData=e,this.renderApplicationDetail(e)}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}showMessage(e,t="success"){const a=document.getElementById("message-container");if(!a)return;const n="success"===t?"alert-success":"alert-danger",i="success"===t?"bi-check-circle":"bi-exclamation-triangle";a.innerHTML=`\n        <div class="alert ${n} alert-dismissible fade show" role="alert">\n            <i class="bi ${i}"></i>\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        </div>\n        `,setTimeout((()=>{const e=a.querySelector(".alert");e&&e.remove()}),5e3)}showError(e){this.showMessage(e,"error"),this.updateSubmitButton(!1)}showSuccess(e){this.updateSubmitButton(!1),alert(e),window.location.hash="#/pengajuan"}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners()}}class vt{constructor(){this.view=new bt,this.model=new ge,this.pengajuanModel=new Ee,this.user=null,this.currentApplicationId=null,this.setupEventListeners()}async init(e=null){try{this.user=B(),e||(e=this.getApplicationIdFromUrl()),this.view.render(e),this.user&&this.view.displayUserInfo(this.user),e?(this.currentApplicationId=e,await this.loadApplicationDetail(e)):this.view.showError("ID pengajuan tidak ditemukan dalam URL.")}catch(e){console.error("Error initializing form penolakan:",e),this.view.showError("Terjadi kesalahan saat memuat halaman.")}}getApplicationIdFromUrl(){const e=window.location.hash,t=e.match(/\/penolakan\/(\d+)/)||e.match(/[?&]id=(\d+)/);return t?t[1]:null}setupEventListeners(){document.addEventListener("load-application-detail",(e=>{this.handleLoadApplicationDetail(e.detail)})),document.addEventListener("submit-rejection",(e=>{this.handleSubmitRejection(e.detail)})),document.addEventListener("request-user-info",(()=>{this.loadUserInfo()}))}async handleLoadApplicationDetail(e){e&&e.id?await this.loadApplicationDetail(e.id):this.view.showError("ID pengajuan tidak valid.")}async loadApplicationDetail(e){try{console.log("Loading application detail for ID:",e);const t=await this.pengajuanModel.getApplicationById(e);if(!t)throw new Error("Data pengajuan tidak ditemukan.");this.currentApplicationId=e,this.view.renderApplicationDetail(t)}catch(e){console.error("Error loading application detail:",e),this.view.showError(e.message||"Terjadi kesalahan saat memuat data pengajuan.")}}canRejectApplication(e){const t=e.status||e.statusOriginal;return["pending","Menunggu Validasi"].includes(t)}async handleSubmitRejection(e){try{if(console.log("Submitting rejection:",e),!e.applicationId&&this.currentApplicationId&&(e.applicationId=this.currentApplicationId),!this.validateRejectionData(e))return;e.rejectedBy=this.user?.id||this.user?.username||"admin",e.rejectedAt=(new Date).toISOString();const t=await this.pengajuanModel.rejectApplication(e);if(!t||!t.success)throw new Error(t?.message||"Gagal menolak pengajuan.");this.view.showSuccess("Pengajuan berhasil ditolak."),e.notifyUser&&await this.sendRejectionNotification(e),await this.logRejectionActivity(e),setTimeout((()=>{window.location.hash="#/pengajuan"}),2e3)}catch(e){console.error("Error submitting rejection:",e),this.view.showError(e.message||"Terjadi kesalahan saat memproses penolakan.")}}validateRejectionData(e){return e.applicationId?!e.reason||e.reason.trim().length<10?(this.view.showError("Alasan penolakan minimal 10 karakter."),!1):!(e.reason.trim().length>500)||(this.view.showError("Alasan penolakan maksimal 500 karakter."),!1):(this.view.showError("ID pengajuan tidak valid."),!1)}async sendRejectionNotification(e){try{console.log("Sending rejection notification...");const t={applicationId:e.applicationId,type:"rejection",title:"Pengajuan Ditolak",message:`Pengajuan Anda telah ditolak. Alasan: ${e.reason}`,category:e.category,timestamp:(new Date).toISOString()};"function"==typeof this.model.sendNotification?(await this.model.sendNotification(t),console.log("Rejection notification sent successfully")):console.log("Notification method not available in model")}catch(e){console.error("Error sending rejection notification:",e)}}async logRejectionActivity(e){try{console.log("Logging rejection activity...");const t={type:"application_rejected",applicationId:e.applicationId,adminId:await this.getCurrentUserId(),details:{reason:e.reason,category:e.category,notificationSent:e.notifyUser},timestamp:(new Date).toISOString()};"function"==typeof this.model.logActivity?(await this.model.logActivity(t),console.log("Rejection activity logged successfully")):console.log("Activity logging method not available in model")}catch(e){console.error("Error logging rejection activity:",e)}}async loadUserInfo(){try{let e=null;e="function"==typeof this.model.getCurrentUser?await this.model.getCurrentUser():B(),e&&(this.user=e,this.view.displayUserInfo(e))}catch(e){console.error("Error loading user info:",e)}}async getCurrentUserId(){try{let e=null;return e="function"==typeof this.model.getCurrentUser?await this.model.getCurrentUser():B(),e?.id||e?.username||"unknown"}catch(e){return console.error("Error getting current user ID:",e),"unknown"}}formatRejectionReason(e){return e.trim().charAt(0).toUpperCase()+e.trim().slice(1)}sanitizeInput(e){return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")}async getRejectionStats(){try{return"function"==typeof this.model.getRejectionStatistics?await this.model.getRejectionStatistics():null}catch(e){return console.error("Error getting rejection stats:",e),null}}async getRejectionHistory(e){try{return"function"==typeof this.model.getApplicationRejectionHistory?await this.model.getApplicationRejectionHistory(e):[]}catch(e){return console.error("Error getting rejection history:",e),[]}}async refreshApplicationData(){this.currentApplicationId&&await this.loadApplicationDetail(this.currentApplicationId)}destroy(){document.removeEventListener("load-application-detail",this.handleLoadApplicationDetail),document.removeEventListener("submit-rejection",this.handleSubmitRejection),document.removeEventListener("request-user-info",this.loadUserInfo),this.view&&"function"==typeof this.view.destroy&&this.view.destroy()}}class yt{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.applicationData=null,this.addressOptions=[]}render(e=null){this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView(),e&&this.loadApplicationData(e)}renderMainContent(){this.app.innerHTML=`\n        <button id="mobile-menu-toggle" class="mobile-menu-btn">\n            <i class="bi bi-list"></i>\n        </button>\n        <div class="sidebar-overlay"></div>\n        \n        <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n            \x3c!-- Header Section --\x3e\n            <header>\n                <div class="header-section">\n                    <div class="dashboard-title">\n                    <div class="title-content">\n                        <h1>Form Penawaran Harga</h1>\n                        <p>Buat penawaran harga untuk pengajuan sampah yang diterima.</p>\n                    </div>\n                    <div class="user-profile">\n                        <img id="user-avatar" src="${W}" alt="User">\n                        <span id="user-name">Loading...</span>\n                    </div>\n                    </div>\n                </div>\n            </header>\n            \n            \x3c!-- Form Section --\x3e\n            <div class="rekening-section">\n                <div class="section-header">\n                    <h2 class="section-title">Informasi Penawaran</h2>\n                    <button class="btn btn-secondary" id="back-btn">\n                        <i class="bi bi-arrow-left"></i> Kembali\n                    </button>\n                </div>\n\n                \x3c!-- Form Container --\x3e\n                <div class="form-container">\n                    <form id="penawaran-form" class="penawaran-form">\n                        \x3c!-- Image Display --\x3e\n                        <div class="form-group image-display">\n                            <div class="image-container">\n                                <img id="waste-image" src="" alt="Gambar Sampah" class="waste-display-image">\n                            </div>\n                        </div>\n\n                        \x3c!-- Form Fields --\x3e\n                        <div class="form-fields">\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="nama-lengkap" class="form-label">Nama Lengkap</label>\n                                        <div class="form-control-static" id="nama-lengkap">-</div>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="no-hp" class="form-label">No HP</label>\n                                        <div class="form-control-static" id="no-hp">-</div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="kategori-sampah" class="form-label">Kategori Sampah</label>\n                                        <div class="form-control-static" id="kategori-sampah">-</div>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="berat-sampah" class="form-label">Berat Sampah</label>\n                                        <div class="form-control-static" id="berat-sampah">- kg</div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="harga-sampah" class="form-label">Harga Sampah <span class="text-danger">*</span></label>\n                                        <div class="input-group">\n                                            <span class="input-group-text">Rp</span>\n                                            <input \n                                            type="number" \n                                            class="form-control" \n                                            id="harga-sampah" \n                                            name="harga-sampah"\n                                            placeholder="Masukkan harga per kg"\n                                            min="0"\n                                            step="100"\n                                            required\n                                            >\n                                            <span class="input-group-text">/ kg</span>\n                                        </div>\n                                        <div class="form-text">Harga akan dikalikan dengan berat sampah</div>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="pilih-alamat" class="form-label">Pilih Alamat (dropdown) <span class="text-danger">*</span></label>\n                                        <select class="form-select" id="pilih-alamat" name="pilih-alamat" required>\n                                            <option value="">Pilih alamat pickup...</option>\n                                            \x3c!-- Options will be populated dynamically --\x3e\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Total Calculation Display --\x3e\n                            <div class="total-section">\n                                <div class="total-card">\n                                    <div class="total-info">\n                                        <h5>Perhitungan Total</h5>\n                                        <div class="calculation-details">\n                                            <div class="calc-row">\n                                                <span>Berat Sampah:</span>\n                                                <span id="calc-weight">0 kg</span>\n                                            </div>\n                                            <div class="calc-row">\n                                                <span>Harga per kg:</span>\n                                                <span id="calc-price">Rp 0</span>\n                                            </div>\n                                            <div class="calc-row total-row">\n                                                <span><strong>Total Harga:</strong></span>\n                                                <span id="calc-total"><strong>Rp 0</strong></span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Action Buttons --\x3e\n                            <div class="form-actions">\n                                <button type="button" class="btn btn-secondary" id="cancel-btn">\n                                    <i class="bi bi-x-circle"></i> Batal\n                                </button>\n                                <button type="submit" class="btn btn-success" id="submit-btn">\n                                    <i class="bi bi-check-circle"></i> Terima Pengajuan\n                                </button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n\n                \x3c!-- Loading State --\x3e\n                <div class="loading-state" id="loading-state" style="display: none;">\n                    <div class="text-center">\n                        <div class="spinner-border text-primary" role="status">\n                            <span class="visually-hidden">Loading...</span>\n                        </div>\n                        <p class="mt-2">Memuat data pengajuan...</p>\n                    </div>\n                </div>\n\n                \x3c!-- Error State --\x3e\n                <div class="error-state" id="error-state" style="display: none;">\n                    <div class="text-center">\n                        <i class="bi bi-exclamation-triangle-fill text-warning"></i>\n                        <h4>Gagal Memuat Data</h4>\n                        <p id="error-message">Terjadi kesalahan saat memuat data pengajuan.</p>\n                        <button class="btn btn-primary" id="retry-btn">\n                            <i class="bi bi-arrow-clockwise"></i> Coba Lagi\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("back-btn");if(n){const e=()=>this.handleBack();n.addEventListener("click",e),this.eventListeners.push({element:n,type:"click",handler:e})}const i=document.getElementById("cancel-btn");if(i){const e=()=>this.handleCancel();i.addEventListener("click",e),this.eventListeners.push({element:i,type:"click",handler:e})}const s=document.getElementById("penawaran-form");if(s){const e=e=>this.handleFormSubmit(e);s.addEventListener("submit",e),this.eventListeners.push({element:s,type:"submit",handler:e})}const r=document.getElementById("harga-sampah");if(r){const e=()=>this.updateCalculation();r.addEventListener("input",e),this.eventListeners.push({element:r,type:"input",handler:e})}const l=document.getElementById("retry-btn");if(l){const e=()=>this.handleRetry();l.addEventListener("click",e),this.eventListeners.push({element:l,type:"click",handler:e})}}loadApplicationData(e){this.showLoading();const t=new CustomEvent("load-application-data",{detail:{applicationId:e}});document.dispatchEvent(t)}displayApplicationData(e){this.applicationData=e,this.hideLoading(),this.populateForm(e),this.updateCalculation()}populateForm(e){const t=document.getElementById("nama-lengkap"),a=document.getElementById("no-hp"),n=document.getElementById("kategori-sampah"),i=document.getElementById("berat-sampah"),s=document.getElementById("waste-image");t&&(t.textContent=e.name||"N/A"),a&&(a.textContent=e.phone||"N/A"),n&&(n.textContent=e.category||"N/A"),i&&(i.textContent=`${e.weight||0} kg`),s&&(s.src=e.image||"https://via.placeholder.com/400x300",s.alt=`Gambar ${e.category||"Sampah"}`);const r=document.getElementById("calc-weight");r&&(r.textContent=`${e.weight||0} kg`)}displayAddressOptions(e){this.addressOptions=e;const t=document.getElementById("pilih-alamat");t&&Array.isArray(e)&&(t.innerHTML='<option value="">Pilih alamat pickup...</option>',e.forEach((e=>{const a=document.createElement("option");a.value=e.id,a.textContent=`${e.name} - ${e.address}`,t.appendChild(a)})))}updateCalculation(){const e=document.getElementById("harga-sampah"),t=document.getElementById("calc-price"),a=document.getElementById("calc-total");if(!(e&&t&&a&&this.applicationData))return;const n=parseFloat(e.value)||0,i=n*(parseFloat(this.applicationData.weight)||0);t.textContent=`Rp ${n.toLocaleString("id-ID")}`,a.innerHTML=`<strong>Rp ${i.toLocaleString("id-ID")}</strong>`}handleFormSubmit(e){e.preventDefault();const t=new FormData(e.target),a=t.get("harga-sampah"),n=t.get("pilih-alamat");if(!a||a<=0)return void this.showError("Harga sampah harus diisi dan lebih dari 0");if(!n)return void this.showError("Alamat pickup harus dipilih");const i=parseFloat(this.applicationData?.weight)||0,s=parseFloat(a)*i,r={applicationId:this.applicationData?.id,hargaPerKg:parseFloat(a),alamatId:n,totalHarga:s,berat:i},l=new CustomEvent("submit-penawaran",{detail:r});document.dispatchEvent(l)}handleBack(){window.history.back()}handleCancel(){confirm("Apakah Anda yakin ingin membatalkan? Data yang sudah diisi akan hilang.")&&(window.location.hash="#/pengajuan")}handleRetry(){this.applicationData?.id&&this.loadApplicationData(this.applicationData.id)}showLoading(){const e=document.getElementById("loading-state"),t=document.querySelector(".form-container"),a=document.getElementById("error-state");e&&(e.style.display="block"),t&&(t.style.display="none"),a&&(a.style.display="none")}hideLoading(){const e=document.getElementById("loading-state"),t=document.querySelector(".form-container");e&&(e.style.display="none"),t&&(t.style.display="block")}showError(e){const t=document.getElementById("error-state"),a=document.getElementById("error-message"),n=document.getElementById("loading-state"),i=document.querySelector(".form-container");a&&(a.textContent=e),t&&(t.style.display="block"),n&&(n.style.display="none"),i&&(i.style.display="none")}showSuccess(e){alert(e)}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username||"User"),a&&e&&e.avatar&&(a.src=e.avatar)}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners()}}class wt{constructor(){this.view=new yt,this.model=new ge,this.user=null,this.currentApplicationId=null,this.setupEventListeners(),this.pengajuanModel=new Ee}async init(e=null){try{this.user=B(),e||(e=this.getApplicationIdFromUrl()),this.view.render(e),this.user&&this.view.displayUserInfo(this.user),await this.loadAddressOptions(),e?(this.currentApplicationId=e,await this.loadApplicationData(e)):this.view.showError("ID pengajuan tidak ditemukan dalam URL.")}catch(e){console.error("Error initializing FormPenawaranPresenter:",e),this.view.showError("Terjadi kesalahan saat memuat halaman.")}}getApplicationIdFromUrl(){const e=window.location.hash.split("?")[1];return new URLSearchParams(e).get("id")}setupEventListeners(){this.boundLoadApplicationData=this.loadApplicationData.bind(this),this.boundSubmitPenawaran=this.submitPenawaran.bind(this),this.boundLoadUserInfo=this.loadUserInfo.bind(this),document.addEventListener("load-application-data",(e=>{this.handleLoadApplicationData(e.detail)})),document.addEventListener("submit-penawaran",(e=>{this.handleSubmitPenawaran(e.detail)})),document.addEventListener("request-user-info",(()=>{this.loadUserInfo()})),document.addEventListener("load-address-options",(()=>{this.loadAddressOptions()}))}async handleLoadApplicationData(e){const t=e?.applicationId||e?.id;t?await this.loadApplicationData(t):this.view.showError("ID pengajuan tidak valid.")}async loadApplicationData(e){try{console.log("Loading application data for ID:",e),this.view.showLoading();const t=await this.pengajuanModel.getApplicationById(e);if(!t)throw new Error("Data pengajuan tidak ditemukan.");this.currentApplicationId=e,this.view.displayApplicationData(t)}catch(e){console.error("Error loading application data:",e),this.view.showError(e.message||"Terjadi kesalahan saat memuat data pengajuan.")}}async loadAddressOptions(){try{const e=this.user?.id||this.user?.id_user;if(!e)throw new Error("User belum login");const t=await this.model.getAddresses(e);this.view.displayAddressOptions(t||[])}catch(e){console.error("Error loading address options:",e),this.view.displayAddressOptions([])}}async loadUserInfo(){try{let e=null;e="function"==typeof this.model.getCurrentUser?await this.model.getCurrentUser():B(),e&&(this.user=e,this.view.displayUserInfo(e))}catch(e){console.error("Error loading user info:",e)}}async submitPenawaran(e){return await this.handleSubmitPenawaran(e)}async handleSubmitPenawaran(e){try{if(!e.applicationId&&this.currentApplicationId&&(e.applicationId=this.currentApplicationId),!this.validateSubmissionData(e))return;e.offeredBy=this.user?.id||this.user?.username||"admin",e.offeredAt=(new Date).toISOString();const t=await this.pengajuanModel.submitOffer(e);if(!t||!t.success)throw new Error(t?.message||"Gagal menyimpan penawaran.");this.view.showSuccess("Penawaran berhasil diterima!"),setTimeout((()=>{window.location.hash="#/pengajuan"}),1500)}catch(e){console.error("Error submitting penawaran:",e),this.view.showError(e.message||"Terjadi kesalahan saat memproses penawaran.")}}validateSubmissionData(e){return e.applicationId?!e.hargaPerKg||e.hargaPerKg<=0?(this.view.showError("Harga per kg harus diisi dan lebih dari 0"),!1):e.alamatId?!e.berat||e.berat<=0?(this.view.showError("Berat sampah tidak valid"),!1):!(e.hargaPerKg>5e4)||(this.view.showError("Harga per kg terlalu tinggi (maksimal Rp 50.000)"),!1):(this.view.showError("Alamat pickup harus dipilih"),!1):(this.view.showError("ID pengajuan tidak valid"),!1)}handleRetry(){this.currentApplicationId&&this.loadApplicationData(this.currentApplicationId)}destroy(){document.removeEventListener("load-application-data",this.boundLoadApplicationData),document.removeEventListener("submit-penawaran",this.boundSubmitPenawaran),document.removeEventListener("request-user-info",this.boundLoadUserInfo),document.removeEventListener("load-address-options",this.loadAddressOptions),this.view&&"function"==typeof this.view.destroy&&this.view.destroy()}}class ft{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.applicationData=null,this.masterAlamat=[],this.selectedDeliveryMethod="mengantar"}render(e=null){this.applicationData=e,this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n            \n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <div class="d-flex align-items-center mb-3">    \n                                <div>\n                                    <h2>Form Ongkos Kirim</h2>\n                                    <p class="text-dark mb-0">Detail pengajuan dan pengaturan pengiriman</p>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                </header>\n        \n                <div class="rekening-section">\n                    <div class="section-header">\n                        <h2 class="section-title">Detail Ongkos Kirim</h2>\n                    </div>\n\n                    <div class="row">\n                        \x3c!-- Detail Sampah Card --\x3e\n                        <div class="col-md-6 mb-4">\n                            <div class="card border-0 shadow-sm">\n                                <div class="card-header bg-primary text-white">\n                                    <h5 class="mb-0"><i class="bi bi-recycle me-2"></i>Detail Sampah</h5>\n                                </div>\n                                <div class="card-body">\n                                    <div class="text-center mb-3">\n                                        <img id="sampah-image" src="" alt="Gambar Sampah" \n                                             class="img-fluid rounded shadow-sm" \n                                             style="max-height: 200px; object-fit: cover;">\n                                    </div>\n                                    \n                                    <div class="detail-info">\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Nama Lengkap:</strong></div>\n                                            <div class="col-7" id="nama-lengkap">-</div>\n                                        </div>\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>No. HP:</strong></div>\n                                            <div class="col-7" id="no-hp">-</div>\n                                        </div>\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Kategori Sampah:</strong></div>\n                                            <div class="col-7" id="kategori-sampah">-</div>\n                                        </div>\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Berat Sampah:</strong></div>\n                                            <div class="col-7" id="berat-sampah">-</div>\n                                        </div>\n                                        <div class="row mb-0">\n                                            <div class="col-5"><strong>Harga Sampah:</strong></div>\n                                            <div class="col-7" id="harga-sampah">-</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Form Pengiriman Card --\x3e\n                        <div class="col-md-6 mb-4">\n                            <div class="card border-0 shadow-sm">\n                                <div class="card-header bg-success text-white">\n                                    <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Metode Pengiriman</h5>\n                                </div>\n                                <div class="card-body">\n                                    \x3c!-- Radio Button Pilihan Pengiriman --\x3e\n                                    <div class="mb-4">\n                                        <label class="form-label fw-bold">Pilih Metode Pengiriman:</label>\n                                        <div class="form-check mb-2">\n                                            <input class="form-check-input" type="radio" \n                                                   name="delivery-method" id="mengantar" value="mengantar" checked>\n                                            <label class="form-check-label" for="mengantar">\n                                                <i class="bi bi-person-walking me-2"></i>Mengantar Sendiri\n                                            </label>\n                                        </div>\n                                        <div class="form-check">\n                                            <input class="form-check-input" type="radio" \n                                                   name="delivery-method" id="dijemput" value="dijemput">\n                                            <label class="form-check-label" for="dijemput">\n                                                <i class="bi bi-truck me-2"></i>Dijemput\n                                            </label>\n                                        </div>\n                                    </div>\n                                    \n                                    \x3c!-- Form Section --\x3e\n                                    <div id="delivery-form-section">\n                                        \x3c!-- Mengantar Sendiri Form --\x3e\n                                        <form id="mengantar-form" class="delivery-form">\n                                            <div class="alert alert-info">\n                                                <i class="bi bi-info-circle me-2"></i>\n                                                Silakan datang ke alamat berikut untuk mengantar sampah:\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Alamat Tujuan:</label>\n                                                <div class="card bg-light">\n                                                    <div class="card-body">\n                                                        <div class="d-flex justify-content-between align-items-start">\n                                                            <div>\n                                                                <p id="alamat-tujuan" class="mb-0">\n                                                                    Jl. Contoh Alamat No. 123, Kecamatan ABC, \n                                                                    Kabupaten XYZ, Jawa Timur 12345\n                                                                </p>\n                                                            </div>\n                                                            <a href="#" id="lokasi-link" class="btn btn-outline-primary btn-sm" \n                                                               title="Lihat Lokasi di Peta">\n                                                                <i class="bi bi-geo-alt-fill"></i>\n                                                            </a>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            <div class="mb-3">\n                                                <label for="pilih-rekening" class="form-label fw-bold">Pilih rekening Penjemputan:</label>\n                                                <select class="form-select" id="rekening-user-mengantar" name="rekening_id" required>\n                                                    <option value="">-- Pilih rekening --</option>\n                                                </select>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Total Harga:</label>\n                                                <div class="input-group">\n                                                    <span class="input-group-text">Rp</span>\n                                                    <input type="text" class="form-control fw-bold text-success" \n                                                           id="total-harga-mengantar" value="0" readonly>\n                                                </div>\n                                                <small class="text-muted">Total harga yang akan Anda terima</small>\n                                            </div>\n\n                                            <div class="mb-3">\n                                              <label class="form-label fw-bold">Estimasi Tanggal Mulai Pengantaran:</label>\n                                              <input type="date" class="form-control" id="estimasi-mulai-mengantar" readonly>\n                                            </div>\n                                            <div class="mb-3">\n                                              <label class="form-label fw-bold">Estimasi Tanggal Selesai Pengantaran:</label>\n                                              <input type="date" class="form-control" id="estimasi-selesai-mengantar" readonly>\n                                            </div>\n                                            \n                                            <div class="mt-4 text-end">\n                                                <button type="button" class="btn btn-secondary me-2 cancel-btn">\n                                                    Batal\n                                                </button>\n                                                <button type="submit" class="btn btn-primary submit-btn">\n                                                    <i class="bi bi-check-lg me-2"></i>Konfirmasi\n                                                </button>\n                                            </div>\n                                        </form>\n                                        \n                                        \x3c!-- Dijemput Form --\x3e\n                                        <form id="dijemput-form" class="delivery-form" style="display: none;">\n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Alamat Bank Sampah:</label>\n                                                <div class="card bg-light">\n                                                    <div class="card-body">\n                                                        <p id="alamat-user" class="mb-0">Loading alamat...</p>\n                                                    </div>\n                                                    <input type="hidden" id="latitude" name="latitude">\n                                                    <input type="hidden" id="longitude" name="longitude">\n                                                </div>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label for="pilih-alamat" class="form-label fw-bold">Pilih Alamat Penjemputan:</label>\n                                                <select class="form-select" id="pilih-alamat" name="alamat_id" required>\n                                                    <option value="">-- Pilih Alamat --</option>\n                                                </select>\n                                            </div>\n                                            <div class="mb-3">\n                                                <label for="pilih-rekening" class="form-label fw-bold">Pilih rekening Penjemputan:</label>\n                                                <select class="form-select" id="rekening-user-dijemput" name="rekening_id" required>\n                                                    <option value="">-- Pilih rekening --</option>\n                                                </select>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Estimasi Jarak:</label>\n                                                <div class="input-group">\n                                                    <span class="input-group-text"><i class="bi bi-rulers"></i></span>\n                                                    <input type="text" class="form-control" id="estimasi-jarak" \n                                                           value="Pilih alamat terlebih dahulu" readonly>\n                                                    <span class="input-group-text">km</span>\n                                                </div>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Ongkos Kirim:</label>\n                                                <div class="input-group">\n                                                    <span class="input-group-text">Rp</span>\n                                                    <input type="text" class="form-control text-danger" id="ongkir" \n                                                           name="ongkir" value="0" readonly>\n                                                </div>\n                                                <small class="text-muted">Ongkos kirim akan dihitung otomatis berdasarkan jarak</small>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Total Harga:</label>\n                                                <div class="input-group">\n                                                    <span class="input-group-text">Rp</span>\n                                                    <input type="text" class="form-control" id="total-harga-dijemput" \n                                                           value="0" readonly>\n                                                </div>\n                                                <small class="text-muted">Harga sampah + ongkos kirim</small>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                                <label class="form-label fw-bold">Pendapatan Anda:</label>\n                                                <div class="input-group">\n                                                    <span class="input-group-text">Rp</span>\n                                                    <input type="text" class="form-control fw-bold text-success" \n                                                           id="pendapatan" value="0" readonly>\n                                                </div>\n                                                <small class="text-muted">Harga sampah - ongkos kirim</small>\n                                            </div>\n                                            \n                                            <div class="mb-3">\n                                              <label class="form-label fw-bold">Estimasi Tanggal Mulai Penjemputan:</label>\n                                              <input type="date" class="form-control" id="estimasi-mulai-dijemput" readonly>\n                                            </div>\n                                            <div class="mb-3">\n                                              <label class="form-label fw-bold">Estimasi Tanggal Selesai Penjemputan:</label>\n                                              <input type="date" class="form-control" id="estimasi-selesai-dijemput" readonly>\n                                            </div>\n\n                                            <div class="mt-4 text-end">\n                                                <button type="button" class="btn btn-secondary me-2 cancel-btn">\n                                                    Batal\n                                                </button>\n                                                <button type="submit" class="btn btn-primary submit-btn">\n                                                    <i class="bi bi-check-lg me-2"></i>Konfirmasi\n                                                </button>\n                                            </div>\n                                        </form>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}populateApplicationData(e){if(!e)return;this.applicationData=e;const t=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e),a=document.getElementById("sampah-image");a&&e.gambarSampah&&(a.src=e.gambarSampah),document.getElementById("nama-lengkap").textContent=e.namaLengkap||"-",document.getElementById("no-hp").textContent=e.noHp||"-",document.getElementById("kategori-sampah").textContent=e.kategoriSampah||e.jenisSampah||"-",document.getElementById("berat-sampah").textContent=`${e.beratSampah||e.kuantitas||"-"} kg`,document.getElementById("harga-sampah").textContent=e.hargaSampah?t(e.hargaSampah):"-";let n=document.getElementById("total-harga-sampah");if(n)n.textContent=t(e.totalHarga);else{const a=document.getElementById("harga-sampah").parentElement.parentElement,n=document.createElement("div");n.className="row mb-0",n.innerHTML=`\n        <div class="col-5"><strong>Total Harga:</strong></div>\n        <div class="col-7" id="total-harga-sampah">${t(e.totalHarga)}</div>\n      `,a.parentElement.appendChild(n)}this.updateTotalHarga(e.totalHarga||0,0)}populateUserAddress(e){const t=document.getElementById("alamat-user"),a=document.getElementById("latitude"),n=document.getElementById("longitude"),i=document.getElementById("lat-display"),s=document.getElementById("lng-display"),r=e?.alamat&&e.alamat.trim()||e?.alamat_lengkap&&e.alamat_lengkap.trim()||null;console.log("Alamat yang akan ditampilkan:",r),t&&(t.textContent=r||"Alamat belum tersedia"),a&&(a.value=e?.latitude||""),n&&(n.value=e?.longitude||""),i&&(i.textContent=e?.latitude||"-"),s&&(s.textContent=e?.longitude||"-");const l=document.getElementById("alamat-user-info");l&&(l.textContent=r||"-")}populateMasterAlamat(e){this.masterAlamat=e;const t=document.getElementById("pilih-alamat");t&&(t.innerHTML='<option value="">-- Pilih Alamat --</option>',e.forEach((e=>{const a=document.createElement("option");a.value=e.id,a.textContent=`${e.nama} - ${e.alamat}`,a.dataset.jarak=e.jarak||0,t.appendChild(a)})))}displayUserRekening(e){["rekening-user-mengantar","rekening-user-dijemput"].forEach((t=>{const a=document.getElementById(t);if(a)if(a.innerHTML='<option value="">-- Pilih rekening --</option>',e&&0!==e.length)e.forEach((e=>{const t=document.createElement("option");t.value=e.id_rekening,t.textContent=`${e.nama_bank} - ${e.no_rek} a.n ${e.nama_pemilik}`,a.appendChild(t)}));else{const e=document.createElement("option");e.value="",e.textContent="Belum ada rekening.",a.appendChild(e)}}))}updateEstimasiJarak(e,t){const a=document.getElementById("estimasi-jarak"),n=document.getElementById("ongkir");if(a&&(a.value=e?`${e}`:"Tidak tersedia"),n){const e=e=>new Intl.NumberFormat("id-ID").format(e);n.value=t?e(t):"0"}if("dijemput"===this.selectedDeliveryMethod){const e=this.applicationData?.totalHarga||0;this.updateTotalHarga(e,t||0)}}updateTotalHarga(e,t){const a=e=>new Intl.NumberFormat("id-ID").format(e);if("mengantar"===this.selectedDeliveryMethod){const t=document.getElementById("total-harga-mengantar");t&&(t.value=a(e))}else{const n=e,i=e-(t||0),s=document.getElementById("total-harga-dijemput"),r=document.getElementById("pendapatan");if(s&&(s.value=a(n)),r){const e=i<0?"-"+a(Math.abs(i)):a(i);r.value=e,i<=0?(r.classList.remove("text-success"),r.classList.add("text-danger")):(r.classList.remove("text-danger"),r.classList.add("text-success"))}}}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});document.querySelectorAll(".cancel-btn").forEach((e=>{const t=()=>this.handleCancel();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}));document.querySelectorAll('input[name="delivery-method"]').forEach((e=>{const t=e=>this.handleDeliveryMethodChange(e.target.value);e.addEventListener("change",t),this.eventListeners.push({element:e,type:"change",handler:t})}));const n=document.getElementById("pilih-alamat");if(n){const e=e=>this.handleAlamatChange(e.target.value);n.addEventListener("change",e),this.eventListeners.push({element:n,type:"change",handler:e})}const i=document.getElementById("mengantar-form"),s=document.getElementById("dijemput-form");if(i){const e=e=>this.handleFormSubmit(e,"mengantar");i.addEventListener("submit",e),this.eventListeners.push({element:i,type:"submit",handler:e})}if(s){const e=e=>this.handleFormSubmit(e,"dijemput");s.addEventListener("submit",e),this.eventListeners.push({element:s,type:"submit",handler:e})}}handleDeliveryMethodChange(e){this.selectedDeliveryMethod=e;const t=document.getElementById("mengantar-form"),a=document.getElementById("dijemput-form");if("mengantar"===e){t.style.display="block",a.style.display="none";const e=this.applicationData?.hargaSampah||0;this.updateTotalHarga(e,0)}else{t.style.display="none",a.style.display="block";const e=document.getElementById("pilih-alamat");e&&(e.value=""),this.updateEstimasiJarak(null,null)}const n=new CustomEvent("delivery-method-changed",{detail:{method:e}});document.dispatchEvent(n)}handleAlamatChange(e){if(!e)return void this.updateEstimasiJarak(null,null);const t=new CustomEvent("alamat-changed",{detail:{alamatId:e}});document.dispatchEvent(t)}handleFormSubmit(e,t){e.preventDefault();const a=new FormData(e.target),n={applicationId:this.applicationData?.id,deliveryMethod:t,alamatId:"dijemput"===t?a.get("alamat_id"):null,ongkir:"dijemput"===t?a.get("ongkir"):"0"},i=new CustomEvent("form-submit",{detail:n});document.dispatchEvent(i)}handleCancel(){confirm("Apakah Anda yakin ingin membatalkan? Data yang telah diisi akan hilang.")&&(window.location.hash="#/diterima")}showLoading(e=!0){document.querySelectorAll(".submit-btn").forEach((t=>{e?(t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Memproses...'):(t.disabled=!1,t.innerHTML='<i class="bi bi-check-lg me-2"></i>Konfirmasi')}))}showError(e){const t=`\n            <div class="alert alert-danger alert-dismissible fade show" role="alert">\n                <i class="bi bi-exclamation-triangle me-2"></i>\n                ${e}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            </div>\n        `,a=document.getElementById("delivery-form-section");a&&(a.insertAdjacentHTML("afterbegin",t),setTimeout((()=>{const e=a.querySelector(".alert-danger");e&&e.remove()}),5e3))}showSuccess(e){const t=`\n            <div class="alert alert-success alert-dismissible fade show" role="alert">\n                <i class="bi bi-check-circle me-2"></i>\n                ${e}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            </div>\n        `,a=document.getElementById("delivery-form-section");a&&(a.insertAdjacentHTML("afterbegin",t),setTimeout((()=>{window.location.hash="#/diterima"}),3e3))}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username),a&&e&&e.avatar&&(a.src=e.avatar)}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),this.sidebar&&this.sidebar.destroy()}}const kt="https://greenshort-production.up.railway.app";class Et{constructor(){this.view=new ft,this.applicationData=null,this.userData=null,this.masterAlamat=[],this.selectedAlamat=null,this.ONGKIR_PER_KM=2e3,this.MINIMUM_ONGKIR=5e3,this.setupEventListeners(),this.alamatModel=new ge}async init(e=null){try{this.showLoadingState(),e&&await this.loadApplicationData(e),await this.loadUserData(),await this.loadMasterAlamat(),this.view.render(this.applicationData),this.setDefaultAlamatTujuan(),this.populateViewData(),this.handleDeliveryMethodChange("mengantar")}catch(e){console.error("Error initializing Form Ongkir:",e),this.view.showError("Gagal memuat data. Silakan coba lagi.")}}async loadApplicationData(e){try{const t=await async function(e){try{const t=await fetch(`${kt}/api/pengajuan/detail/${e}`),a=await t.json();if(!a.success)throw new Error(a.message);return a.data}catch(e){throw console.error("getPengajuanById Error:",e),e}}(e),a=parseFloat(t.berat)||0,n=parseFloat(t.harga_tawaran)||0;this.applicationData={id:t.id,namaLengkap:t.nama_lengkap,noHp:t.no_hp,kategoriSampah:t.jenis_sampah,beratSampah:a,hargaSampah:n,totalHarga:a*n,gambarSampah:t.gambar_sampah?`https://greenshort-production.up.railway.app${t.gambar_sampah}`:null,status:t.status}}catch(e){throw console.error("Gagal ambil data pengajuan:",e),e}}async loadUserData(){try{const e=B();if(!e)throw new Error("User belum login");const t=await T(e.id_user),a=await M(e.id_user),n=(await this.alamatModel.getUserAlamat(e.id_user)).data.map((e=>({id:e.id_alamat,nama:`${e.desa}, ${e.kecamatan}`,alamat:e.alamat_lengkap,latitude:e.latitude,longitude:e.longitude,jarak:0})));this.userData={id:e.id_user,...t.user,rekeningList:a.data||[],alamatList:n}}catch(e){throw console.error("Error loading user data:",e),new Error("Gagal memuat data pengguna")}}async loadMasterAlamat(){try{const e=await this.alamatModel.getAlamatAdmin();console.log("Alamat Admin dari DB:",e),this.masterAlamat=e;const t=e[0];t&&this.view.populateUserAddress({alamat:t.alamat_lengkap,latitude:t.latitude,longitude:t.longitude})}catch(e){throw console.error("Error loading master alamat:",e),e}}populateViewData(){if(this.applicationData&&this.view.populateApplicationData(this.applicationData),this.userData){this.view.displayUserInfo(this.userData),this.view.displayUserRekening(this.userData.rekeningList);const e=this.masterAlamat.find((e=>"Kantor Pusat"===e.nama))||this.masterAlamat[0];this.view.populateUserAddress(e),this.userData.alamatList.length>0&&this.view.populateMasterAlamat(this.userData.alamatList)}this.setDefaultAlamatTujuan()}setDefaultAlamatTujuan(){const e=this.masterAlamat.find((e=>"Kantor Pusat"===e.nama))||this.masterAlamat[0];if(console.log("Default Alamat Admin:",e),e){const t=document.getElementById("alamat-tujuan"),a=document.getElementById("lokasi-link");t&&(t.textContent=e.alamat),a&&e.latitude&&e.longitude&&(a.href=`https://www.google.com/maps?q=${e.latitude},${e.longitude}`,a.target="_blank")}}setupEventListeners(){document.addEventListener("delivery-method-changed",(e=>{this.handleDeliveryMethodChange(e.detail.method)})),document.addEventListener("alamat-changed",(e=>{this.handleAlamatChange(e.detail.alamatId)})),document.addEventListener("form-submit",(e=>{this.handleFormSubmit(e.detail)}))}handleDeliveryMethodChange(e){if(this.selectedAlamat=null,"dijemput"===e){const e=document.getElementById("pilih-alamat");e&&(e.value=""),this.view.updateEstimasiJarak(null,null)}else"mengantar"===e&&this.setDefaultAlamatTujuan();const t=this.getEstimasiTanggalRange(e);if("mengantar"===e){const e=document.getElementById("estimasi-mulai-mengantar"),a=document.getElementById("estimasi-selesai-mengantar");e&&(e.value=t.start),a&&(a.value=t.end)}else if("dijemput"===e){const e=document.getElementById("estimasi-mulai-dijemput"),a=document.getElementById("estimasi-selesai-dijemput");e&&(e.value=t.start),a&&(a.value=t.end)}}getEstimasiTanggalRange(e){const t=new Date;let a=new Date(t),n=new Date(t);"mengantar"===e?(a.setDate(t.getDate()+1),n.setDate(t.getDate()+2)):"dijemput"===e&&(a.setDate(t.getDate()+2),n.setDate(t.getDate()+4));const i=e=>e.toISOString().split("T")[0];return{start:i(a),end:i(n)}}hitungJarakKm(e,t,a,n){const i=e=>e*Math.PI/180,s=i(a-e),r=i(n-t),l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i(e))*Math.cos(i(a))*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}hitungOngkir(e,t){const a=Math.max(e,60);return 3e3*Math.ceil(a/60)+100*Math.ceil(t/1e3)}handleAlamatChange(e){if(!e)return this.selectedAlamat=null,void this.view.updateEstimasiJarak(null,null);this.selectedAlamat=this.userData.alamatList.find((t=>t.id==e));const t=this.masterAlamat.find((e=>"Kantor Pusat"===e.nama))||this.masterAlamat[0];if(this.selectedAlamat&&t){const e=Number(this.selectedAlamat.latitude),a=Number(this.selectedAlamat.longitude),n=Number(t.latitude),i=Number(t.longitude);if(isNaN(e)||isNaN(a)||isNaN(n)||isNaN(i))console.warn("Koordinat tidak valid untuk menghitung jarak."),this.view.updateEstimasiJarak(null,null);else{const t=this.hitungJarakKm(e,a,n,i);this.selectedAlamat.jarak=t;const s=1e3*(this.applicationData?.beratSampah||0),r=this.hitungOngkir(t,s);this.view.updateEstimasiJarak(t,r)}}}async handleFormSubmit(e){try{const t=this.validateFormData(e);if(!t.isValid)return void this.view.showError(t.message);this.view.showLoading(!0);const a=this.prepareSubmissionData(e);await this.submitForm(a),this.view.showSuccess("Form berhasil disimpan! Anda akan diarahkan kembali ke halaman sebelumnya.")}catch(e){console.error("Error submitting form:",e),this.view.showError("Gagal menyimpan data. Silakan coba lagi.")}finally{this.view.showLoading(!1)}}validateFormData(e){if(!e.applicationId)return{isValid:!1,message:"Data pengajuan tidak ditemukan."};if(!e.deliveryMethod)return{isValid:!1,message:"Pilih metode pengiriman."};if("dijemput"===e.deliveryMethod){if(!e.alamatId)return{isValid:!1,message:"Pilih alamat penjemputan."};if(!this.selectedAlamat)return{isValid:!1,message:"Alamat penjemputan tidak valid."}}return{isValid:!0,message:"Valid"}}prepareSubmissionData(e){const t={applicationId:e.applicationId,deliveryMethod:e.deliveryMethod,userId:this.userData?.id,timestamp:(new Date).toISOString()};if("dijemput"===e.deliveryMethod){const e=this.selectedAlamat,a=document.getElementById("rekening-user-dijemput")?.value,n=document.getElementById("estimasi-mulai-dijemput")?.value,i=document.getElementById("estimasi-selesai-dijemput")?.value,s=(this.applicationData,e?.jarak||0),r=parseInt(document.getElementById("pendapatan")?.value.replace(/[^\d]/g,""))||0,l=parseInt(document.getElementById("ongkir")?.value.replace(/[^\d]/g,""))||0;t.idRekening=a,t.alamatUserId=e?.id,t.estimasiJarak=s,t.ongkir=l,t.estimasiMulai=n,t.estimasiSelesai=i,t.totalHarga=r}else{const e=this.masterAlamat.find((e=>"Kantor Pusat"===e.nama))||this.masterAlamat[0],a=document.getElementById("rekening-user-mengantar")?.value,n=document.getElementById("estimasi-mulai-mengantar")?.value,i=document.getElementById("estimasi-selesai-mengantar")?.value,s=this.applicationData?.totalHarga||0;t.alamatTujuan=e,t.ongkir=0,t.idRekening=a,t.estimasiMulai=n,t.estimasiSelesai=i,t.totalHarga=s}return console.log("📤 Submitting form data:",t),t}async submitForm(e){try{if(this.view.showLoading(!0),"mengantar"===e.deliveryMethod)await async function(e,t){const a=await fetch(`${kt}/api/pengajuan/mengantar/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await a.json();if(!n.success)throw new Error(n.message||"Gagal update pengantaran");return n}(e.applicationId,{rekening_id:e.idRekening,total:e.totalHarga,tanggal_awal:e.estimasiMulai,tanggal_akhir:e.estimasiSelesai});else{const t={rekening_id:e.idRekening,alamat_user_id:e.alamatUserId,total:e.totalHarga,ongkir:e.ongkir,jarak_estimasi_km:e.estimasiJarak,tanggal_awal:e.estimasiMulai,tanggal_akhir:e.estimasiSelesai};console.log("📤 Payload untuk penjemputan:",t),await async function(e,t){const a=await fetch(`${kt}/api/pengajuan/dijemput/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=a.headers.get("content-type");if(!a.ok){const e=n?.includes("application/json")?(await a.json()).message:`HTTP ${a.status} - ${a.statusText}`;throw new Error(e||"Gagal update penjemputan")}return a.json()}(e.applicationId,t)}this.view.showSuccess("Form berhasil disimpan!")}catch(e){console.error("❌ Error saat submit:",e),this.view.showError(e.message||"Gagal menyimpan data. Silakan coba lagi.")}finally{this.view.showLoading(!1)}}showLoadingState(){console.log("Loading form data...")}static async navigateToForm(e){try{const t=new Et;return await t.init(e),t}catch(e){throw console.error("Error navigating to form:",e),e}}formatCurrency(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)}formatDistance(e){return e<1?`${(1e3*e).toFixed(0)} m`:`${e.toFixed(1)} km`}destroy(){document.removeEventListener("delivery-method-changed",this.handleDeliveryMethodChange),document.removeEventListener("alamat-changed",this.handleAlamatChange),document.removeEventListener("form-submit",this.handleFormSubmit),this.view&&this.view.destroy(),this.applicationData=null,this.userData=null,this.masterAlamat=[],this.selectedAlamat=null}}class Lt{constructor(){this.app=document.getElementById("content"),this.sidebar=new r.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.applicationData=null,this.uploadedFile=null}render(e=null){this.applicationData=e,this.sidebar.render(),this.renderMainContent(),this.setupEventListeners(),this.checkMobileView()}renderMainContent(){this.app.innerHTML=`\n            <button id="mobile-menu-toggle" class="mobile-menu-btn">\n                <i class="bi bi-list"></i>\n            </button>\n            <div class="sidebar-overlay"></div>\n            \n            <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n                <header>\n                    <div class="header-content">\n                        <div class="dashboard-header">\n                            <div class="d-flex align-items-center mb-3">    \n                                <div>\n                                    <h2>Form Selesaikan Transaksi</h2>\n                                    <p class="text-dark mb-0">Upload bukti transaksi untuk menyelesaikan proses</p>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="user-profile">\n                            <img id="user-avatar" src="${W}" alt="User">\n                            <span id="user-name">Loading...</span>\n                        </div>\n                    </div>\n                </header>\n        \n                <div class="rekening-section">\n                    <div class="section-header">\n                        <h2 class="section-title">Detail Transaksi</h2>\n                    </div>\n\n                    <div class="row">\n                        \x3c!-- Detail Sampah Card --\x3e\n                        <div class="col-md-6 mb-4">\n                            <div class="card border-0 shadow-sm">\n                                <div class="card-header bg-primary text-white">\n                                    <h5 class="mb-0"><i class="bi bi-recycle me-2"></i>Detail Sampah</h5>\n                                </div>\n                                <div class="card-body">\n                                    <div class="text-center mb-3">\n                                        <img id="sampah-image" src="" alt="Gambar Sampah" \n                                             class="img-fluid rounded shadow-sm" \n                                             style="max-height: 200px; object-fit: cover;">\n                                    </div>\n                                    \n                                    <div class="detail-info">\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Nama Lengkap:</strong></div>\n                                            <div class="col-7" id="nama-lengkap">-</div>\n                                        </div>\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>No. HP:</strong></div>\n                                            <div class="col-7" id="no-hp">-</div>\n                                        </div>\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Kategori Sampah:</strong></div>\n                                            <div class="col-7" id="kategori-sampah">-</div>\n                                        </div>\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Berat Sampah:</strong></div>\n                                            <div class="col-7" id="berat-sampah">-</div>\n                                        </div>\n                                        <div class="row mb-0">\n                                            <div class="col-5"><strong>Harga Sampah:</strong></div>\n                                            <div class="col-7" id="harga-sampah">-</div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Detail Pengiriman Card --\x3e\n                        <div class="col-md-6 mb-4">\n                            <div class="card border-0 shadow-sm">\n                                <div class="card-header bg-success text-white">\n                                    <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Detail Pengiriman</h5>\n                                </div>\n                                <div class="card-body">\n                                    <div class="detail-info">\n                                        <div class="row mb-2">\n                                            <div class="col-5"><strong>Metode:</strong></div>\n                                            <div class="col-7" id="metode-pengiriman">-</div>\n                                        </div>\n                                        <div class="row mb-0">\n                                            <div class="col-5"><strong>Total Bayar:</strong></div>\n                                            <div class="col-7">\n                                                <strong class="text-success" id="total-bayar">-</strong>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Upload Bukti Transaksi Card --\x3e\n                    <div class="row">\n                        <div class="col-12">\n                            <div class="card border-0 shadow-sm">\n                                <div class="card-header bg-info text-white">\n                                    <h5 class="mb-0"><i class="bi bi-cloud-upload me-2"></i>Upload Bukti Transaksi</h5>\n                                </div>\n                                <div class="card-body">\n                                    <form id="selesai-form">\n                                        <div class="mb-4">\n                                            <label for="bukti-transaksi" class="form-label">\n                                                <strong>Bukti Transaksi/Pembayaran</strong>\n                                            </label>\n                                            <div class="upload-area" id="upload-area">\n                                                <div class="upload-placeholder">\n                                                    <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>\n                                                    <p class="text-muted mb-2">Klik untuk upload atau drag & drop file di sini</p>\n                                                    <p class="text-muted small">Format: JPG, PNG, PDF (Max 5MB)</p>\n                                                </div>\n                                                <input type="file" id="bukti-transaksi" name="bukti_transaksi" \n                                                       accept="image/jpeg,image/jpg,image/png,application/pdf" \n                                                       style="display: none;">\n                                            </div>\n                                            \n                                            \x3c!-- Preview Area --\x3e\n                                            <div id="preview-area" class="mt-3" style="display: none;">\n                                                <div class="alert alert-success">\n                                                    <div class="d-flex align-items-center">\n                                                        <i class="bi bi-check-circle me-2"></i>\n                                                        <div class="flex-grow-1">\n                                                            <strong>File berhasil dipilih:</strong>\n                                                            <br>\n                                                            <span id="file-name" class="text-muted"></span>\n                                                        </div>\n                                                        <button type="button" class="btn btn-sm btn-outline-danger" id="remove-file">\n                                                            <i class="bi bi-trash"></i>\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                                \n                                                \x3c!-- Image Preview --\x3e\n                                                <div id="image-preview" class="text-center mt-3" style="display: none;">\n                                                    <img id="preview-image" src="" alt="Preview" \n                                                         class="img-fluid rounded shadow-sm" \n                                                         style="max-height: 300px; object-fit: contain;">\n                                                </div>\n                                            </div>\n                                        </div>\n                                        \n                                        \x3c!-- Action Buttons --\x3e\n                                        <div class="d-flex justify-content-between align-items-center">\n                                            <button type="button" id="cancel-btn" class="btn btn-secondary">\n                                                <i class="bi bi-arrow-left me-2"></i>Kembali\n                                            </button>\n                                            <button type="submit" id="submit-btn" class="btn btn-success btn-lg">\n                                                <i class="bi bi-check-circle me-2"></i>Kirim Bukti Transfer\n                                            </button>\n                                        </div>\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.setupUploadArea()}setupUploadArea(){const e=document.getElementById("upload-area"),t=document.getElementById("bukti-transaksi");e.style.cssText="\n            border: 2px dashed #dee2e6;\n            border-radius: 8px;\n            padding: 40px 20px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            background-color: #f8f9fa;\n        ",e.addEventListener("mouseenter",(()=>{e.style.borderColor="#007bff",e.style.backgroundColor="#e3f2fd"})),e.addEventListener("mouseleave",(()=>{e.style.borderColor="#dee2e6",e.style.backgroundColor="#f8f9fa"})),e.addEventListener("click",(()=>{t.click()})),e.addEventListener("dragover",(t=>{t.preventDefault(),e.style.borderColor="#007bff",e.style.backgroundColor="#e3f2fd"})),e.addEventListener("dragleave",(t=>{t.preventDefault(),e.style.borderColor="#dee2e6",e.style.backgroundColor="#f8f9fa"})),e.addEventListener("drop",(t=>{t.preventDefault(),e.style.borderColor="#dee2e6",e.style.backgroundColor="#f8f9fa";const a=t.dataTransfer.files;a.length>0&&this.handleFileSelect(a[0])}))}populateApplicationData(e){if(console.log("🖼 Menampilkan data ke UI:",e),!e)return;this.applicationData=e;const t=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e),a=document.getElementById("sampah-image");a&&e.gambarSampah&&(a.src="https://greenshort-production.up.railway.app"+e.gambarSampah),document.getElementById("nama-lengkap").textContent=e.namaLengkap||"-",document.getElementById("no-hp").textContent=e.noHp||"-",document.getElementById("kategori-sampah").textContent=e.kategoriSampah||e.jenisSampah||"-",document.getElementById("berat-sampah").textContent=`${e.beratSampah||e.kuantitas||"-"} kg`,document.getElementById("harga-sampah").textContent=e.hargaSampah?t(e.hargaSampah):"-",document.getElementById("metode-pengiriman").textContent=e.metodePengiriman??"-",document.getElementById("total-bayar").textContent=e.ongkosKirim?t(e.ongkosKirim):"-";const n=document.getElementById("status-pengiriman");e.status&&(n.textContent=e.status,n.className=`badge ${this.getStatusBadgeClass(e.status)}`)}getStatusBadgeClass(e){switch(e?.toLowerCase()){case"pending":return"bg-warning text-dark";case"proses":return"bg-info text-white";case"selesai":return"bg-success text-white";case"dibatalkan":return"bg-danger text-white";default:return"bg-secondary text-white"}}handleFileSelect(e){["image/jpeg","image/jpg","image/png","application/pdf"].includes(e.type)?e.size>5242880?this.showError("Ukuran file terlalu besar. Maksimal 5MB."):(this.uploadedFile=e,this.showFilePreview(e)):this.showError("Format file tidak didukung. Silakan pilih file JPG, PNG, atau PDF.")}showFilePreview(e){const t=document.getElementById("preview-area"),a=document.getElementById("image-preview"),n=document.getElementById("preview-image");if(document.getElementById("file-name").textContent=`${e.name} (${(e.size/1024/1024).toFixed(2)} MB)`,t.style.display="block",e.type.startsWith("image/")){const t=new FileReader;t.onload=e=>{n.src=e.target.result,a.style.display="block"},t.readAsDataURL(e)}else a.style.display="none"}removeFile(){this.uploadedFile=null,document.getElementById("preview-area").style.display="none",document.getElementById("bukti-transaksi").value=""}setupEventListeners(){this.removeEventListeners();const e=document.getElementById("mobile-menu-toggle");if(e){const t=()=>this.toggleSidebar();e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",handler:t})}const t=document.querySelector(".sidebar-overlay");if(t){const e=()=>this.toggleSidebar(!1);t.addEventListener("click",e),this.eventListeners.push({element:t,type:"click",handler:e})}const a=()=>this.handleResize();window.addEventListener("resize",a),this.eventListeners.push({element:window,type:"resize",handler:a});const n=document.getElementById("bukti-transaksi");if(n){const e=e=>{e.target.files.length>0&&this.handleFileSelect(e.target.files[0])};n.addEventListener("change",e),this.eventListeners.push({element:n,type:"change",handler:e})}const i=document.getElementById("remove-file");if(i){const e=()=>this.removeFile();i.addEventListener("click",e),this.eventListeners.push({element:i,type:"click",handler:e})}const s=document.getElementById("cancel-btn");if(s){const e=()=>this.handleCancel();s.addEventListener("click",e),this.eventListeners.push({element:s,type:"click",handler:e})}const r=document.getElementById("selesai-form");if(r){const e=e=>this.handleFormSubmit(e);r.addEventListener("submit",e),this.eventListeners.push({element:r,type:"submit",handler:e})}}handleFormSubmit(e){if(e.preventDefault(),!this.uploadedFile)return void this.showError("Silakan upload bukti transaksi terlebih dahulu.");const t=new FormData(e.target);t.append("application_id",this.applicationData?.id);const a=new CustomEvent("form-submit",{detail:{formData:t,applicationId:this.applicationData?.id,catatan:t.get("catatan")}});document.dispatchEvent(a)}handleCancel(){this.uploadedFile||document.getElementById("catatan").value.trim()?confirm("Apakah Anda yakin ingin kembali? Data yang telah diisi akan hilang.")&&this.handleBack():this.handleBack()}handleBack(){window.location.hash="#/diterima"}showLoading(e=!0){const t=document.getElementById("submit-btn");t&&(e?(t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Memproses...'):(t.disabled=!1,t.innerHTML='<i class="bi bi-check-circle me-2"></i>Selesaikan Transaksi'))}showError(e){const t=`\n            <div class="alert alert-danger alert-dismissible fade show" role="alert">\n                <i class="bi bi-exclamation-triangle me-2"></i>\n                ${e}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            </div>\n        `,a=document.querySelector(".card-body");a&&(a.insertAdjacentHTML("afterbegin",t),setTimeout((()=>{const e=a.querySelector(".alert-danger");e&&e.remove()}),5e3))}showSuccess(e){const t=`\n            <div class="alert alert-success alert-dismissible fade show" role="alert">\n                <i class="bi bi-check-circle me-2"></i>\n                ${e}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            </div>\n        `,a=document.querySelector(".card-body");a&&(a.insertAdjacentHTML("afterbegin",t),setTimeout((()=>{window.location.href="#/selesai"}),3e3))}displayUserInfo(e){const t=document.getElementById("user-name"),a=document.getElementById("user-avatar");t&&e&&(t.textContent=e.name||e.username),a&&e&&e.avatar&&(a.src=e.avatar)}toggleSidebar(e=null){const t=document.querySelector(".sidebar"),a=document.querySelector(".sidebar-overlay");null===e&&(e=!t.classList.contains("mobile-open")),e?(t.classList.add("mobile-open"),a.classList.add("active"),document.body.style.overflow="hidden"):(t.classList.remove("mobile-open"),a.classList.remove("active"),document.body.style.overflow="")}handleResize(){const e=this.isMobile;this.isMobile=window.matchMedia("(max-width: 768px)").matches,e!==this.isMobile&&this.checkMobileView()}checkMobileView(){const e=document.querySelector(".main-content");e&&(this.isMobile?(e.classList.add("full-width"),e.classList.remove("collapsed")):(e.classList.remove("full-width"),this.sidebarCollapsed&&e.classList.add("collapsed")))}removeEventListeners(){this.eventListeners.forEach((({element:e,type:t,handler:a})=>{e.removeEventListener(t,a)})),this.eventListeners=[]}destroy(){this.removeEventListeners(),this.sidebar&&this.sidebar.destroy()}}class xt{constructor(){this.view=new Lt,this.model=new ge,this.pengajuanModel=new Ee,this.user=null,this.currentApplicationId=null,this.setupEventListeners()}async init(e=null){try{this.user=B(),e||(e=this.getApplicationIdFromUrl()),this.view.render(e),this.user&&this.view.displayUserInfo(this.user),e?(this.currentApplicationId=e,await this.loadApplicationDetail(e)):this.view.showError("ID pengajuan tidak ditemukan dalam URL.")}catch(e){console.error("Error initializing form selesai:",e),this.view.showError("Terjadi kesalahan saat memuat halaman.")}}getApplicationIdFromUrl(){const e=window.location.hash,t=e.match(/\/selesai\/(\d+)/)||e.match(/[?&]id=(\d+)/);return t?t[1]:null}setupEventListeners(){document.getElementById("selesai-form");document.addEventListener("form-submit",(e=>{this.handleFormSubmit(e.detail)})),document.addEventListener("load-application-detail",(e=>{this.handleLoadApplicationDetail(e.detail)})),document.addEventListener("submit-completion",(e=>{this.handleSubmitCompletion(e.detail)})),document.addEventListener("request-user-info",(()=>{this.loadUserInfo()}))}async handleFormSubmit(e){try{const{formData:t,applicationId:a}=e;if(!t||!a)throw new Error("Data form tidak lengkap");const n=await async function(e,t){try{const a=await fetch(`https://greenshort-production.up.railway.app/api/penjualan/selesai/${e}`,{method:"PUT",body:t});return await a.json()}catch(e){return console.error("❌ Error updateSelesai:",e),{success:!1,message:"Error updating selesai data."}}}(a,t);n.success?this.view.showSuccess("Transaksi berhasil diselesaikan."):this.view.showError(n.message||"Gagal menyelesaikan transaksi.")}catch(e){console.error("Error submitting form selesai:",e),this.view.showError("Terjadi kesalahan saat mengirim data.")}}async handleLoadApplicationDetail(e){e&&e.id?await this.loadApplicationDetail(e.id):this.view.showError("ID pengajuan tidak valid.")}async loadApplicationDetail(e){try{console.log("🔍 Ambil data detail dari API untuk ID:",e);const t=await async function(e){try{const t=await fetch(`https://greenshort-production.up.railway.app/api/pengajuan/id/${e}`),a=await t.json();return a.success?a.data:null}catch(e){return console.error("❌ Error fetchSelesaiById:",e),null}}(e);if(!t)throw new Error("Data pengajuan tidak ditemukan.");const a={id:t.id,namaLengkap:t.name,noHp:t.phone,kategoriSampah:t.category,beratSampah:t.weight,hargaSampah:t.price,metodePengiriman:t.metode,ongkosKirim:t.totalBayar,gambarSampah:t.image};this.view.populateApplicationData(a)}catch(e){console.error("❌ Error loadApplicationDetail:",e),this.view.showError(e.message||"Terjadi kesalahan saat ambil detail.")}}canCompleteApplication(e){const t=e.status||e.statusOriginal;return["Diterima","accepted","in_process","ready_pickup"].includes(t)}async handleSubmitCompletion(e){try{if(console.log("Submitting completion:",e),!e.applicationId&&this.currentApplicationId&&(e.applicationId=this.currentApplicationId),!this.validateCompletionData(e))return;e.completedBy=this.user?.id||this.user?.username||"admin",e.completedAt=(new Date).toISOString();const t=await this.pengajuanModel.completeApplication(e);if(!t||!t.success)throw new Error(t?.message||"Gagal menyelesaikan pengajuan.");this.view.showSuccess("Pengajuan berhasil diselesaikan."),e.notifyUser&&await this.sendCompletionNotification(e),await this.logCompletionActivity(e),setTimeout((()=>{window.location.hash="#/pengajuan"}),2e3)}catch(e){console.error("Error submitting completion:",e),this.view.showError(e.message||"Terjadi kesalahan saat memproses penyelesaian.")}}validateCompletionData(e){if(!e.applicationId)return this.view.showError("ID pengajuan tidak valid."),!1;if(!e.buktiTransaksi)return this.view.showError("Bukti transaksi wajib diupload."),!1;if(e.buktiTransaksiFile){const t=this.validateFileUpload(e.buktiTransaksiFile);if(!t.valid)return this.view.showError(t.message),!1}return!(e.catatan&&e.catatan.trim().length>500)||(this.view.showError("Catatan maksimal 500 karakter."),!1)}validateFileUpload(e){return e?["image/jpeg","image/jpg","image/png","application/pdf"].includes(e.type)?e.size>5242880?{valid:!1,message:"Ukuran file terlalu besar. Maksimal 5MB."}:{valid:!0}:{valid:!1,message:"Format file tidak didukung. Silakan pilih file JPG, PNG, atau PDF."}:{valid:!1,message:"Silakan pilih file terlebih dahulu."}}async sendCompletionNotification(e){try{console.log("Sending completion notification...");const t={applicationId:e.applicationId,type:"completion",title:"Pengajuan Diselesaikan",message:"Pengajuan Anda telah diselesaikan. "+(e.catatan?"Catatan: "+e.catatan:""),category:e.category,timestamp:(new Date).toISOString()};"function"==typeof this.model.sendNotification?(await this.model.sendNotification(t),console.log("Completion notification sent successfully")):console.log("Notification method not available in model")}catch(e){console.error("Error sending completion notification:",e)}}async logCompletionActivity(e){try{console.log("Logging completion activity...");const t={type:"application_completed",applicationId:e.applicationId,adminId:await this.getCurrentUserId(),details:{buktiTransaksi:e.buktiTransaksi,catatan:e.catatan,totalBayar:e.totalBayar,notificationSent:e.notifyUser},timestamp:(new Date).toISOString()};"function"==typeof this.model.logActivity?(await this.model.logActivity(t),console.log("Completion activity logged successfully")):console.log("Activity logging method not available in model")}catch(e){console.error("Error logging completion activity:",e)}}async loadUserInfo(){try{let e=null;e="function"==typeof this.model.getCurrentUser?await this.model.getCurrentUser():B(),e&&(this.user=e,this.view.displayUserInfo(e))}catch(e){console.error("Error loading user info:",e)}}async getCurrentUserId(){try{let e=null;return e="function"==typeof this.model.getCurrentUser?await this.model.getCurrentUser():B(),e?.id||e?.username||"unknown"}catch(e){return console.error("Error getting current user ID:",e),"unknown"}}formatCurrency(e){return e?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"Rp 0"}calculateTotalPayment(e,t){const a=parseFloat(e)||0,n=parseFloat(t)||0;return Math.max(0,a-n)}sanitizeInput(e){return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")}async getCompletionStats(){try{return"function"==typeof this.model.getCompletionStatistics?await this.model.getCompletionStatistics():null}catch(e){return console.error("Error getting completion stats:",e),null}}async getCompletionHistory(e){try{return"function"==typeof this.model.getApplicationCompletionHistory?await this.model.getApplicationCompletionHistory(e):[]}catch(e){return console.error("Error getting completion history:",e),[]}}async refreshApplicationData(){this.currentApplicationId&&await this.loadApplicationDetail(this.currentApplicationId)}destroy(){document.removeEventListener("load-application-detail",this.handleLoadApplicationDetail),document.removeEventListener("submit-completion",this.handleSubmitCompletion),document.removeEventListener("request-user-info",this.loadUserInfo),this.view&&"function"==typeof this.view.destroy&&this.view.destroy()}}window.bootstrap=n;class St{constructor(){this.router=new o,this.currentPresenter=null,this.sidebarPresenter=null,this.currentPage=null,document.addEventListener("navigate",this.handleNavigateEvent.bind(this)),this.setupRouteHandlers()}setupRouteHandlers(){this.router.onRouteChange((({page:e})=>{console.log(`Route changed to: ${e}`),this.loadPage(e)}));const e=this.router.getCurrentRoute();console.log(`Initial page: ${e}`),this.loadPage(e)}handleNavigateEvent(e){e.detail?.id_rekening&&sessionStorage.setItem("id_rekening",e.detail.id_rekening),e.detail&&e.detail.page&&(console.log("Navigation event received:",e.detail),this.router.navigateTo(e.detail.page))}loadPage(e){this.currentPage=e;if(sessionStorage.getItem("previousPage")!==e&&"true"!==sessionStorage.getItem("hasReloaded"))return sessionStorage.setItem("hasReloaded","true"),sessionStorage.setItem("previousPage",e),void location.reload();sessionStorage.setItem("previousPage",e),sessionStorage.removeItem("hasReloaded"),this.currentPresenter&&(this.currentPresenter.destroy(),this.currentPresenter=null);const t=B();if("admin"!==t?.role||"dashboardUser"!==e)if("pengguna"!==t?.role||"dashboard"!==e){switch(this.sidebarPresenter&&(this.sidebarPresenter.destroy(),this.sidebarPresenter=null),e){case"index":default:this.currentPresenter=new I;break;case"register":this.currentPresenter=new F;break;case"login":this.currentPresenter=new z;break;case"dashboard":case"dashboardUser":this.currentPresenter="dashboard"===e?new Q:new se,t&&(this.sidebarPresenter=new l(t.role));break;case"klasifikasiSampah":this.currentPresenter=new tt,t&&(this.sidebarPresenter=new l(t.role));break;case"penjualanSampah":this.currentPresenter=new gt,t&&(this.sidebarPresenter=new l(t.role));break;case"detailProfile":this.currentPresenter=new ut,t&&(this.sidebarPresenter=new l(t.role));break;case"editProfile":this.currentPresenter=new st,t&&(this.sidebarPresenter=new l(t.role));break;case"ubahPassword":this.currentPresenter=new dt,t&&(this.sidebarPresenter=new l(t.role));break;case"dataRekening":this.currentPresenter=new ce,t&&(this.sidebarPresenter=new l(t.role));break;case"tambahRekening":this.currentPresenter=new me,t&&(this.sidebarPresenter=new l(t.role));break;case"ubahRekening":const a=history.state?.id_rekening||sessionStorage.getItem("id_rekening");this.currentPresenter=new ht(a),t&&(this.sidebarPresenter=new l(t.role));break;case"diterima":this.currentPresenter=new Be,t&&(this.sidebarPresenter=new l(t.role));break;case"ditolak":this.currentPresenter=new Ue,t&&(this.sidebarPresenter=new l(t.role));break;case"penjemputan":this.currentPresenter=new Ve,t&&(this.sidebarPresenter=new l(t.role));break;case"selesaiUser":this.currentPresenter=new Ke,t&&(this.sidebarPresenter=new l(t.role));break;case"masterAlamat":this.currentPresenter=new be,t&&(this.sidebarPresenter=new l(t.role));break;case"tambahAlamat":this.currentPresenter=new fe,t&&(this.sidebarPresenter=new l(t.role));break;case"pengajuan":this.currentPresenter=new Le,t&&(this.sidebarPresenter=new l(t.role));break;case"penawaran":this.currentPresenter=new qe,t&&(this.sidebarPresenter=new l(t.role));break;case"pengiriman":this.currentPresenter=new Ae,t&&(this.sidebarPresenter=new l(t.role));break;case"selesai":this.currentPresenter=new Me,t&&(this.sidebarPresenter=new l(t.role));break;case"formPenolakan":this.currentPresenter=new vt,t&&(this.sidebarPresenter=new l(t.role));break;case"formPenawaran":this.currentPresenter=new wt,t&&(this.sidebarPresenter=new l(t.role));break;case"formOngkir":const n=new URLSearchParams(window.location.hash.split("?")[1]).get("id");return this.currentPresenter=new Et,n?this.currentPresenter.init(n):alert("ID pengajuan tidak ditemukan di URL."),void(t&&(this.sidebarPresenter=new l(t.role),this.sidebarPresenter.init(),setTimeout((()=>{this.sidebarPresenter.setActiveRoute(e)}),100)));case"formSelesai":this.currentPresenter=new xt,t&&(this.sidebarPresenter=new l(t.role))}this.currentPresenter&&this.currentPresenter.init(),this.sidebarPresenter&&(this.sidebarPresenter.init(),setTimeout((()=>{this.sidebarPresenter.setActiveRoute(e)}),100)),document.dispatchEvent(new CustomEvent("route-changed",{detail:{route:e}}))}else this.router.navigateTo("dashboardUser");else this.router.navigateTo("dashboard")}getCurrentPage(){return this.currentPage}}document.addEventListener("DOMContentLoaded",(()=>{new St}))},9843:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});a(2351);var n=a(4762),i=a(9264);e=a.hmd(e);class s{constructor(){this.app=document.getElementById("content"),this.sidebarView=new i.A,this.eventListeners=[],this.isMobile=window.matchMedia("(max-width: 768px)").matches,this.sidebarCollapsed=!1,this.presenter=null,this.formElement=null,this.submitButton=null,this.classifiedImage=null,this.classificationResult=null,this.kategoriSampahInput=null,this.beratSampahInput=null,this.init()}init(){this.bindElements(),this.bindEvents(),this.loadPenjualanData(),this.autoFillUserData()}render(){this.sidebarView.render(),this.app.innerHTML=`\n      \x3c!-- Mobile Menu Toggle --\x3e\n      <button id="mobile-menu-toggle" class="mobile-menu-btn">\n        <i class="bi bi-list"></i>\n      </button>\n      <div class="sidebar-overlay"></div>\n\n      \x3c!-- Main Content --\x3e\n      <div class="main-content ${this.isMobile?"full-width":""} ${this.sidebarCollapsed?"collapsed":""}">\n        <header>\n          <div class="header-content">\n            <div class="dashboard-header">\n              <h2>Form Pengajuan Penjualan Sampah</h2>\n              <p class="text-dark mb-4">Ringkasan status pengajuan Anda secara real-time.</p>\n            </div>\n            <div class="user-profile">\n              <img id="user-avatar" src="${n}" alt="User">\n              <span id="user-name">Loading...</span>\n            </div>\n          </div>\n        </header>\n\n        \x3c!-- Upload Section --\x3e\n        <div class="rekening-section">\n          <div class="content-header">\n            <h3>Data Penjualan Sampah</h3>\n          </div>\n\n          <div class="content-body">\n            <form id="penjualan-form">\n              \x3c!-- Row untuk gambar sampah yang telah diklasifikasi --\x3e\n              <div class="form-group">\n                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">\n                  <div id="classified-image-container">\n                    <img id="classified-image" src="" alt="Sampah Terklasifikasi" \n                         style="width: 100px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid #ddd;">\n                  </div>\n                  <div>\n                    <h4 style="margin: 0 0 5px 0; color: var(--text-dark);">Hasil Klasifikasi:</h4>\n                    <p id="classification-result" style="margin: 0; font-weight: 600; color: var(--primary-color);">-</p>\n                  </div>\n                </div>\n              </div>\n\n              \x3c!-- Form Row 1 --\x3e\n              <div class="form-row">\n                <div class="form-group">\n                  <label for="nama-lengkap" class="form-label">Nama Lengkap</label>\n                  <input type="text" id="nama-lengkap" name="nama-lengkap" class="form-control" disabled readonly>\n                </div>\n                <div class="form-group">\n                  <label for="no-hp" class="form-label">No HP</label>\n                  <input type="tel" id="no-hp" name="no-hp" class="form-control" disabled readonly>\n                </div>\n              </div>\n\n              \x3c!-- Form Row 2 --\x3e\n              <div class="form-row">\n                <div class="form-group">\n                  <label for="kategori-sampah" class="form-label">Kategori Sampah</label>\n                  <input type="text" id="kategori-sampah" name="kategori-sampah" class="form-control" disabled readonly>\n                </div>\n                <div class="form-group">\n                  <label for="berat-sampah" class="form-label">Berat Sampah (kg)</label>\n                  <input type="number" id="berat-sampah" name="berat-sampah" class="form-control" disabled readonly>\n                </div>\n              </div>\n\n              \x3c!-- Submit Button --\x3e\n              <div style="display: flex; justify-content: flex-end; margin-top: 30px; gap: 15px;">\n                <a href="#/klasifikasi-sampah" class="btn btn-outline">Kembali</a>\n                <button type="button" class="btn btn-primary classify-btn" id="submit-btn" disabled>\n                  Kirim Pengajuan\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    `,this.bindElements(),this.bindEvents(),this.loadPenjualanData(),this.autoFillUserData();const e=JSON.parse(localStorage.getItem("userData")||"{}");this.displayUserInfo(e)}bindElements(){this.formElement=document.getElementById("penjualan-form"),this.submitButton=document.getElementById("submit-btn"),this.classifiedImage=document.getElementById("classified-image"),this.classificationResult=document.getElementById("classification-result"),this.namaLengkapInput=document.getElementById("nama-lengkap"),this.iduserInput=document.getElementById("id-user"),this.noHpInput=document.getElementById("no-hp"),this.kategoriSampahInput=document.getElementById("kategori-sampah"),this.beratSampahInput=document.getElementById("berat-sampah")}bindEvents(){this.formElement&&this.formElement.addEventListener("submit",(e=>e.preventDefault()))}enableSubmit(){this.submitButton&&(this.submitButton.disabled=!1,this.submitButton.style.backgroundColor="#007bff",this.submitButton.style.borderColor="#007bff",this.submitButton.style.cursor="pointer",this.submitButton.style.opacity="1",this.submitButton.textContent="Kirim Pengajuan",this.submitButton.addEventListener("click",(async e=>{if(e.preventDefault(),this.presenter&&"function"==typeof this.presenter.submitPengajuan)try{await this.presenter.submitPengajuan(),window.location.href="#/dashboardUser"}catch(e){this.showError("Gagal mengirim pengajuan: "+e.message)}})))}getFormData(){return{namaLengkap:this.namaLengkapInput?.value||"",idUser:this.iduserInput?.value||"",noHp:this.noHpInput?.value||"",kategoriSampah:this.kategoriSampahInput?.value||"",beratSampah:parseFloat(this.beratSampahInput?.value||0),gambarSampah:this.classifiedImage?.src||"",tanggalPengajuan:(new Date).toISOString(),status:"Tersimpan",id:Date.now().toString()}}showSuccess(e){alert(e||"Data telah tersimpan!")}showError(e){alert("Error: "+(e||"Terjadi kesalahan saat memuat data"))}setPresenter(e){this.presenter=e}loadPenjualanData(){try{const e=JSON.parse(localStorage.getItem("penjualanSampahData")||"{}");if(this.classifiedImage&&e.image&&(this.classifiedImage.src=e.image),this.classificationResult&&e.category&&(this.classificationResult.innerHTML=e.category,e.confidence)){const t=Math.round(e.confidence);this.classificationResult.innerHTML+=`<span style="font-size:0.8rem;color:#6c757d;"> (${t}% akurasi)</span>`}this.kategoriSampahInput&&e.category&&(this.kategoriSampahInput.value=e.category),this.beratSampahInput&&e.quantity&&(this.beratSampahInput.value=e.quantity)}catch(e){console.error("Error loadPenjualanData:",e),this.showError("Gagal memuat data penjualan")}}autoFillUserData(){try{const e=JSON.parse(localStorage.getItem("user")||"{}");e.nama_lengkap&&this.namaLengkapInput&&(this.namaLengkapInput.value=e.nama_lengkap),e.no_hp&&this.noHpInput&&(this.noHpInput.value=e.no_hp),e.id_user&&this.iduserInput&&(this.iduserInput.value=e.id_user);const t=document.getElementById("user-name");e.displayName&&t&&(t.textContent=e.displayName)}catch(e){console.error("Error loading user data:",e)}}displayUserInfo(e){const t=document.getElementById("user-name");t&&e&&(t.textContent=e.nama_lengkap||e.username)}destroy(){this.eventListeners.forEach((({element:e,event:t,handler:a})=>{e&&e.removeEventListener(t,a)})),this.eventListeners=[]}}e.exports&&(e.exports=s),document.addEventListener("DOMContentLoaded",(()=>{console.log("DOM fully loaded"),console.log("classifiedImage element:",document.getElementById("classified-image"))}))},9940:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(1601),i=a.n(n),s=a(6314),r=a.n(s)()(i());r.push([e.id,"// extracted by mini-css-extract-plugin\nexport {};",""]);const l=r}},a={};function n(e){var i=a[e];if(void 0!==i)return i.exports;var s=a[e]={id:e,loaded:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=t,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},e=[],n.O=(t,a,i,s)=>{if(!a){var r=1/0;for(c=0;c<e.length;c++){for(var[a,i,s]=e[c],l=!0,o=0;o<a.length;o++)(!1&s||r>=s)&&Object.keys(n.O).every((e=>n.O[e](a[o])))?a.splice(o--,1):(l=!1,s<r&&(r=s));if(l){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[a,i,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/GreenSort/",(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var i,s,[r,l,o]=a,d=0;if(r.some((t=>0!==e[t]))){for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(o)var c=o(n)}for(t&&t(a);d<r.length;d++)s=r[d],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},a=self.webpackChunkgreensort=self.webpackChunkgreensort||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),n.nc=void 0;var i=n.O(void 0,[880],(()=>n(9466)));i=n.O(i)})();